# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        thorfdbg libjpeg c719010a26ce0c666e98b2acf924ad5fc24b4f5d
# https://github.com/macports/macports-ports/pull/28116#issuecomment-2847585194
name                jpeg-xt
# https://github.com/thorfdbg/libjpeg/blob/master/README
version             1.70
revision            0
categories          graphics
license             GPL-3
maintainers         nomaintainer

description         Complete implementation of 10918-1 (JPEG) from jpeg.org

long_description    A complete implementation of 10918-1 (JPEG) coming \
                    from jpeg.org (the ISO group) with extensions for \
                    HDR standardized as 18477 (JPEG XT).

checksums           rmd160  245dc39bc712770499a86d904e8aa332a2118c1a \
                    sha256  62e8c8b1898a7e9195c90b673e6db0090b474372b4e7f485e471f37a08852e18 \
                    size    560772

use_autoreconf      yes
# https://trac.macports.org/wiki/WimplicitFunctionDeclaration#strchr
configure.checks.implicit_function_declaration.whitelist-append strchr

build.target        doc final

destroot.destdir    INSTALLDIR=${destroot}${prefix}/bin

if {[string match *clang* ${configure.cc}]} {
    build.target-append \
                    SETTINGS=clang
    destroot.post_args-append \
                    SETTINGS=clang
} elseif {[string match *gcc* ${configure.cc}]} {
    post-patch {
        reinplace "s,-Wno-shift-negative-value ,," ${worksrcpath}/Makefile_Settings.gcc
    }

    build.target-append \
                    SETTINGS=gcc
    destroot.post_args-append \
                    SETTINGS=gcc
}

post-destroot {
    move            ${destroot}${prefix}/bin/jpeg \
                    ${destroot}${prefix}/bin/jpeg-xt
}
