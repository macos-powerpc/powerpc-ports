From de59b1e1604105ad1625f05edf606cf74a5153b0 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Fri, 27 Feb 2026 19:21:24 +0800
Subject: [PATCH] Fix for 10.6

---
 modules/imgcodecs/src/apple_conversions.h   | 5 +++++
 modules/imgcodecs/src/apple_conversions.mm  | 4 ++++
 modules/imgcodecs/src/macosx_conversions.mm | 7 +++++++
 3 files changed, 16 insertions(+)

diff --git a/modules/imgcodecs/src/apple_conversions.h b/modules/imgcodecs/src/apple_conversions.h
index d2f9c2499a..920af88991 100644
--- a/modules/imgcodecs/src/apple_conversions.h
+++ b/modules/imgcodecs/src/apple_conversions.h
@@ -17,6 +17,11 @@
 #include <TargetConditionals.h>
 #if TARGET_OS_IPHONE || (defined(MAC_OS_X_VERSION_MAX_ALLOWED) && MAC_OS_X_VERSION_MAX_ALLOWED >= 1080)
 #import <ImageIO/ImageIO.h>
+#else
+// No direct inclusion of CoreGraphics on older macOS
+#import <ApplicationServices/ApplicationServices.h>
+#import <CoreFoundation/CoreFoundation.h>
+#import <Foundation/Foundation.h>
 #endif
 
 CV_EXPORTS CGImageRef MatToCGImage(const cv::Mat& image) CF_RETURNS_RETAINED;
diff --git a/modules/imgcodecs/src/apple_conversions.mm b/modules/imgcodecs/src/apple_conversions.mm
index 6126039ce0..82d81a0365 100644
--- a/modules/imgcodecs/src/apple_conversions.mm
+++ b/modules/imgcodecs/src/apple_conversions.mm
@@ -5,6 +5,10 @@
 #include "apple_conversions.h"
 #include "precomp.hpp"
 
+#ifndef __bridge
+#define __bridge
+#endif
+
 CGImageRef MatToCGImage(const cv::Mat& image) {
     NSData *data = [NSData dataWithBytes:image.data
                                   length:image.step.p[0] * image.rows];
diff --git a/modules/imgcodecs/src/macosx_conversions.mm b/modules/imgcodecs/src/macosx_conversions.mm
index 0023e06260..01c1bd76e4 100644
--- a/modules/imgcodecs/src/macosx_conversions.mm
+++ b/modules/imgcodecs/src/macosx_conversions.mm
@@ -13,7 +13,14 @@ NSImage* MatToNSImage(const cv::Mat& image) {
     CGImageRef imageRef = MatToCGImage(image);
 
     // Getting NSImage from CGImage
+#if MAC_OS_X_VERSION_MIN_REQUIRED < 1080
+    CGFloat width = CGImageGetWidth(imageRef);
+    CGFloat height = CGImageGetHeight(imageRef);
+    NSSize nsSize = NSMakeSize(width, height);
+    NSImage *nsImage = [[NSImage alloc] initWithCGImage:imageRef size:nsSize];
+#else
     NSImage *nsImage = [[NSImage alloc] initWithCGImage:imageRef size:CGSizeMake(CGImageGetWidth(imageRef), CGImageGetHeight(imageRef))];
+#endif
     CGImageRelease(imageRef);
 
     return nsImage;
