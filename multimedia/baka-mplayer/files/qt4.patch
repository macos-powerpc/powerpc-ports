diff --git a/src/Baka-MPlayer.pro b/src/Baka-MPlayer.pro
index 81425ee..13df8f6 100644
--- a/src/Baka-MPlayer.pro
+++ b/src/Baka-MPlayer.pro
@@ -13,6 +13,12 @@ TEMPLATE = app
 
 CONFIG += c++11 link_pkgconfig
 
+# For Qt4, use external qjson4 library
+!greaterThan(QT_MAJOR_VERSION, 4) {
+    INCLUDEPATH += /opt/local/include/QJson4
+    LIBS += -lQJson4
+}
+
 isEmpty(DESTDIR):DESTDIR=build
 OBJECTS_DIR = $${DESTDIR}/obj
 MOC_DIR = $${DESTDIR}/moc
@@ -26,7 +32,7 @@ macx {
 }
 
 unix:!macx {
-    QT += x11extras
+    greaterThan(QT_MAJOR_VERSION, 4): QT += x11extras
     PKGCONFIG += x11
 
     SOURCES += platform/linux.cpp
@@ -35,7 +41,7 @@ unix:!macx {
 PKGCONFIG += mpv
 
 win32 {
-    QT += winextras
+    greaterThan(QT_MAJOR_VERSION, 4): QT += winextras
     PKGCONFIG += libzip
 
     # mxe fix:
@@ -62,16 +68,25 @@ win32 {
 }
 
 # INSTROOT is the installation root directory, leave empty if not using a package management system
+# SHAREDIR is the shared data directory, configurable with /opt/local/share as default
+isEmpty(SHAREDIR):SHAREDIR=/opt/local/share
 isEmpty(BINDIR):BINDIR=/usr/bin
-isEmpty(MEDIADIR):MEDIADIR=/usr/share/pixmaps
-isEmpty(ICONDIR):ICONDIR=/usr/share/icons/hicolor/scalable/apps
-isEmpty(APPDIR):APPDIR=/usr/share/applications
-isEmpty(DOCDIR):DOCDIR=/usr/share/doc
-isEmpty(MANDIR):MANDIR=/usr/share/man
-isEmpty(LICENSEDIR):LICENSEDIR=/usr/share/licenses
-isEmpty(BAKADIR):BAKADIR=/usr/share/baka-mplayer
-
-target.path = $$INSTROOT$$BINDIR
+isEmpty(MEDIADIR):MEDIADIR=$$SHAREDIR/pixmaps
+isEmpty(ICONDIR):ICONDIR=$$SHAREDIR/icons/hicolor/scalable/apps
+isEmpty(APPDIR):APPDIR=$$SHAREDIR/applications
+isEmpty(DOCDIR):DOCDIR=$$SHAREDIR/doc
+isEmpty(MANDIR):MANDIR=$$SHAREDIR/man
+isEmpty(LICENSEDIR):LICENSEDIR=$$SHAREDIR/licenses
+isEmpty(BAKADIR):BAKADIR=$$SHAREDIR/baka-mplayer
+
+# On macOS, install app bundle to /Applications/MacPorts by default
+macx {
+    isEmpty(MACAPPDIR):MACAPPDIR=/Applications/MacPorts
+    target.path = $$INSTROOT$$MACAPPDIR
+}
+!macx {
+    target.path = $$INSTROOT$$BINDIR
+}
 logo.path = $$INSTROOT$$MEDIADIR
 icon.path = $$INSTROOT$$ICONDIR
 desktop.path = $$INSTROOT$$APPDIR
@@ -150,7 +165,7 @@ SOURCES += main.cpp\
     bakaengine.cpp \
     bakacommands.cpp \
     mpvhandler.cpp \
-    updatemanager.cpp \
+    mpvtypes.cpp \
     gesturehandler.cpp \
     overlayhandler.cpp \
     util.cpp \
@@ -172,7 +187,6 @@ SOURCES += main.cpp\
     ui/mainwindow.cpp \
     ui/preferencesdialog.cpp \
     ui/screenshotdialog.cpp \
-    ui/updatedialog.cpp \
     ui/keydialog.cpp \
     overlay.cpp
 
@@ -180,7 +194,6 @@ HEADERS  += \
     bakaengine.h \
     mpvhandler.h \
     mpvtypes.h \
-    updatemanager.h \
     gesturehandler.h \
     overlayhandler.h \
     overlay.h \
@@ -202,7 +215,6 @@ HEADERS  += \
     ui/mainwindow.h \
     ui/preferencesdialog.h \
     ui/screenshotdialog.h \
-    ui/updatedialog.h \
     ui/keydialog.h \
     recent.h
 
@@ -214,5 +226,4 @@ FORMS    += \
     ui/mainwindow.ui \
     ui/preferencesdialog.ui \
     ui/screenshotdialog.ui \
-    ui/updatedialog.ui \
     ui/keydialog.ui
diff --git a/src/bakacommands.cpp b/src/bakacommands.cpp
index 6cd2698..ec0a3eb 100644
--- a/src/bakacommands.cpp
+++ b/src/bakacommands.cpp
@@ -40,11 +40,8 @@ void BakaEngine::BakaSh(QStringList &args)
         args.pop_front();
         QProcess *p = new QProcess(this);
         p->start(arg, args);
-        connect(p, &QProcess::readyRead,
-                [=]
-                {
-                    Print(p->readAll(), QString("%0(%1))").arg(p->program(), QString::number(quintptr(p))));
-                });
+        connect(p, SIGNAL(readyRead()),
+                this, SLOT(handleProcessReadyRead()));
 //        connect(p, &QProcess::finished,
 //                [=](int, QProcess::ExitStatus)
 //                {
@@ -58,9 +55,12 @@ void BakaEngine::BakaSh(QStringList &args)
 void BakaEngine::BakaNew(QStringList &args)
 {
     if(args.empty())
-        QProcess::startDetached(QApplication::applicationFilePath(), {});
+    {
+        QStringList emptyArgs;
+        QProcess::startDetached(QApplication::applicationFilePath(), emptyArgs);
+    }
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaOpenLocation(QStringList &args)
@@ -68,7 +68,7 @@ void BakaEngine::BakaOpenLocation(QStringList &args)
     if(args.empty())
         OpenLocation();
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::OpenLocation()
@@ -82,7 +82,7 @@ void BakaEngine::BakaOpenClipboard(QStringList &args)
     if(args.empty())
         mpv->LoadFile(QApplication::clipboard()->text());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaShowInFolder(QStringList &args)
@@ -90,7 +90,7 @@ void BakaEngine::BakaShowInFolder(QStringList &args)
     if(args.empty())
         Util::ShowInFolder(mpv->getPath(), mpv->getFile());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaAddSubtitles(QStringList &args)
@@ -103,7 +103,7 @@ void BakaEngine::BakaAddSubtitles(QStringList &args)
                                                  0, QFileDialog::DontUseSheet);
     }
     else
-        trackFile = args.join(' ');
+        trackFile = args.join(" ");
 
     mpv->AddSubtitleTrack(trackFile);
 }
@@ -118,7 +118,7 @@ void BakaEngine::BakaAddAudio(QStringList &args)
                                                  0, QFileDialog::DontUseSheet);
     }
     else
-        trackFile = args.join(' ');
+        trackFile = args.join(" ");
 
     mpv->AddAudioTrack(trackFile);
 }
@@ -170,7 +170,7 @@ void BakaEngine::BakaMediaInfo(QStringList &args)
     if(args.empty())
         MediaInfo(window->ui->actionMedia_Info->isChecked());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::MediaInfo(bool show)
@@ -184,7 +184,7 @@ void BakaEngine::BakaStop(QStringList &args)
     if(args.empty())
         mpv->Stop();
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaPlaylist(QStringList &args)
@@ -209,7 +209,7 @@ void BakaEngine::BakaPlaylist(QStringList &args)
                         window->ui->playlistWidget->PlayIndex(arg.toInt());
                 }
                 else
-                    InvalidParameter(args.join(' '));
+                    InvalidParameter(args.join(" "));
             }
         }
         else if(arg == "select")
@@ -228,7 +228,7 @@ void BakaEngine::BakaPlaylist(QStringList &args)
                         window->ui->playlistWidget->SelectIndex(arg.toInt());
                 }
                 else
-                    InvalidParameter(args.join(' '));
+                    InvalidParameter(args.join(" "));
             }
         }
         else if(args.empty())
@@ -281,7 +281,7 @@ void BakaEngine::BakaPlaylist(QStringList &args)
                     InvalidParameter(arg);
             }
             else
-                InvalidParameter(args.join(' '));
+                InvalidParameter(args.join(" "));
         }
         else
             InvalidParameter(arg);
@@ -295,7 +295,7 @@ void BakaEngine::BakaJump(QStringList &args)
     if(args.empty())
         Jump();
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::Jump()
@@ -308,7 +308,7 @@ void BakaEngine::Jump()
 
 void BakaEngine::BakaDim(QStringList &args)
 {
-    if(dimDialog == nullptr)
+    if(dimDialog == 0)
     {
         Print(tr("DimDialog not supported on this platform"));
         return;
@@ -316,12 +316,12 @@ void BakaEngine::BakaDim(QStringList &args)
     if(args.empty())
         Dim(!dimDialog->isVisible());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::Dim(bool dim)
 {
-    if(dimDialog == nullptr)
+    if(dimDialog == 0)
     {
         QMessageBox::information(window, tr("Dim Lights"), tr("In order to dim the lights, the desktop compositor has to be enabled. This can be done through Window Manager Desktop."));
         return;
@@ -337,7 +337,7 @@ void BakaEngine::BakaOutput(QStringList &args)
     if(args.empty())
         window->setDebug(!window->getDebug());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaPreferences(QStringList &args)
@@ -345,7 +345,7 @@ void BakaEngine::BakaPreferences(QStringList &args)
     if(args.empty())
         PreferencesDialog::showPreferences(this, window);
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaOnlineHelp(QStringList &args)
@@ -353,24 +353,7 @@ void BakaEngine::BakaOnlineHelp(QStringList &args)
     if(args.empty())
         QDesktopServices::openUrl(QUrl(tr("http://bakamplayer.u8sand.net/help.php")));
     else
-        InvalidParameter(args.join(' '));
-}
-
-void BakaEngine::BakaUpdate(QStringList &args)
-{
-    if(args.empty())
-        UpdateDialog::CheckForUpdates(this, window);
-    else
-    {
-#if defined(Q_OS_WIN)
-        QString arg = args.front();
-        args.pop_front();
-        if(arg == "youtube-dl")
-            QProcess::startDetached("youtube-dl.exe", {"--update"});
-        else
-#endif
-            InvalidParameter(args.join(' '));
-    }
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaOpen(QStringList &args)
@@ -378,7 +361,7 @@ void BakaEngine::BakaOpen(QStringList &args)
     if(args.empty())
         Open();
     else
-        mpv->LoadFile(args.join(' '));
+        mpv->LoadFile(args.join(" "));
 }
 
 void BakaEngine::Open()
@@ -398,7 +381,7 @@ void BakaEngine::BakaPlayPause(QStringList &args)
     if(args.empty())
         PlayPause();
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::PlayPause()
@@ -418,7 +401,7 @@ void BakaEngine::BakaFitWindow(QStringList &args)
         if(args.empty())
             FitWindow(arg.toInt());
         else
-            InvalidParameter(args.join(' '));
+            InvalidParameter(args.join(" "));
     }
 }
 
@@ -515,7 +498,7 @@ void BakaEngine::BakaDeinterlace(QStringList &args)
     if(args.empty())
         mpv->Deinterlace(window->ui->action_Deinterlace->isChecked());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaInterpolate(QStringList &args)
@@ -523,7 +506,7 @@ void BakaEngine::BakaInterpolate(QStringList &args)
     if(args.empty())
         mpv->Interpolate(window->ui->action_Motion_Interpolation->isChecked());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaMute(QStringList &args)
@@ -531,7 +514,7 @@ void BakaEngine::BakaMute(QStringList &args)
     if(args.empty())
         mpv->Mute(!mpv->getMute());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaVolume(QStringList &args)
@@ -548,7 +531,7 @@ void BakaEngine::BakaVolume(QStringList &args)
                 mpv->Volume(arg.toInt(), true);
         }
         else
-            InvalidParameter(args.join(' '));
+            InvalidParameter(args.join(" "));
     }
     else
         RequiresParameters("volume");
@@ -569,7 +552,7 @@ void BakaEngine::BakaSpeed(QStringList &args)
             mpv->ShowText(tr("Speed: %0x").arg(QString::number(mpv->getSpeed(), 'f', 2)));
         }
         else
-            InvalidParameter(args.join(' '));
+            InvalidParameter(args.join(" "));
     }
     else
         RequiresParameters("speed");
@@ -584,7 +567,7 @@ void BakaEngine::BakaFullScreen(QStringList &args)
             mpv->ShowText(tr("Press ESC or double-click to leave full screen"));
     }
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaHideAllControls(QStringList &args)
@@ -597,7 +580,7 @@ void BakaEngine::BakaHideAllControls(QStringList &args)
         //  necessary to show this message.
         if(window->hideAllControls)
         {
-            for(auto i = input.begin(); i != input.end(); ++i)
+            for(QHash<QString, QPair<QString, QString> >::iterator i = input.begin(); i != input.end(); ++i)
             {
                 if(i->first == "hide_all_controls")
                 {
@@ -608,7 +591,7 @@ void BakaEngine::BakaHideAllControls(QStringList &args)
         }
     }
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaBoss(QStringList &args)
@@ -619,7 +602,7 @@ void BakaEngine::BakaBoss(QStringList &args)
         window->setWindowState(window->windowState() | Qt::WindowMinimized); // minimize window
     }
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaClear(QStringList &args)
@@ -627,7 +610,7 @@ void BakaEngine::BakaClear(QStringList &args)
     if(args.empty())
         window->ui->outputTextEdit->setPlainText(QString());
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::BakaHelp(QStringList &args)
@@ -637,7 +620,7 @@ void BakaEngine::BakaHelp(QStringList &args)
         Print(tr("usage: baka <command> [...]"));
         Print(tr("commands:"));
         int len, max_len = 22;
-        for(auto command = BakaCommandMap.begin(); command != BakaCommandMap.end(); ++command)
+        for(QHash<QString, QPair<BakaCommandFPtr, QStringList> >::const_iterator command = BakaCommandMap.begin(); command != BakaCommandMap.end(); ++command)
         {
             QString str = QString("  %0 %1").arg(command.key(), command->second[0]);
             len = str.length();
@@ -653,7 +636,7 @@ void BakaEngine::BakaHelp(QStringList &args)
         args.pop_front();
         if(args.empty())
         {
-            auto command = BakaCommandMap.find(arg);
+            QHash<QString, QPair<BakaCommandFPtr, QStringList> >::const_iterator command = BakaCommandMap.find(arg);
             if(command != BakaCommandMap.end()) //found
             {
                 Print(tr("usage: %0 %1").arg(arg, command->second[0]));
@@ -669,13 +652,13 @@ void BakaEngine::BakaHelp(QStringList &args)
                 InvalidParameter(arg);
         }
         else
-            InvalidParameter(args.join(' '));
+            InvalidParameter(args.join(" "));
     }
 }
 
 void BakaEngine::BakaAbout(QStringList &args)
 {
-    About(args.join(' '));
+    About(args.join(" "));
 }
 
 void BakaEngine::BakaMsgLevel(QStringList &args)
@@ -687,7 +670,7 @@ void BakaEngine::BakaMsgLevel(QStringList &args)
         if(args.empty())
             mpv->MsgLevel(arg);
         else
-            InvalidParameter(args.join(' '));
+            InvalidParameter(args.join(" "));
     }
     else
         RequiresParameters("msg_level");
@@ -709,7 +692,7 @@ void BakaEngine::BakaQuit(QStringList &args)
     if(args.empty())
         Quit();
     else
-        InvalidParameter(args.join(' '));
+        InvalidParameter(args.join(" "));
 }
 
 void BakaEngine::Quit()
diff --git a/src/bakaengine.cpp b/src/bakaengine.cpp
index b20dd0c..710d4c7 100644
--- a/src/bakaengine.cpp
+++ b/src/bakaengine.cpp
@@ -2,6 +2,7 @@
 
 #include <QMessageBox>
 #include <QDir>
+#include <QProcess>
 
 #include "ui/mainwindow.h"
 #include "ui_mainwindow.h"
@@ -9,7 +10,6 @@
 #include "mpvhandler.h"
 #include "gesturehandler.h"
 #include "overlayhandler.h"
-#include "updatemanager.h"
 #include "widgets/dimdialog.h"
 #include "util.h"
 
@@ -20,43 +20,35 @@ BakaEngine::BakaEngine(QObject *parent):
     settings(new Settings(Util::SettingsLocation(), this)),
     gesture(new GestureHandler(this)),
     overlay(new OverlayHandler(this)),
-    update(new UpdateManager(this)),
     // note: trayIcon does not work in my environment--known qt bug
     // see: https://bugreports.qt-project.org/browse/QTBUG-34364
     sysTrayIcon(new QSystemTrayIcon(window->windowIcon(), this)),
     // todo: tray menu/tooltip
-    translator(nullptr),
-    qtTranslator(nullptr)
+    translator(0),
+    qtTranslator(0),
+    default_input(initDefaultInput()),
+    BakaCommandMap(initBakaCommandMap())
 {
     if(Util::DimLightsSupported())
-        dimDialog = new DimDialog(window, nullptr);
+        dimDialog = new DimDialog(window, 0);
     else
     {
-        dimDialog = nullptr;
+        dimDialog = 0;
         window->ui->action_Dim_Lights->setEnabled(false);
     }
 
-    connect(mpv, &MpvHandler::messageSignal,
-            [=](QString msg)
-            {
-                Print(msg, "mpv");
-            });
-    connect(update, &UpdateManager::messageSignal,
-            [=](QString msg)
-            {
-                Print(msg, "update");
-            });
+    connect(mpv, SIGNAL(messageSignal(QString)),
+            this, SLOT(handleMpvMessage(QString)));
 }
 
 BakaEngine::~BakaEngine()
 {
-    if(translator != nullptr)
+    if(translator != 0)
         delete translator;
-    if(qtTranslator != nullptr)
+    if(qtTranslator != 0)
         delete qtTranslator;
-    if(dimDialog != nullptr)
+    if(dimDialog != 0)
         delete dimDialog;
-    delete update;
     delete overlay;
     delete gesture;
     delete settings;
@@ -81,20 +73,32 @@ void BakaEngine::Command(QString command)
 
         if(!args.empty())
         {
-            auto iter = BakaCommandMap.find(args.front());
+            QHash<QString, QPair<BakaCommandFPtr, QStringList> >::const_iterator iter = BakaCommandMap.find(args.front());
             if(iter != BakaCommandMap.end())
             {
                 args.pop_front();
                 (this->*(iter->first))(args); // execute command
             }
             else
-                InvalidCommand(args.join(' '));
+                InvalidCommand(args.join(" "));
         }
         else
             RequiresParameters("baka");
     }
     else
-        InvalidCommand(args.join(' '));
+        InvalidCommand(args.join(" "));
+}
+
+void BakaEngine::handleMpvMessage(QString msg)
+{
+    Print(msg, "mpv");
+}
+
+void BakaEngine::handleProcessReadyRead()
+{
+    QProcess *p = qobject_cast<QProcess*>(sender());
+    if(p)
+        Print(p->readAll(), QString("process(%0)").arg(QString::number(quintptr(p))));
 }
 
 void BakaEngine::Print(QString what, QString who)
@@ -124,3 +128,197 @@ void BakaEngine::RequiresParameters(QString what)
 {
     PrintLn(tr("'%0' requires parameters").arg(what));
 }
+
+QHash<QString, QPair<QString, QString> > BakaEngine::initDefaultInput()
+{
+    QHash<QString, QPair<QString, QString> > map;
+    map.insert("Ctrl++", QPair<QString, QString>("mpv add sub-scale +0.1", tr("Increase sub size")));
+    map.insert("Ctrl+-", QPair<QString, QString>("mpv add sub-scale -0.1", tr("Decrease sub size")));
+    map.insert("Ctrl+W", QPair<QString, QString>("mpv cycle sub-visibility", tr("Toggle subtitle visibility")));
+    map.insert("Ctrl+R", QPair<QString, QString>("mpv set time-pos 0", tr("Restart playback")));
+    map.insert("PgDown", QPair<QString, QString>("mpv add chapter +1", tr("Go to next chapter")));
+    map.insert("PgUp", QPair<QString, QString>("mpv add chapter -1", tr("Go to previous chapter")));
+    map.insert("Right", QPair<QString, QString>("mpv seek +5", tr("Seek forwards by %0 sec").arg("5")));
+    map.insert("Left", QPair<QString, QString>("mpv seek -5", tr("Seek backwards by %0 sec").arg("5")));
+    map.insert("Up", QPair<QString, QString>("mpv seek +30", tr("Seek forwards by %0 sec").arg("30")));
+    map.insert("Down", QPair<QString, QString>("mpv seek -30", tr("Seek backwards by %0 sec").arg("30")));
+    map.insert("Shift+Left", QPair<QString, QString>("mpv frame-back-step", tr("Frame step backwards")));
+    map.insert("Shift+Right", QPair<QString, QString>("mpv frame-step", tr("Frame step")));
+    map.insert("Ctrl+M", QPair<QString, QString>("mute", tr("Toggle mute audio")));
+    map.insert("Ctrl+T", QPair<QString, QString>("screenshot subtitles", tr("Take screenshot with subtitles")));
+    map.insert("Ctrl+Shift+T", QPair<QString, QString>("screenshot", tr("Take screenshot without subtitles")));
+    map.insert("Ctrl+Down", QPair<QString, QString>("volume -5", tr("Decrease volume")));
+    map.insert("Ctrl+Up", QPair<QString, QString>("volume +5", tr("Increase volume")));
+    map.insert("Ctrl+Shift+Up", QPair<QString, QString>("speed +0.1", tr("Increase playback speed by %0").arg("10")));
+    map.insert("Ctrl+Shift+Down", QPair<QString, QString>("speed -0.1", tr("Decrease playback speed by %0").arg("10")));
+    map.insert("Ctrl+Shift+R", QPair<QString, QString>("speed 1.0", tr("Reset speed")));
+    map.insert("Alt+Return", QPair<QString, QString>("fullscreen", tr("Toggle fullscreen")));
+    map.insert("Ctrl+H", QPair<QString, QString>("hide_all_controls", tr("Toggle hide all controls mode")));
+    map.insert("Ctrl+D", QPair<QString, QString>("dim", tr("Dim lights")));
+    map.insert("Ctrl+E", QPair<QString, QString>("show_in_folder", tr("Show the file in its folder")));
+    map.insert("Tab", QPair<QString, QString>("media_info", tr("View media information")));
+    map.insert("Ctrl+J", QPair<QString, QString>("jump", tr("Show jump to time dialog")));
+    map.insert("Ctrl+N", QPair<QString, QString>("new", tr("Open a new window")));
+    map.insert("Ctrl+O", QPair<QString, QString>("open", tr("Show open file dialog")));
+    map.insert("Ctrl+Q", QPair<QString, QString>("quit", tr("Quit")));
+    map.insert("Ctrl+Right", QPair<QString, QString>("playlist play +1", tr("Play next file")));
+    map.insert("Ctrl+Left", QPair<QString, QString>("playlist play -1", tr("Play previous file")));
+    map.insert("Ctrl+S", QPair<QString, QString>("stop", tr("Stop playback")));
+    map.insert("Ctrl+U", QPair<QString, QString>("open_location", tr("Show location dialog")));
+    map.insert("Ctrl+V", QPair<QString, QString>("open_clipboard", tr("Open clipboard location")));
+    map.insert("Ctrl+F", QPair<QString, QString>("playlist toggle", tr("Toggle playlist visibility")));
+    map.insert("Ctrl+Z", QPair<QString, QString>("open_recent 0", tr("Open the last played file")));
+    map.insert("Ctrl+`", QPair<QString, QString>("output", tr("Access command-line")));
+    map.insert("F1", QPair<QString, QString>("online_help", tr("Launch online help")));
+    map.insert("Space", QPair<QString, QString>("play_pause", tr("Play/Pause")));
+    map.insert("Alt+1", QPair<QString, QString>("fitwindow", tr("Fit the window to the video")));
+    map.insert("Alt+2", QPair<QString, QString>("fitwindow 50", tr("Fit window to %0%").arg("50")));
+    map.insert("Alt+3", QPair<QString, QString>("fitwindow 75", tr("Fit window to %0%").arg("75")));
+    map.insert("Alt+4", QPair<QString, QString>("fitwindow 100", tr("Fit window to %0%").arg("100")));
+    map.insert("Alt+5", QPair<QString, QString>("fitwindow 150", tr("Fit window to %0%").arg("150")));
+    map.insert("Alt+6", QPair<QString, QString>("fitwindow 200", tr("Fit window to %0%").arg("200")));
+    map.insert("Esc", QPair<QString, QString>("boss", tr("Boss key")));
+    map.insert("Return", QPair<QString, QString>("playlist play", tr("Play selected file on playlist")));
+    map.insert("Del", QPair<QString, QString>("playlist remove", tr("Remove selected file from playlist")));
+    return map;
+}
+
+QHash<QString, QPair<BakaEngine::BakaCommandFPtr, QStringList> > BakaEngine::initBakaCommandMap()
+{
+    QHash<QString, QPair<BakaCommandFPtr, QStringList> > map;
+    QStringList params;
+
+    params.clear();
+    params << QString() << tr("executes mpv command") << QString();
+    map.insert("mpv", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaMpv, params));
+
+    params.clear();
+    params << QString() << tr("executes system shell command") << QString();
+    map.insert("sh", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaSh, params));
+
+    params.clear();
+    params << QString() << tr("creates a new instance of baka-mplayer") << QString();
+    map.insert("new", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaNew, params));
+
+    params.clear();
+    params << QString() << tr("shows the open location dialog") << QString();
+    map.insert("open_location", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaOpenLocation, params));
+
+    params.clear();
+    params << QString() << tr("opens the clipboard") << QString();
+    map.insert("open_clipboard", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaOpenClipboard, params));
+
+    params.clear();
+    params << QString() << tr("shows the current file in folder") << QString();
+    map.insert("show_in_folder", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaShowInFolder, params));
+
+    params.clear();
+    params << QString() << tr("add subtitles dialog") << QString();
+    map.insert("add_subtitles", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaAddSubtitles, params));
+
+    params.clear();
+    params << QString() << tr("add audio track dialog") << QString();
+    map.insert("add_audio", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaAddAudio, params));
+
+    params.clear();
+    params << tr("[subs]") << tr("take a screenshot (with subtitles if specified)") << QString();
+    map.insert("screenshot", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaScreenshot, params));
+
+    params.clear();
+    params << QString() << tr("toggles media info display") << QString();
+    map.insert("media_info", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaMediaInfo, params));
+
+    params.clear();
+    params << QString() << tr("stops the current playback") << QString();
+    map.insert("stop", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaStop, params));
+
+    params.clear();
+    params << "[...]" << tr("playlist options") << QString();
+    map.insert("playlist", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaPlaylist, params));
+
+    params.clear();
+    params << QString() << tr("opens jump dialog") << QString();
+    map.insert("jump", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaJump, params));
+
+    params.clear();
+    params << QString() << tr("toggles dim desktop") << QString();
+    map.insert("dim", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaDim, params));
+
+    params.clear();
+    params << QString() << tr("toggles output textbox") << QString();
+    map.insert("output", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaOutput, params));
+
+    params.clear();
+    params << QString() << tr("opens preferences dialog") << QString();
+    map.insert("preferences", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaPreferences, params));
+
+    params.clear();
+    params << QString() << tr("launches online help") << QString();
+    map.insert("online_help", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaOnlineHelp, params));
+
+    params.clear();
+    params << tr("[file]") << tr("opens the open file dialog or the file specified") << QString();
+    map.insert("open", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaOpen, params));
+
+    params.clear();
+    params << QString() << tr("toggle play/pause state") << QString();
+    map.insert("play_pause", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaPlayPause, params));
+
+    params.clear();
+    params << tr("[percent]") << tr("fit the window") << QString();
+    map.insert("fitwindow", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaFitWindow, params));
+
+    params.clear();
+    params << QString() << tr("toggle deinterlace") << QString();
+    map.insert("deinterlace", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaDeinterlace, params));
+
+    params.clear();
+    params << QString() << tr("toggle motion interpolation") << QString();
+    map.insert("interpolate", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaInterpolate, params));
+
+    params.clear();
+    params << QString() << tr("mutes the audio") << QString();
+    map.insert("mute", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaMute, params));
+
+    params.clear();
+    params << tr("[level]") << tr("adjusts the volume") << QString();
+    map.insert("volume", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaVolume, params));
+
+    params.clear();
+    params << tr("[ratio]") << tr("adjusts the speed") << QString();
+    map.insert("speed", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaSpeed, params));
+
+    params.clear();
+    params << QString() << tr("toggles fullscreen state") << QString();
+    map.insert("fullscreen", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaFullScreen, params));
+
+    params.clear();
+    params << QString() << tr("toggles hide all controls state") << QString();
+    map.insert("hide_all_controls", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaHideAllControls, params));
+
+    params.clear();
+    params << QString() << tr("pause and hide the window") << QString();
+    map.insert("boss", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaBoss, params));
+
+    params.clear();
+    params << QString() << tr("clears the output textbox") << QString();
+    map.insert("clear", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaClear, params));
+
+    params.clear();
+    params << tr("[command]") << tr("internal help menu") << QString();
+    map.insert("help", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaHelp, params));
+
+    params.clear();
+    params << tr("[qt]") << tr("open about dialog") << QString();
+    map.insert("about", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaAbout, params));
+
+    params.clear();
+    params << tr("[level]") << tr("set mpv msg-level") << QString();
+    map.insert("msg_level", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaMsgLevel, params));
+
+    params.clear();
+    params << QString() << tr("quit baka-mplayer") << QString();
+    map.insert("quit", QPair<BakaCommandFPtr, QStringList>(&BakaEngine::BakaQuit, params));
+
+    return map;
+}
diff --git a/src/bakaengine.h b/src/bakaengine.h
index fefad77..ecf1a7f 100644
--- a/src/bakaengine.h
+++ b/src/bakaengine.h
@@ -14,7 +14,6 @@ class MpvHandler;
 class Settings;
 class GestureHandler;
 class OverlayHandler;
-class UpdateManager;
 class DimDialog;
 
 class BakaEngine : public QObject
@@ -29,7 +28,6 @@ public:
     Settings       *settings;
     GestureHandler *gesture;
     OverlayHandler *overlay;
-    UpdateManager  *update;
     DimDialog      *dimDialog;
 
     QSystemTrayIcon *sysTrayIcon;
@@ -39,61 +37,13 @@ public:
                     *qtTranslator;
 
     // input hash-table provides O(1) input-command lookups
-    QHash<QString, QPair<QString, QString>> input; // [shortcut] = QPair<command, comment>
+    QHash<QString, QPair<QString, QString> > input; // [shortcut] = QPair<command, comment>
 
     // the following are the default input bindings
     // they are loaded into the input before parsing the settings file
     // when saving the settings file we don't save things that appear here
-    const QHash<QString, QPair<QString, QString>> default_input = {
-        {"Ctrl++",          {"mpv add sub-scale +0.1",              tr("Increase sub size")}},
-        {"Ctrl+-",          {"mpv add sub-scale -0.1",              tr("Decrease sub size")}},
-        {"Ctrl+W",          {"mpv cycle sub-visibility",            tr("Toggle subtitle visibility")}},
-        {"Ctrl+R",          {"mpv set time-pos 0",                  tr("Restart playback")}},
-        {"PgDown",          {"mpv add chapter +1",                  tr("Go to next chapter")}},
-        {"PgUp",            {"mpv add chapter -1",                  tr("Go to previous chapter")}},
-        {"Right",           {"mpv seek +5",                         tr("Seek forwards by %0 sec").arg("5")}},
-        {"Left",            {"mpv seek -5",                         tr("Seek backwards by %0 sec").arg("5")}},
-        {"Up",              {"mpv seek +30",                        tr("Seek forwards by %0 sec").arg("30")}},
-        {"Down",            {"mpv seek -30",                        tr("Seek backwards by %0 sec").arg("30")}},
-        {"Shift+Left",      {"mpv frame-back-step",                 tr("Frame step backwards")}},
-        {"Shift+Right",     {"mpv frame-step",                      tr("Frame step")}},
-        {"Ctrl+M",          {"mute",                                tr("Toggle mute audio")}},
-        {"Ctrl+T",          {"screenshot subtitles",                tr("Take screenshot with subtitles")}},
-        {"Ctrl+Shift+T",    {"screenshot",                          tr("Take screenshot without subtitles")}},
-        {"Ctrl+Down",       {"volume -5",                           tr("Decrease volume")}},
-        {"Ctrl+Up",         {"volume +5",                           tr("Increase volume")}},
-        {"Ctrl+Shift+Up",   {"speed +0.1",                          tr("Increase playback speed by %0").arg("10")}},
-        {"Ctrl+Shift+Down", {"speed -0.1",                          tr("Decrease playback speed by %0").arg("10")}},
-        {"Ctrl+Shift+R",    {"speed 1.0",                           tr("Reset speed")}},
-        {"Alt+Return",      {"fullscreen",                          tr("Toggle fullscreen")}},
-        {"Ctrl+H",          {"hide_all_controls",                   tr("Toggle hide all controls mode")}},
-        {"Ctrl+D",          {"dim",                                 tr("Dim lights")}},
-        {"Ctrl+E",          {"show_in_folder",                      tr("Show the file in its folder")}},
-        {"Tab",             {"media_info",                          tr("View media information")}},
-        {"Ctrl+J",          {"jump",                                tr("Show jump to time dialog")}},
-        {"Ctrl+N",          {"new",                                 tr("Open a new window")}},
-        {"Ctrl+O",          {"open",                                tr("Show open file dialog")}},
-        {"Ctrl+Q",          {"quit",                                tr("Quit")}},
-        {"Ctrl+Right",      {"playlist play +1",                    tr("Play next file")}},
-        {"Ctrl+Left",       {"playlist play -1",                    tr("Play previous file")}},
-        {"Ctrl+S",          {"stop",                                tr("Stop playback")}},
-        {"Ctrl+U",          {"open_location",                       tr("Show location dialog")}},
-        {"Ctrl+V",          {"open_clipboard",                      tr("Open clipboard location")}},
-        {"Ctrl+F",          {"playlist toggle",                     tr("Toggle playlist visibility")}},
-        {"Ctrl+Z",          {"open_recent 0",                       tr("Open the last played file")}},
-        {"Ctrl+`",          {"output",                              tr("Access command-line")}},
-        {"F1",              {"online_help",                         tr("Launch online help")}},
-        {"Space",           {"play_pause",                          tr("Play/Pause")}},
-        {"Alt+1",           {"fitwindow",                           tr("Fit the window to the video")}},
-        {"Alt+2",           {"fitwindow 50",                        tr("Fit window to %0%").arg("50")}},
-        {"Alt+3",           {"fitwindow 75",                        tr("Fit window to %0%").arg("75")}},
-        {"Alt+4",           {"fitwindow 100",                       tr("Fit window to %0%").arg("100")}},
-        {"Alt+5",           {"fitwindow 150",                       tr("Fit window to %0%").arg("150")}},
-        {"Alt+6",           {"fitwindow 200",                       tr("Fit window to %0%").arg("200")}},
-        {"Esc",             {"boss",                                tr("Boss key")}},
-        {"Return",          {"playlist play",                       tr("Play selected file on playlist")}},
-        {"Del",             {"playlist remove",                     tr("Remove selected file from playlist")}}
-    };
+    static QHash<QString, QPair<QString, QString> > initDefaultInput();
+    const QHash<QString, QPair<QString, QString> > default_input;
 
 public slots:
     void LoadSettings();
@@ -109,6 +59,10 @@ protected slots:
     void InvalidParameter(QString);
     void RequiresParameters(QString);
 
+    // Slots for message handling
+    void handleMpvMessage(QString msg);
+    void handleProcessReadyRead();
+
     // Settings Loading
     void Load2_0_3();
 
@@ -123,313 +77,9 @@ private:
 
     // todo: write advanced information about commands
     typedef void(BakaEngine::*BakaCommandFPtr)(QStringList&);
-    const QHash<QString, QPair<BakaCommandFPtr, QStringList>> BakaCommandMap = {
-        {"mpv", // command
-         {&BakaEngine::BakaMpv,
-          {
-           // params     description
-           QString(), tr("executes mpv command"),
-           QString() // advanced
-          }
-         }
-        },
-        {"sh",
-         {&BakaEngine::BakaSh,
-          {
-           QString(), tr("executes system shell command"),
-           QString()
-          }
-         }
-        },
-        {"new",
-         {&BakaEngine::BakaNew, // function pointer to command functionality
-          {
-           // params     description
-           QString(), tr("creates a new instance of baka-mplayer"),
-           QString()
-          }
-         }
-        },
-        {"open_location",
-         {&BakaEngine::BakaOpenLocation,
-          {
-           QString(),
-           tr("shows the open location dialog"),
-           QString()
-          }
-         }
-        },
-        {"open_clipboard",
-         {&BakaEngine::BakaOpenClipboard,
-          {
-           QString(),
-           tr("opens the clipboard"),
-           QString()
-          }
-         }
-        },
-        {"show_in_folder",
-         {&BakaEngine::BakaShowInFolder,
-          {
-           QString(),
-           tr("shows the current file in folder"),
-           QString()
-          }
-         }
-        },
-        {"add_subtitles",
-         {&BakaEngine::BakaAddSubtitles,
-          {
-           QString(),
-           tr("add subtitles dialog"),
-           QString()
-          }
-         }
-        },
-        {"add_audio",
-         {&BakaEngine::BakaAddAudio,
-          {
-           QString(),
-           tr("add audio track dialog"),
-           QString()
-          }
-         }
-        },
-        {"screenshot",
-         {&BakaEngine::BakaScreenshot,
-          {
-           tr("[subs]"),
-           tr("take a screenshot (with subtitles if specified)"),
-           QString()
-          }
-         }
-        },
-        {"media_info",
-         {&BakaEngine::BakaMediaInfo,
-          {
-           QString(),
-           tr("toggles media info display"),
-           QString()
-          }
-         }
-        },
-        {"stop",
-         {&BakaEngine::BakaStop,
-          {
-           QString(),
-           tr("stops the current playback"),
-           QString()
-          }
-         }
-        },
-        {"playlist",
-         {&BakaEngine::BakaPlaylist,
-          {
-           "[...]",
-           tr("playlist options"),
-           QString()
-          }
-         }
-        },
-        {"jump",
-         {&BakaEngine::BakaJump,
-          {
-           QString(),
-           tr("opens jump dialog"),
-           QString()
-          }
-         }
-        },
-        {"dim",
-         {&BakaEngine::BakaDim,
-          {
-           QString(),
-           tr("toggles dim desktop"),
-           QString()
-          }
-         }
-        },
-        {"output",
-         {&BakaEngine::BakaOutput,
-          {
-           QString(),
-           tr("toggles output textbox"),
-           QString()
-          }
-         }
-        },
-        {"preferences",
-         {&BakaEngine::BakaPreferences,
-          {
-           QString(),
-           tr("opens preferences dialog"),
-           QString()
-          }
-         }
-        },
-        {"online_help",
-         {&BakaEngine::BakaOnlineHelp,
-          {
-           QString(),
-           tr("launches online help"),
-           QString()
-          }
-         }
-        },
-        {"update",
-         {&BakaEngine::BakaUpdate,
-          {
-           QString(),
-           tr("opens the update dialog or updates youtube-dl"),
-           QString()
-          }
-         }
-        },
-        {"open",
-         {&BakaEngine::BakaOpen,
-          {
-           tr("[file]"),
-           tr("opens the open file dialog or the file specified"),
-           QString()
-          }
-         }
-        },
-        {"play_pause",
-         {&BakaEngine::BakaPlayPause,
-          {
-           QString(),
-           tr("toggle play/pause state"),
-           QString()
-          }
-         }
-        },
-        {"fitwindow",
-         {&BakaEngine::BakaFitWindow,
-          {
-           tr("[percent]"),
-           tr("fit the window"),
-           QString()
-          }
-         }
-        },
-        {"deinterlace",
-         {&BakaEngine::BakaDeinterlace,
-          {
-           QString(),
-           tr("toggle deinterlace"),
-           QString()
-          }
-         }
-        },
-        {"interpolate",
-         {&BakaEngine::BakaInterpolate,
-          {
-           QString(),
-           tr("toggle motion interpolation"),
-           QString()
-          }
-         }
-        },
-        {"mute",
-         {&BakaEngine::BakaMute,
-          {
-           QString(),
-           tr("mutes the audio"),
-           QString()
-          },
-         }
-        },
-        {"volume",
-         {&BakaEngine::BakaVolume,
-          {
-           tr("[level]"),
-           tr("adjusts the volume"),
-           QString()
-          }
-         }
-        },
-        {"speed",
-         {&BakaEngine::BakaSpeed,
-          {
-           tr("[ratio]"),
-           tr("adjusts the speed"),
-           QString()
-          }
-         }
-        },
-        {"fullscreen",
-         {&BakaEngine::BakaFullScreen,
-          {
-           QString(),
-           tr("toggles fullscreen state"),
-           QString()
-          }
-         }
-        },
-        {"hide_all_controls",
-         {&BakaEngine::BakaHideAllControls,
-          {
-           QString(),
-           tr("toggles hide all controls state"),
-           QString()
-          }
-         }
-        },
-        {"boss",
-         {&BakaEngine::BakaBoss,
-          {
-           QString(),
-           tr("pause and hide the window"),
-           QString()
-          }
-         }
-        },
-        {"clear",
-         {&BakaEngine::BakaClear,
-          {
-           QString(),
-           tr("clears the output textbox"),
-           QString()
-          }
-         }
-        },
-        {"help",
-         {&BakaEngine::BakaHelp,
-          {
-           tr("[command]"),
-           tr("internal help menu"),
-           QString()
-          }
-         }
-        },
-        {"about",
-         {&BakaEngine::BakaAbout,
-          {
-           tr("[qt]"),
-           tr("open about dialog"),
-           QString()
-          }
-         }
-        },
-        {"msg_level",
-         {&BakaEngine::BakaMsgLevel,
-          {
-           tr("[level]"),
-           tr("set mpv msg-level"),
-           QString()
-          }
-         }
-        },
-        {"quit",
-         {&BakaEngine::BakaQuit,
-          {
-           QString(),
-           tr("quit baka-mplayer"),
-           QString()
-          }
-         }
-        }
-    };
+    static QHash<QString, QPair<BakaCommandFPtr, QStringList> > initBakaCommandMap();
+    const QHash<QString, QPair<BakaCommandFPtr, QStringList> > BakaCommandMap;
+
     // Baka Command Functions
     void BakaMpv(QStringList&);
     void BakaSh(QStringList&);
@@ -448,7 +98,6 @@ private:
     void BakaOutput(QStringList&);
     void BakaPreferences(QStringList&);
     void BakaOnlineHelp(QStringList&);
-    void BakaUpdate(QStringList&);
     void BakaOpen(QStringList&);
     void BakaPlayPause(QStringList&);
     void BakaFitWindow(QStringList&);
diff --git a/src/gesturehandler.cpp b/src/gesturehandler.cpp
index 2328442..f1937d1 100644
--- a/src/gesturehandler.cpp
+++ b/src/gesturehandler.cpp
@@ -11,7 +11,7 @@
 GestureHandler::GestureHandler(QObject *parent):
     QObject(parent),
     baka(static_cast<BakaEngine*>(parent)),
-    elapsedTimer(nullptr)
+    elapsedTimer(0)
 {
     timer_threshold = 10; // 10ms works quite well
     gesture_threshold = 15; // 15 pixels is probably fine for anything
@@ -22,7 +22,7 @@ GestureHandler::~GestureHandler()
     if(elapsedTimer)
     {
         delete elapsedTimer;
-        elapsedTimer = nullptr;
+        elapsedTimer = 0;
     }
 }
 
@@ -95,7 +95,7 @@ bool GestureHandler::End()
     if(elapsedTimer)
     {
         delete elapsedTimer;
-        elapsedTimer = nullptr;
+        elapsedTimer = 0;
         QApplication::restoreOverrideCursor();
     }
     else
diff --git a/src/mpvhandler.cpp b/src/mpvhandler.cpp
index e973139..d211642 100644
--- a/src/mpvhandler.cpp
+++ b/src/mpvhandler.cpp
@@ -19,7 +19,18 @@ static void wakeup(void *ctx)
 
 MpvHandler::MpvHandler(int64_t wid, QObject *parent):
     QObject(parent),
-    baka(static_cast<BakaEngine*>(parent))
+    baka(static_cast<BakaEngine*>(parent)),
+    mpv(0),
+    playState(Mpv::Idle),
+    speed(1),
+    time(0),
+    lastTime(0),
+    volume(100),
+    index(0),
+    init(false),
+    playlistVisible(false),
+    subtitleVisibility(true),
+    mute(false)
 {
     // create mpv
     mpv = mpv_create();
@@ -27,7 +38,17 @@ MpvHandler::MpvHandler(int64_t wid, QObject *parent):
         throw "Could not create mpv object";
 
     // set mpv options
+#if !defined(Q_OS_MAC) && !defined(Q_OS_DARWIN) && !defined(__APPLE__)
+    // On Linux/Windows: embed video in Qt widget
     mpv_set_option(mpv, "wid", MPV_FORMAT_INT64, &wid);
+#else
+    // On macOS with Qt4: use null video output (audio-only mode)
+    // mpv's Cocoa backend conflicts with Qt4's Cocoa integration
+    // Using vo=null allows audio playback without video window
+    mpv_set_option_string(mpv, "vo", "null");
+    mpv_set_option_string(mpv, "force-window", "no");
+    (void)wid; // suppress unused parameter warning
+#endif
     mpv_set_option_string(mpv, "input-cursor", "no");   // no mouse handling
     mpv_set_option_string(mpv, "cursor-autohide", "no");// no cursor-autohide, we handle that
     mpv_set_option_string(mpv, "ytdl", "yes"); // youtube-dl support
@@ -82,8 +103,9 @@ QString MpvHandler::getMediaInfo()
     int vtracks = 0,
         atracks = 0;
 
-    for(auto &track : fileInfo.tracks)
+    for(int i = 0; i < fileInfo.tracks.size(); ++i)
     {
+        const Mpv::Track &track = fileInfo.tracks[i];
         if(track.type == "video")
             ++vtracks;
         else if(track.type == "audio")
@@ -117,16 +139,20 @@ QString MpvHandler::getMediaInfo()
     {
         out += outer.arg(tr("Chapters"), QString());
         int n = 1;
-        for(auto &chapter : fileInfo.chapters)
-            out += inner.arg(QString::number(n++), chapter.title);
+        for(int i = 0; i < fileInfo.chapters.size(); ++i)
+            out += inner.arg(QString::number(n++), fileInfo.chapters[i].title);
         out += '\n';
     }
 
     if(fileInfo.metadata.size() > 0)
     {
         out += outer.arg(tr("Metadata"), QString());
-        for(auto data = fileInfo.metadata.begin(); data != fileInfo.metadata.end(); ++data)
+        QMap<QString, QString>::const_iterator data = fileInfo.metadata.begin();
+        while(data != fileInfo.metadata.end())
+        {
             out += inner.arg(data.key(), *data);
+            ++data;
+        }
         out += '\n';
     }
 
@@ -140,7 +166,7 @@ bool MpvHandler::event(QEvent *event)
         while(mpv)
         {
             mpv_event *event = mpv_wait_event(mpv, 0);
-            if(event == nullptr ||
+            if(event == 0 ||
                event->event_id == MPV_EVENT_NONE)
             {
                 break;
@@ -252,7 +278,7 @@ bool MpvHandler::event(QEvent *event)
             case MPV_EVENT_LOG_MESSAGE:
             {
                 mpv_event_log_message *message = static_cast<mpv_event_log_message*>(event->data);
-                if(message != nullptr)
+                if(message != 0)
                     emit messageSignal(message->text);
                 break;
             }
@@ -317,12 +343,12 @@ QString MpvHandler::LoadPlaylist(QString f)
     if(f == "-")
     {
         setPath("");
-        setPlaylist({f});
+        setPlaylist(QStringList() << f);
     }
     else if(Util::IsValidUrl(f)) // web url
     {
         setPath("");
-        setPlaylist({f});
+        setPlaylist(QStringList() << f);
     }
     else // local file
     {
@@ -604,11 +630,11 @@ void MpvHandler::AddSubtitleTrack(QString f)
     const char *args[] = {"sub-add", tmp.constData(), NULL};
     Command(args);
     // this could be more efficient if we saved tracks in a bst
-    auto old = fileInfo.tracks; // save the current track-list
+    QList<Mpv::Track> old = fileInfo.tracks; // save the current track-list
     LoadTracks(); // load the new track list
-    auto current = fileInfo.tracks;
-    for(auto track : old) // remove the old tracks in current
-        current.removeOne(track);
+    QList<Mpv::Track> current = fileInfo.tracks;
+    for(int i = 0; i < old.size(); ++i) // remove the old tracks in current
+        current.removeOne(old[i]);
     Mpv::Track &track = current.first();
     ShowText(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.external ? "external" : track.lang));
 }
@@ -620,11 +646,11 @@ void MpvHandler::AddAudioTrack(QString f)
     const QByteArray tmp = f.toUtf8();
     const char *args[] = {"audio-add", tmp.constData(), NULL};
     Command(args);
-    auto old = fileInfo.tracks;
+    QList<Mpv::Track> old = fileInfo.tracks;
     LoadTracks();
-    auto current = fileInfo.tracks;
-    for(auto track : old)
-        current.removeOne(track);
+    QList<Mpv::Track> current = fileInfo.tracks;
+    for(int i = 0; i < old.size(); ++i)
+        current.removeOne(old[i]);
     Mpv::Track &track = current.first();
     ShowText(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.external ? "external" : track.lang));
 }
@@ -653,15 +679,16 @@ void MpvHandler::Interpolate(bool interpolate)
     if(vo == QString())
         vo = mpv_get_property_string(mpv, "current-vo");
     QStringList vos = vo.split(',');
-    for(auto &o : vos)
+    for(int j = 0; j < vos.size(); ++j)
     {
+        QString &o = vos[j];
         int i = o.indexOf(":interpolation");
         if(interpolate && i == -1)
             o.append(":interpolation");
         else if(i != -1)
             o.remove(i, QString(":interpolation").length());
     }
-    setVo(vos.join(','));
+    setVo(vos.join(QString(",")));
     SetOption("vo", vo);
     ShowText(tr("Motion Interpolation: %0").arg(interpolate ? tr("enabled") : tr("disabled")));
 }
@@ -916,8 +943,8 @@ QString MpvHandler::PopulatePlaylist()
             filter.append(QString("*.%1").arg(file.split(".").last()));
         QFileInfoList flist;
         flist = root.entryInfoList(filter, QDir::Files);
-        for(auto &i : flist)
-            playlist.push_back(i.fileName()); // add files to the list
+        for(int i = 0; i < flist.size(); ++i)
+            playlist.push_back(flist[i].fileName()); // add files to the list
         setPlaylist(playlist);
         if(playlist.empty())
             return QString();
diff --git a/src/mpvhandler.h b/src/mpvhandler.h
index bcf80eb..f44cf48 100644
--- a/src/mpvhandler.h
+++ b/src/mpvhandler.h
@@ -174,10 +174,10 @@ signals:
 
 private:
     BakaEngine *baka;
-    mpv_handle *mpv = nullptr;
+    mpv_handle *mpv;
 
     // variables
-    Mpv::PlayState playState = Mpv::Idle;
+    Mpv::PlayState playState;
     Mpv::FileInfo fileInfo;
     QString     file,
                 path,
@@ -187,18 +187,18 @@ private:
                 suffix,
                 vo,
                 msgLevel;
-    double      speed = 1;
-    int         time = 0,
-                lastTime = 0,
-                volume = 100,
-                index = 0,
+    double      speed;
+    int         time,
+                lastTime,
+                volume,
+                index,
                 vid,
                 aid,
                 sid;
-    bool        init = false,
-                playlistVisible = false,
-                subtitleVisibility = true,
-                mute = false;
+    bool        init,
+                playlistVisible,
+                subtitleVisibility,
+                mute;
     int         osdWidth,
                 osdHeight;
 };
diff --git a/src/mpvtypes.cpp b/src/mpvtypes.cpp
new file mode 100644
index 0000000..7b0aed7
--- /dev/null
+++ b/src/mpvtypes.cpp
@@ -0,0 +1,37 @@
+#include "mpvtypes.h"
+
+namespace Mpv
+{
+    QStringList initAudioFiletypes()
+    {
+        QStringList list;
+        list << "*.mp3" << "*.ogg" << "*.wav" << "*.wma" << "*.m4a" << "*.aac"
+             << "*.ac3" << "*.ape" << "*.flac" << "*.ra" << "*.mka" << "*.dts" << "*.opus";
+        return list;
+    }
+
+    QStringList initVideoFiletypes()
+    {
+        QStringList list;
+        list << "*.avi" << "*.divx" << "*.mpg" << "*.mpeg" << "*.m1v" << "*.m2v" << "*.mpv" << "*.dv"
+             << "*.3gp" << "*.mov" << "*.mp4" << "*.m4v" << "*.mqv" << "*.dat" << "*.vcd" << "*.ogm"
+             << "*.ogv" << "*.asf" << "*.wmv" << "*.vob" << "*.mkv" << "*.ram" << "*.flv" << "*.rm"
+             << "*.ts" << "*.rmvb" << "*.dvr-ms" << "*.m2t" << "*.m2ts" << "*.rec" << "*.f4v"
+             << "*.hdmov" << "*.webm" << "*.vp8" << "*.letv" << "*.hlv" << "*.mts";
+        return list;
+    }
+
+    QStringList initSubtitleFiletypes()
+    {
+        QStringList list;
+        list << "*.sub" << "*.srt" << "*.ass" << "*.ssa" << "*.smi" << "*.rt"
+             << "*.txt" << "*.mks" << "*.vtt" << "*.sup";
+        return list;
+    }
+
+    const QStringList audio_filetypes = initAudioFiletypes();
+    const QStringList video_filetypes = initVideoFiletypes();
+    const QStringList media_filetypes = audio_filetypes + video_filetypes;
+    const QStringList subtitle_filetypes = initSubtitleFiletypes();
+}
+
diff --git a/src/mpvtypes.h b/src/mpvtypes.h
index 646fdea..e3b87f8 100644
--- a/src/mpvtypes.h
+++ b/src/mpvtypes.h
@@ -10,10 +10,10 @@
 namespace Mpv
 {
     // filetypes supported by mpv: https://github.com/mpv-player/mpv/blob/master/player/external_files.c
-    const QStringList audio_filetypes = {"*.mp3","*.ogg","*.wav","*.wma","*.m4a","*.aac","*.ac3","*.ape","*.flac","*.ra","*.mka","*.dts","*.opus"},
-                      video_filetypes = {"*.avi","*.divx","*.mpg","*.mpeg","*.m1v","*.m2v","*.mpv","*.dv","*.3gp","*.mov","*.mp4","*.m4v","*.mqv","*.dat","*.vcd","*.ogm","*.ogv","*.asf","*.wmv","*.vob","*.mkv","*.ram","*.flv","*.rm","*.ts","*.rmvb","*.dvr-ms","*.m2t","*.m2ts","*.rec","*.f4v","*.hdmov","*.webm","*.vp8","*.letv","*.hlv","*.mts"},
-                      media_filetypes = audio_filetypes + video_filetypes,
-                      subtitle_filetypes = {"*.sub","*.srt","*.ass","*.ssa","*.smi","*.rt","*.txt","*.mks","*.vtt","*.sup"};
+    extern const QStringList audio_filetypes;
+    extern const QStringList video_filetypes;
+    extern const QStringList media_filetypes;
+    extern const QStringList subtitle_filetypes;
 
     enum PlayState
     {
@@ -50,12 +50,13 @@ namespace Mpv
     };
     struct VideoParams
     {
+        VideoParams() : width(0), height(0), dwidth(0), dheight(0), aspect(0) {}
         QString codec;
-        int width = 0,
-            height = 0,
-            dwidth = 0,
-            dheight = 0;
-        double aspect = 0;
+        int width,
+            height,
+            dwidth,
+            dheight;
+        double aspect;
     };
     struct AudioParams
     {
@@ -66,8 +67,9 @@ namespace Mpv
 
     struct FileInfo
     {
+        FileInfo() : length(0) {}
         QString media_title;
-        int length = 0;
+        int length;
         QMap<QString, QString> metadata;
         VideoParams video_params;
         AudioParams audio_params;
diff --git a/src/overlay.cpp b/src/overlay.cpp
index 1599263..ed20eb1 100644
--- a/src/overlay.cpp
+++ b/src/overlay.cpp
@@ -12,6 +12,6 @@ Overlay::~Overlay()
 {
     delete label;
     delete canvas;
-    if(timer != nullptr)
+    if(timer != 0)
         delete timer;
 }
diff --git a/src/overlayhandler.cpp b/src/overlayhandler.cpp
index db5819a..38edb92 100644
--- a/src/overlayhandler.cpp
+++ b/src/overlayhandler.cpp
@@ -23,7 +23,7 @@
 OverlayHandler::OverlayHandler(QObject *parent):
     QObject(parent),
     baka(static_cast<BakaEngine*>(parent)),
-    refresh_timer(nullptr),
+    refresh_timer(0),
     min_overlay(1),
     max_overlay(60),
     overlay_id(min_overlay)
@@ -32,8 +32,8 @@ OverlayHandler::OverlayHandler(QObject *parent):
 
 OverlayHandler::~OverlayHandler()
 {
-    for(auto o : overlays)
-        delete o;
+    for(QHash<int, Overlay*>::const_iterator it = overlays.constBegin(); it != overlays.constEnd(); ++it)
+        delete it.value();
 }
 
 void OverlayHandler::showStatusText(const QString &text, int duration)
@@ -51,12 +51,12 @@ void OverlayHandler::showInfoText(bool show)
 {
     if(show) // show media info
     {
-        if(refresh_timer == nullptr)
+        if(refresh_timer == 0)
         {
             refresh_timer = new QTimer(this);
             refresh_timer->setSingleShot(true);
-            connect(refresh_timer, &QTimer::timeout, // on timeout
-                    [=] { showInfoText(); });
+            connect(refresh_timer, SIGNAL(timeout()),
+                    this, SLOT(handleRefreshTimeout()));
         }
         refresh_timer->start(OVERLAY_REFRESH_RATE);
         showText(baka->mpv->getMediaInfo(),
@@ -67,7 +67,7 @@ void OverlayHandler::showInfoText(bool show)
     else // hide media info
     {
         delete refresh_timer;
-        refresh_timer = nullptr;
+        refresh_timer = 0;
         remove(OVERLAY_INFO);
     }
 }
@@ -92,8 +92,8 @@ void OverlayHandler::showText(const QString &text, QFont font, QColor color, QPo
     const float fm_correction = 1.3;
     int w = 0,
         h = fm.height()*lines.length();
-    for(auto line : lines)
-        w = std::max(fm.width(line), w);
+    for(int i = 0; i < lines.length(); ++i)
+        w = std::max(fm.width(lines[i]), w);
     float xF = float(baka->window->ui->mpvFrame->width()-2*pos.x()) / (fm_correction*w);
     float yF = float(baka->window->ui->mpvFrame->height()-2*pos.y()) / h;
     font.setPointSizeF(std::min(font.pointSizeF()*std::min(xF, yF), font.pointSizeF()));
@@ -102,10 +102,10 @@ void OverlayHandler::showText(const QString &text, QFont font, QColor color, QPo
     h = fm.height();
     w = 0;
     QPainterPath path(QPoint(0, 0));
-    QPoint p = QPoint(0, h);
-    for(auto line : lines)
+    QPoint p(0, h);
+    for(int i = 0; i < lines.length(); ++i)
     {
-        path.addText(p, font, line);
+        path.addText(p, font, lines[i]);
         w = std::max(int(fm_correction*path.currentPosition().x()), w);
         p += QPoint(0, h);
     }
@@ -140,13 +140,14 @@ void OverlayHandler::showText(const QString &text, QFont font, QColor color, QPo
 
     QTimer *timer;
     if(duration == 0)
-        timer = nullptr;
+        timer = 0;
     else
     {
         timer = new QTimer(this);
+        timer->setProperty("overlayId", id);
         timer->start(duration);
-        connect(timer, &QTimer::timeout, // on timeout
-                [=] { remove(id); });
+        connect(timer, SIGNAL(timeout()),
+                this, SLOT(handleOverlayTimeout()));
     }
 
     if(overlays.find(id) != overlays.end())
@@ -166,3 +167,18 @@ void OverlayHandler::remove(int id)
     }
     overlay_mutex.unlock();
 }
+
+void OverlayHandler::handleRefreshTimeout()
+{
+    showInfoText();
+}
+
+void OverlayHandler::handleOverlayTimeout()
+{
+    QTimer *timer = qobject_cast<QTimer*>(sender());
+    if(timer)
+    {
+        int id = timer->property("overlayId").toInt();
+        remove(id);
+    }
+}
diff --git a/src/overlayhandler.h b/src/overlayhandler.h
index df5ec51..87d1253 100644
--- a/src/overlayhandler.h
+++ b/src/overlayhandler.h
@@ -28,6 +28,8 @@ public slots:
 
 protected slots:
     void remove(int id);
+    void handleRefreshTimeout();
+    void handleOverlayTimeout();
 
 private:
     BakaEngine *baka;
diff --git a/src/platform/linux.cpp b/src/platform/linux.cpp
index 67db843..ded39bf 100644
--- a/src/platform/linux.cpp
+++ b/src/platform/linux.cpp
@@ -2,11 +2,15 @@
 #include "settings.h"
 
 #include <QRegExp>
+#if QT_VERSION >= 0x050000
 #include <QStandardPaths>
+#include <QGuiApplication>
+#else
+#include <QApplication>
+#endif
 #include <QDesktopServices>
 #include <QDir>
 #include <QUrl>
-#include <QGuiApplication>
 
 #include <QX11Info>
 #include <X11/Xlib.h>
@@ -25,8 +29,10 @@ QString DownloadFileUrl()
 
 bool DimLightsSupported()
 {
+#if QT_VERSION >= 0x050000
     if(QGuiApplication::platformName().contains("wayland"))
         return false;
+#endif
     QString tmp = "_NET_WM_CM_S"+QString::number(QX11Info::appScreen());
     Atom a = XInternAtom(QX11Info::display(), tmp.toUtf8().constData(), false);
     if(a && XGetSelectionOwner(QX11Info::display(), a)) // hack for QX11Info::isCompositingManagerRunning()
@@ -36,8 +42,10 @@ bool DimLightsSupported()
 
 void SetAlwaysOnTop(WId wid, bool ontop)
 {
+#if QT_VERSION >= 0x050000
     if(QGuiApplication::platformName().contains("wayland"))
         return;
+#endif
     Display *display = QX11Info::display();
     XEvent event;
     event.xclient.type = ClientMessage;
@@ -61,11 +69,15 @@ void SetAlwaysOnTop(WId wid, bool ontop)
 QString SettingsLocation()
 {
     // saves to  ~/.config/${SETTINGS_FILE}.ini
-    QString s1  = QStandardPaths::writableLocation(QStandardPaths::ConfigLocation);
-    QString s2 = SETTINGS_FILE;
+#if QT_VERSION >= 0x050000
     return QString("%0/%1.ini").arg(
             QStandardPaths::writableLocation(QStandardPaths::ConfigLocation),
             SETTINGS_FILE);
+#else
+    return QString("%0/%1.ini").arg(
+            QDesktopServices::storageLocation(QDesktopServices::DataLocation),
+            SETTINGS_FILE);
+#endif
 }
 
 bool IsValidFile(QString path)
diff --git a/src/platform/osx.cpp b/src/platform/osx.cpp
index 87d67cb..5f76865 100644
--- a/src/platform/osx.cpp
+++ b/src/platform/osx.cpp
@@ -2,7 +2,9 @@
 #include "settings.h"
 
 #include <QRegExp>
+#if QT_VERSION >= 0x050000
 #include <QStandardPaths>
+#endif
 #include <QDesktopServices>
 #include <QDir>
 #include <QUrl>
@@ -43,11 +45,15 @@ void SetAlwaysOnTop(WId wid, bool ontop)
 QString SettingsLocation()
 {
     // saves to  ~/.config/${SETTINGS_FILE}.ini
-    QString s1  = QStandardPaths::writableLocation(QStandardPaths::ConfigLocation);
-    QString s2 = SETTINGS_FILE;
+#if QT_VERSION >= 0x050000
     return QString("%0/%1.ini").arg(
             QStandardPaths::writableLocation(QStandardPaths::ConfigLocation),
             SETTINGS_FILE);
+#else
+    return QString("%0/%1.ini").arg(
+            QDesktopServices::storageLocation(QDesktopServices::DataLocation),
+            SETTINGS_FILE);
+#endif
 }
 
 bool IsValidFile(QString path)
diff --git a/src/recent.h b/src/recent.h
index 570cf7b..a596550 100644
--- a/src/recent.h
+++ b/src/recent.h
@@ -18,6 +18,21 @@ struct Recent
         return (path == recent.path);
     }
 
+    bool operator!=(const Recent &recent) const
+    {
+        return (path != recent.path);
+    }
+
+    bool operator==(const QString &str) const
+    {
+        return (path == str);
+    }
+
+    bool operator!=(const QString &str) const
+    {
+        return (path != str);
+    }
+
     QString path,
             title;
     int     time;
diff --git a/src/settings.cpp b/src/settings.cpp
index 18dbde6..9ab3f0c 100644
--- a/src/settings.cpp
+++ b/src/settings.cpp
@@ -79,12 +79,15 @@ void Settings::LoadIni()
         if(root.find("input") != root.end())
         {
             QJsonObject input_obj = root["input"].toObject();
-            for(auto in : input_obj)
+            QStringList input_keys = input_obj.keys();
+            for(int i = 0; i < input_keys.length(); ++i)
             {
+                QString key = input_keys[i];
                 QJsonArray opts;
-                for(auto &o : in.toString().split('#'))
-                    opts.append(o.trimmed());
-                in = opts;
+                QStringList parts = input_obj[key].toString().split('#');
+                for(int j = 0; j < parts.length(); ++j)
+                    opts.append(parts[j].trimmed());
+                input_obj[key] = opts;
             }
             root["input"] = input_obj;
         }
@@ -94,10 +97,10 @@ void Settings::LoadIni()
         {
             QStringList recent = SplitQStringList(root["recent"].toString());
             QJsonArray R;
-            for(auto str : recent)
+            for(int i = 0; i < recent.length(); ++i)
             {
                 QJsonObject r;
-                r["path"] = str;
+                r["path"] = recent[i];
                 R.append(r);
             }
             root["recent"] = R;
diff --git a/src/settings.h b/src/settings.h
index 1933646..c0754e3 100644
--- a/src/settings.h
+++ b/src/settings.h
@@ -6,10 +6,18 @@
 #include <QString>
 #include <QStringList>
 #include <QDate>
+
+#if QT_VERSION >= 0x050000
 #include <QJsonDocument>
 #include <QJsonObject>
 #include <QJsonArray>
 #include <QJsonValue>
+#else
+#include <QJsonDocument.h>
+#include <QJsonObject.h>
+#include <QJsonArray.h>
+#include <QJsonValue.h>
+#endif
 
 class BakaEngine;
 
diff --git a/src/ui/inputdialog.ui b/src/ui/inputdialog.ui
index 55b2027..59cdf82 100644
--- a/src/ui/inputdialog.ui
+++ b/src/ui/inputdialog.ui
@@ -97,9 +97,6 @@ QPushButton:disabled {
       </property>
       <item>
        <widget class="QLineEdit" name="inputLineEdit">
-        <property name="clearButtonEnabled">
-         <bool>true</bool>
-        </property>
        </widget>
       </item>
       <item>
diff --git a/src/ui/keydialog.cpp b/src/ui/keydialog.cpp
index 9c7cb8f..31c0a59 100644
--- a/src/ui/keydialog.cpp
+++ b/src/ui/keydialog.cpp
@@ -6,23 +6,17 @@ KeyDialog::KeyDialog(QWidget *parent) :
     ui(new Ui::KeyDialog)
 {
     ui->setupUi(this);
-    connect(ui->keySequenceEdit, &QKeySequenceEdit::keySequenceChanged,
-            [=](const QKeySequence&)
-            {
-                SetButtons();
-            });
+    ui->keySequenceEdit->setReadOnly(true);
+    ui->keySequenceEdit->installEventFilter(this);
 
-    connect(ui->commandLineEdit, &QLineEdit::textChanged,
-            [=](const QString&)
-            {
-                SetButtons();
-            });
+    connect(ui->keySequenceEdit, SIGNAL(textChanged(QString)),
+            this, SLOT(handleKeySequenceChanged(QString)));
 
-    connect(ui->clearButton, &QPushButton::pressed,
-            [=]
-            {
-                ui->keySequenceEdit->clear();
-            });
+    connect(ui->commandLineEdit, SIGNAL(textChanged(QString)),
+            this, SLOT(handleCommandTextChanged(QString)));
+
+    connect(ui->clearButton, SIGNAL(pressed()),
+            this, SLOT(handleClearButtonPressed()));
 
     connect(ui->addButton, SIGNAL(pressed()),
             this, SLOT(accept()));
@@ -37,26 +31,26 @@ KeyDialog::~KeyDialog()
     delete ui;
 }
 
-QPair<QString, QPair<QString, QString>> KeyDialog::SelectKey(bool add, QPair<QString, QPair<QString, QString>> init)
+QPair<QString, QPair<QString, QString> > KeyDialog::SelectKey(bool add, QPair<QString, QPair<QString, QString> > init)
 {
     this->add = add;
-    ui->keySequenceEdit->setKeySequence(QKeySequence(init.first));
+    ui->keySequenceEdit->setText(init.first);
     ui->commandLineEdit->setText(init.second.first);
     ui->labelLineEdit->setText(init.second.second);
     SetButtons();
     if(exec() == QDialog::Rejected)
-        return QPair<QString, QPair<QString, QString>>();
-    return QPair<QString, QPair<QString, QString>>({
-        ui->keySequenceEdit->keySequence().toString(),
-        {ui->commandLineEdit->text(),
-         ui->labelLineEdit->text()}
-    });
+        return QPair<QString, QPair<QString, QString> >();
+    return qMakePair(
+        ui->keySequenceEdit->text(),
+        qMakePair(ui->commandLineEdit->text(),
+         ui->labelLineEdit->text())
+    );
 }
 
 void KeyDialog::SetButtons()
 {
     bool enabled =
-        (!ui->keySequenceEdit->keySequence().isEmpty() &&
+        (!ui->keySequenceEdit->text().isEmpty() &&
          !ui->commandLineEdit->text().isEmpty());
 
     if(add)
@@ -72,3 +66,30 @@ void KeyDialog::SetButtons()
         ui->changeButton->setEnabled(enabled);
     }
 }
+
+bool KeyDialog::eventFilter(QObject *obj, QEvent *event)
+{
+    if(obj == ui->keySequenceEdit && event->type() == QEvent::KeyPress)
+    {
+        QKeyEvent *keyEvent = static_cast<QKeyEvent*>(event);
+        QKeySequence seq(keyEvent->key() + keyEvent->modifiers());
+        ui->keySequenceEdit->setText(seq.toString());
+        return true;
+    }
+    return QDialog::eventFilter(obj, event);
+}
+
+void KeyDialog::handleKeySequenceChanged(const QString&)
+{
+    SetButtons();
+}
+
+void KeyDialog::handleCommandTextChanged(const QString&)
+{
+    SetButtons();
+}
+
+void KeyDialog::handleClearButtonPressed()
+{
+    ui->keySequenceEdit->clear();
+}
diff --git a/src/ui/keydialog.h b/src/ui/keydialog.h
index d4716a9..7f72bd7 100644
--- a/src/ui/keydialog.h
+++ b/src/ui/keydialog.h
@@ -2,6 +2,7 @@
 #define KEYDIALOG_H
 
 #include <QDialog>
+#include <QKeyEvent>
 
 namespace Ui {
 class KeyDialog;
@@ -15,10 +16,16 @@ public:
     explicit KeyDialog(QWidget *parent = 0);
     ~KeyDialog();
 
-    QPair<QString, QPair<QString, QString>> SelectKey(bool add, QPair<QString, QPair<QString, QString>> init = (QPair<QString, QPair<QString, QString>>()));
+    QPair<QString, QPair<QString, QString> > SelectKey(bool add, QPair<QString, QPair<QString, QString> > init = (QPair<QString, QPair<QString, QString> >()));
 
 protected:
     void SetButtons();
+    bool eventFilter(QObject *obj, QEvent *event);
+
+private slots:
+    void handleKeySequenceChanged(const QString&);
+    void handleCommandTextChanged(const QString&);
+    void handleClearButtonPressed();
 
 private:
     Ui::KeyDialog *ui;
diff --git a/src/ui/keydialog.ui b/src/ui/keydialog.ui
index 268e930..62a30d1 100644
--- a/src/ui/keydialog.ui
+++ b/src/ui/keydialog.ui
@@ -59,13 +59,10 @@ QPushButton:disabled {
    <item>
     <layout class="QGridLayout" name="gridLayout">
      <item row="1" column="0">
-      <widget class="QKeySequenceEdit" name="keySequenceEdit"/>
+      <widget class="QLineEdit" name="keySequenceEdit"/>
      </item>
      <item row="1" column="1">
       <widget class="QLineEdit" name="commandLineEdit">
-       <property name="clearButtonEnabled">
-        <bool>true</bool>
-       </property>
       </widget>
      </item>
      <item row="1" column="2">
@@ -73,9 +70,6 @@ QPushButton:disabled {
        <property name="placeholderText">
         <string>(optional)</string>
        </property>
-       <property name="clearButtonEnabled">
-        <bool>true</bool>
-       </property>
       </widget>
      </item>
      <item row="0" column="0">
diff --git a/src/ui/locationdialog.cpp b/src/ui/locationdialog.cpp
index 64ffa63..d8bb65e 100644
--- a/src/ui/locationdialog.cpp
+++ b/src/ui/locationdialog.cpp
@@ -16,11 +16,8 @@ LocationDialog::LocationDialog(QString path, QWidget *parent) :
             this, SLOT(accept()));
     connect(ui->urlEdit, SIGNAL(textChanged(QString)),
             this, SLOT(validate(QString)));
-    connect(ui->pasteButton, &QPushButton::clicked,
-            [=]
-            {
-                ui->urlEdit->setText(QApplication::clipboard()->text());
-            });
+    connect(ui->pasteButton, SIGNAL(clicked()),
+            this, SLOT(pasteFromClipboard()));
 
     if(Util::IsValidFile(path))
         ui->urlEdit->setText(QDir::toNativeSeparators(path));
@@ -55,3 +52,8 @@ void LocationDialog::validate(QString input)
         ui->okButton->setEnabled(false);
     }
 }
+
+void LocationDialog::pasteFromClipboard()
+{
+    ui->urlEdit->setText(QApplication::clipboard()->text());
+}
diff --git a/src/ui/locationdialog.h b/src/ui/locationdialog.h
index eb7b878..9fe8fc4 100644
--- a/src/ui/locationdialog.h
+++ b/src/ui/locationdialog.h
@@ -19,6 +19,7 @@ public:
 
 private slots:
     void validate(QString input);
+    void pasteFromClipboard();
 
 private:
     Ui::LocationDialog *ui;
diff --git a/src/ui/locationdialog.ui b/src/ui/locationdialog.ui
index 9984936..738d91a 100644
--- a/src/ui/locationdialog.ui
+++ b/src/ui/locationdialog.ui
@@ -117,9 +117,6 @@ QPushButton:pressed {
      <property name="placeholderText">
       <string>Type URL or location here</string>
      </property>
-     <property name="clearButtonEnabled">
-      <bool>true</bool>
-     </property>
     </widget>
    </item>
    <item>
diff --git a/src/ui/mainwindow.cpp b/src/ui/mainwindow.cpp
index 34074f8..e6ad905 100644
--- a/src/ui/mainwindow.cpp
+++ b/src/ui/mainwindow.cpp
@@ -1,10 +1,12 @@
 #include "mainwindow.h"
 #include "ui_mainwindow.h"
 
-#include <QtMath>
+#include <QtCore/qmath.h>
 #include <QLibraryInfo>
 #include <QMimeData>
 #include <QDesktopWidget>
+#include <QUrl>
+#include <QInputDialog>
 
 #include "bakaengine.h"
 #include "mpvhandler.h"
@@ -12,14 +14,26 @@
 #include "overlayhandler.h"
 #include "util.h"
 #include "widgets/dimdialog.h"
-#include "inputdialog.h"
 #include "screenshotdialog.h"
 
 MainWindow::MainWindow(QWidget *parent):
     QMainWindow(parent),
-    ui(new Ui::MainWindow)
+    ui(new Ui::MainWindow),
+    firstItem(false),
+    init(false),
+    playlistState(false),
+    autohide(0),
+    current(0),
+    hideAllControls(false)
 {
     ui->setupUi(this);
+
+    // Ensure mpvFrame has a native window handle for embedding mpv
+    // This is required on macOS and some other platforms
+    ui->mpvFrame->setAttribute(Qt::WA_NativeWindow);
+    // Force creation of native window handle
+    ui->mpvFrame->winId();
+
 #if defined(Q_OS_UNIX) || defined(Q_OS_LINUX)
     // update streaming support disabled on unix platforms
     ui->actionUpdate_Streaming_Support->setEnabled(false);
@@ -37,802 +51,235 @@ MainWindow::MainWindow(QWidget *parent):
     autohide = new QTimer(this);
 
     // command action mappings (action (right) performs command (left))
-    commandActionMap = {
-        {"mpv add chapter +1", ui->action_Next_Chapter},
-        {"mpv add chapter -1", ui->action_Previous_Chapter},
-        {"mpv set sub-scale 1", ui->action_Reset_Size},
-        {"mpv add sub-scale +0.1", ui->action_Size},
-        {"mpv add sub-scale -0.1", ui->actionS_ize},
-        {"mpv set video-aspect -1", ui->action_Auto_Detect}, // todo: make these baka-commands so we can output messages when they change
-        {"mpv set video-aspect 16:9", ui->actionForce_16_9},
-        {"mpv set video-aspect 2.35:1", ui->actionForce_2_35_1},
-        {"mpv set video-aspect 4:3", ui->actionForce_4_3},
-        {"mpv cycle sub-visibility", ui->actionShow_Subtitles},
-        {"mpv set time-pos 0", ui->action_Restart},
-        {"mpv frame-step", ui->action_Frame_Step},
-        {"mpv frame-back-step", ui->actionFrame_Back_Step},
-        {"deinterlace", ui->action_Deinterlace},
-        {"interpolate", ui->action_Motion_Interpolation},
-        {"mute", ui->action_Mute},
-        {"screenshot subtitles", ui->actionWith_Subtitles},
-        {"screenshot", ui->actionWithout_Subtitles},
-        {"add_subtitles", ui->action_Add_Subtitle_File},
-        {"add_audio", ui->action_Add_Audio_File},
-        {"fitwindow", ui->action_To_Current_Size},
-        {"fitwindow 50", ui->action50},
-        {"fitwindow 75", ui->action75},
-        {"fitwindow 100", ui->action100},
-        {"fitwindow 150", ui->action150},
-        {"fitwindow 200", ui->action200},
-        {"fullscreen", ui->action_Full_Screen},
-        {"hide_all_controls", ui->actionHide_All_Controls},
-        {"jump", ui->action_Jump_to_Time},
-        {"media_info", ui->actionMedia_Info},
-        {"new", ui->action_New_Player},
-        {"open", ui->action_Open_File},
-        {"open_clipboard", ui->actionOpen_Path_from_Clipboard},
-        {"open_location", ui->actionOpen_URL},
-        {"playlist play +1", ui->actionPlay_Next_File},
-        {"playlist play -1", ui->actionPlay_Previous_File},
-        {"playlist repeat off", ui->action_Off},
-        {"playlist repeat playlist", ui->action_Playlist},
-        {"playlist repeat this", ui->action_This_File},
-        {"playlist shuffle", ui->actionSh_uffle},
-        {"playlist toggle", ui->action_Show_Playlist},
-        {"playlist full", ui->action_Hide_Album_Art},
-        {"dim", ui->action_Dim_Lights},
-        {"play_pause", ui->action_Play},
-        {"quit", ui->actionE_xit},
-        {"show_in_folder", ui->actionShow_in_Folder},
-        {"stop", ui->action_Stop},
-        {"volume +5", ui->action_Increase_Volume},
-        {"volume -5", ui->action_Decrease_Volume},
-        {"speed +0.1", ui->action_Increase},
-        {"speed -0.1", ui->action_Decrease},
-        {"speed 1.0", ui->action_Reset},
-        {"output", ui->actionShow_D_ebug_Output},
-        {"preferences", ui->action_Preferences},
-        {"online_help", ui->actionOnline_Help},
-        {"update", ui->action_Check_for_Updates},
-        {"update youtube-dl", ui->actionUpdate_Streaming_Support},
-        {"about qt", ui->actionAbout_Qt},
-        {"about", ui->actionAbout_Baka_MPlayer}
-    };
+    commandActionMap.insert("mpv add chapter +1", ui->action_Next_Chapter);
+    commandActionMap.insert("mpv add chapter -1", ui->action_Previous_Chapter);
+    commandActionMap.insert("mpv set sub-scale 1", ui->action_Reset_Size);
+    commandActionMap.insert("mpv add sub-scale +0.1", ui->action_Size);
+    commandActionMap.insert("mpv add sub-scale -0.1", ui->actionS_ize);
+    commandActionMap.insert("mpv set video-aspect -1", ui->action_Auto_Detect); // todo: make these baka-commands so we can output messages when they change
+    commandActionMap.insert("mpv set video-aspect 16:9", ui->actionForce_16_9);
+    commandActionMap.insert("mpv set video-aspect 2.35:1", ui->actionForce_2_35_1);
+    commandActionMap.insert("mpv set video-aspect 4:3", ui->actionForce_4_3);
+    commandActionMap.insert("mpv cycle sub-visibility", ui->actionShow_Subtitles);
+    commandActionMap.insert("mpv set time-pos 0", ui->action_Restart);
+    commandActionMap.insert("mpv frame-step", ui->action_Frame_Step);
+    commandActionMap.insert("mpv frame-back-step", ui->actionFrame_Back_Step);
+    commandActionMap.insert("deinterlace", ui->action_Deinterlace);
+    commandActionMap.insert("interpolate", ui->action_Motion_Interpolation);
+    commandActionMap.insert("mute", ui->action_Mute);
+    commandActionMap.insert("screenshot subtitles", ui->actionWith_Subtitles);
+    commandActionMap.insert("screenshot", ui->actionWithout_Subtitles);
+    commandActionMap.insert("add_subtitles", ui->action_Add_Subtitle_File);
+    commandActionMap.insert("add_audio", ui->action_Add_Audio_File);
+    commandActionMap.insert("fitwindow", ui->action_To_Current_Size);
+    commandActionMap.insert("fitwindow 50", ui->action50);
+    commandActionMap.insert("fitwindow 75", ui->action75);
+    commandActionMap.insert("fitwindow 100", ui->action100);
+    commandActionMap.insert("fitwindow 150", ui->action150);
+    commandActionMap.insert("fitwindow 200", ui->action200);
+    commandActionMap.insert("fullscreen", ui->action_Full_Screen);
+    commandActionMap.insert("hide_all_controls", ui->actionHide_All_Controls);
+    commandActionMap.insert("jump", ui->action_Jump_to_Time);
+    commandActionMap.insert("media_info", ui->actionMedia_Info);
+    commandActionMap.insert("new", ui->action_New_Player);
+    commandActionMap.insert("open", ui->action_Open_File);
+    commandActionMap.insert("open_clipboard", ui->actionOpen_Path_from_Clipboard);
+    commandActionMap.insert("open_location", ui->actionOpen_URL);
+    commandActionMap.insert("playlist play +1", ui->actionPlay_Next_File);
+    commandActionMap.insert("playlist play -1", ui->actionPlay_Previous_File);
+    commandActionMap.insert("playlist repeat off", ui->action_Off);
+    commandActionMap.insert("playlist repeat playlist", ui->action_Playlist);
+    commandActionMap.insert("playlist repeat this", ui->action_This_File);
+    commandActionMap.insert("playlist shuffle", ui->actionSh_uffle);
+    commandActionMap.insert("playlist toggle", ui->action_Show_Playlist);
+    commandActionMap.insert("playlist full", ui->action_Hide_Album_Art);
+    commandActionMap.insert("dim", ui->action_Dim_Lights);
+    commandActionMap.insert("play_pause", ui->action_Play);
+    commandActionMap.insert("quit", ui->actionE_xit);
+    commandActionMap.insert("show_in_folder", ui->actionShow_in_Folder);
+    commandActionMap.insert("stop", ui->action_Stop);
+    commandActionMap.insert("volume +5", ui->action_Increase_Volume);
+    commandActionMap.insert("volume -5", ui->action_Decrease_Volume);
+    commandActionMap.insert("speed +0.1", ui->action_Increase);
+    commandActionMap.insert("speed -0.1", ui->action_Decrease);
+    commandActionMap.insert("speed 1.0", ui->action_Reset);
+    commandActionMap.insert("output", ui->actionShow_D_ebug_Output);
+    commandActionMap.insert("preferences", ui->action_Preferences);
+    commandActionMap.insert("online_help", ui->actionOnline_Help);
+    commandActionMap.insert("about qt", ui->actionAbout_Qt);
+    commandActionMap.insert("about", ui->actionAbout_Baka_MPlayer);
 
     // map actions to commands
-    for(auto action = commandActionMap.begin(); action != commandActionMap.end(); ++action)
+    for(QHash<QString, QAction*>::iterator action = commandActionMap.begin(); action != commandActionMap.end(); ++action)
     {
-        const QString cmd = action.key();
-        connect(*action, &QAction::triggered,
-                [=] { baka->Command(cmd); });
+        connect(*action, SIGNAL(triggered()),
+                this, SLOT(handleCommandActionTriggered()));
     }
 
     // setup signals & slots
 
     // mainwindow
-    connect(this, &MainWindow::langChanged,
-            [=](QString lang)
-            {
-                if(lang == "auto") // fetch lang from locale
-                    lang = QLocale::system().name();
+    connect(this, SIGNAL(langChanged(QString)),
+            this, SLOT(handleLangChanged(QString)));
 
-                if(lang != "en")
-                {
-                    QTranslator *tmp;
-
-                    // load the system translations provided by Qt
-                    tmp = baka->qtTranslator;
-                    baka->qtTranslator = new QTranslator();
-                    baka->qtTranslator->load(QString("qt_%0").arg(lang), QLibraryInfo::location(QLibraryInfo::TranslationsPath));
-                    qApp->installTranslator(baka->qtTranslator);
-                    if(tmp != nullptr)
-                        delete tmp;
-
-                    // load the application translations
-                    tmp = baka->translator;
-                    baka->translator = new QTranslator();
-                    baka->translator->load(QString("baka-mplayer_%0").arg(lang), BAKA_MPLAYER_LANG_PATH);
-                    qApp->installTranslator(baka->translator);
-                    if(tmp != nullptr)
-                        delete tmp;
-                }
-                else
-                {
-                    if(baka->qtTranslator != nullptr)
-                        qApp->removeTranslator(baka->qtTranslator);
-                    if(baka->translator != nullptr)
-                        qApp->removeTranslator(baka->translator);
-                }
+    connect(this, SIGNAL(onTopChanged(QString)),
+            this, SLOT(handleOnTopChanged(QString)));
 
-                // save strings we want to keep
-                QString title = windowTitle(),
-                        duration = ui->durationLabel->text(),
-                        remaining = ui->remainingLabel->text(),
-                        index = ui->indexLabel->text();
+    connect(this, SIGNAL(remainingChanged(bool)),
+            this, SLOT(handleRemainingChanged()));
 
-                ui->retranslateUi(this);
+    connect(this, SIGNAL(debugChanged(bool)),
+            this, SLOT(handleDebugChanged(bool)));
 
-                // reload strings we kept
-                setWindowTitle(title);
-                ui->durationLabel->setText(duration);
-                ui->remainingLabel->setText(remaining);
-                ui->indexLabel->setText(index);
-            });
+    connect(this, SIGNAL(hideAllControlsChanged(bool)),
+            this, SLOT(handleHideAllControlsChanged(bool)));
 
-    connect(this, &MainWindow::onTopChanged,
-            [=](QString onTop)
-            {
-                if(onTop == "never")
-                    Util::SetAlwaysOnTop(winId(), false);
-                else if(onTop == "always")
-                    Util::SetAlwaysOnTop(winId(), true);
-                else if(onTop == "playing" && mpv->getPlayState() > 0)
-                    Util::SetAlwaysOnTop(winId(), true);
-            });
-
-    connect(this, &MainWindow::remainingChanged,
-            [=]
-            {
-                SetRemainingLabels(mpv->getTime());
-            });
+    connect(this, SIGNAL(leftClickPlayPauseChanged(bool)),
+            this, SLOT(handleLeftClickPlayPauseChanged(bool)));
 
-    connect(this, &MainWindow::debugChanged,
-            [=](bool b)
-            {
-                ui->actionShow_D_ebug_Output->setChecked(b);
-                ui->verticalWidget->setVisible(b);
-                mouseMoveEvent(new QMouseEvent(QMouseEvent::MouseMove,
-                                               QCursor::pos(),
-                                               Qt::NoButton,Qt::NoButton,Qt::NoModifier));
-                if(b)
-                    ui->inputLineEdit->setFocus();
-            });
-
-    connect(this, &MainWindow::hideAllControlsChanged,
-            [=](bool b)
-            {
-                HideAllControls(b);
-                blockSignals(true);
-                ui->actionHide_All_Controls->setChecked(b);
-                blockSignals(false);
-            });
-
-    connect(this, &MainWindow::leftClickPlayPauseChanged,
-            [=](bool b)
-            {
-                if(b)
-                    setContextMenuPolicy(Qt::ActionsContextMenu);
-                else if(!isFullScreen())
-                    setContextMenuPolicy(Qt::NoContextMenu);
-            });
-
-    connect(baka->sysTrayIcon, &QSystemTrayIcon::activated,
-            [=](QSystemTrayIcon::ActivationReason reason)
-            {
-                if(reason == QSystemTrayIcon::Trigger)
-                {
-                    if(!hidePopup)
-                    {
-                        if(mpv->getPlayState() == Mpv::Playing)
-                            baka->sysTrayIcon->showMessage("Baka MPlayer", tr("Playing"), QSystemTrayIcon::NoIcon, 4000);
-                        else if(mpv->getPlayState() == Mpv::Paused)
-                            baka->sysTrayIcon->showMessage("Baka MPlayer", tr("Paused"), QSystemTrayIcon::NoIcon, 4000);
-                    }
-                    baka->PlayPause();
-                }
-
-            });
+    connect(baka->sysTrayIcon, SIGNAL(activated(QSystemTrayIcon::ActivationReason)),
+            this, SLOT(handleSysTrayIconActivated(QSystemTrayIcon::ActivationReason)));
 
     //    connect(this, &MainWindow::hidePopupChanged,
     //            [=](bool b)
     //    {
     //    });
 
-    connect(autohide, &QTimer::timeout, // cursor autohide
-            [=]
-            {
-                if(ui->mpvFrame->geometry().contains(ui->mpvFrame->mapFromGlobal(cursor().pos())))
-                    setCursor(QCursor(Qt::BlankCursor));
-                if(autohide)
-                    autohide->stop();
-            });
+    connect(autohide, SIGNAL(timeout()), // cursor autohide
+            this, SLOT(handleAutohideTimeout()));
 
     // dimDialog
-    connect(baka->dimDialog, &DimDialog::visbilityChanged,
-            [=](bool dim)
-            {
-                ui->action_Dim_Lights->setChecked(dim);
-                if(dim)
-                    Util::SetAlwaysOnTop(winId(), true);
-                else if(onTop == "never" || (onTop == "playing" && mpv->getPlayState() > 0))
-                    Util::SetAlwaysOnTop(winId(), false);
-            });
+    connect(baka->dimDialog, SIGNAL(visbilityChanged(bool)),
+            this, SLOT(handleDimDialogVisibilityChanged(bool)));
 
     // mpv
 
-    connect(mpv, &MpvHandler::playlistChanged,
-            [=](const QStringList &list)
-            {
-                if(list.length() > 1)
-                {
-                    ui->actionSh_uffle->setEnabled(true);
-                    ui->actionStop_after_Current->setEnabled(true);
-                    ShowPlaylist(true);
-                }
-                else
-                {
-                    ui->actionSh_uffle->setEnabled(false);
-                    ui->actionStop_after_Current->setEnabled(false);
-                }
+    connect(mpv, SIGNAL(playlistChanged(QStringList)),
+            this, SLOT(handlePlaylistChanged(QStringList)));
 
-                if(list.length() > 0)
-                    ui->menuR_epeat->setEnabled(true);
-                else
-                    ui->menuR_epeat->setEnabled(false);
-            });
+    connect(mpv, SIGNAL(fileInfoChanged(Mpv::FileInfo)),
+            this, SLOT(handleFileInfoChanged(Mpv::FileInfo)));
 
-    connect(mpv, &MpvHandler::fileInfoChanged,
-            [=](const Mpv::FileInfo &fileInfo)
-            {
-                if(mpv->getPlayState() > 0)
-                {
-                    if(fileInfo.media_title == "")
-                        setWindowTitle("Baka MPlayer");
-                    else if(fileInfo.media_title == "-")
-                        setWindowTitle("Baka MPlayer: stdin"); // todo: disable playlist?
-                    else
-                        setWindowTitle(fileInfo.media_title);
-
-                    QString f = mpv->getFile(), file = mpv->getPath()+f;
-                    if(f != QString() && maxRecent > 0)
-                    {
-                        int i = recent.indexOf(file);
-                        if(i >= 0)
-                        {
-                            int t = recent.at(i).time;
-                            if(t > 0 && resume)
-                                mpv->Seek(t);
-                            recent.removeAt(i);
-                        }
-                        if(recent.isEmpty() || recent.front() != file)
-                        {
-                            UpdateRecentFiles(); // update after initialization and only if the current file is different from the first recent
-                            while(recent.length() > maxRecent-1)
-                                recent.removeLast();
-                            recent.push_front(
-                                Recent(file,
-                                       (mpv->getPath() == QString() || !Util::IsValidFile(file)) ?
-                                           fileInfo.media_title : QString()));
-                            current = &recent.front();
-                        }
-                    }
-
-                    // reset speed if length isn't known and we have a streaming video
-                    // todo: don't save this reset, put their speed back when a normal video comes on
-                    // todo: disable speed alteration during streaming media
-                    if(fileInfo.length == 0)
-                        if(mpv->getSpeed() != 1)
-                            mpv->Speed(1);
-
-                    ui->seekBar->setTracking(fileInfo.length);
-
-                    if(ui->actionMedia_Info->isChecked())
-                        baka->MediaInfo(true);
-
-                    SetRemainingLabels(fileInfo.length);
-                }
-            });
+    connect(mpv, SIGNAL(trackListChanged(QList<Mpv::Track>)),
+            this, SLOT(handleTrackListChanged(QList<Mpv::Track>)));
 
-    connect(mpv, &MpvHandler::trackListChanged,
-            [=](const QList<Mpv::Track> &trackList)
-            {
-                if(mpv->getPlayState() > 0)
-                {
-                    QAction *action;
-                    bool video = false,
-                         albumArt = false;
-
-                    ui->menuSubtitle_Track->clear();
-                    ui->menuSubtitle_Track->addAction(ui->action_Add_Subtitle_File);
-                    ui->menuAudio_Tracks->clear();
-                    ui->menuAudio_Tracks->addAction(ui->action_Add_Audio_File);
-                    for(auto &track : trackList)
-                    {
-                        if(track.type == "sub")
-                        {
-                            action = ui->menuSubtitle_Track->addAction(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.lang + (track.external ? "*" : "")).replace("&", "&&"));
-                            connect(action, &QAction::triggered,
-                                    [=]
-                                    {
-                                        // basically, if you uncheck the selected subtitle id, we hide subtitles
-                                        // when you check a subtitle id, we make sure subtitles are showing and set it
-                                        if(mpv->getSid() == track.id)
-                                        {
-                                            if(mpv->getSubtitleVisibility())
-                                            {
-                                                mpv->ShowSubtitles(false);
-                                                return;
-                                            }
-                                            else
-                                                mpv->ShowSubtitles(true);
-                                        }
-                                        else if(!mpv->getSubtitleVisibility())
-                                            mpv->ShowSubtitles(true);
-                                        mpv->Sid(track.id);
-                                        mpv->ShowText(QString("%0 %1: %2 (%3)").arg(tr("Sub"), QString::number(track.id), track.title, track.lang + (track.external ? "*" : "")));
-                                    });
-                        }
-                        else if(track.type == "audio")
-                        {
-                            action = ui->menuAudio_Tracks->addAction(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.lang).replace("&", "&&"));
-                            connect(action, &QAction::triggered,
-                                    [=]
-                                    {
-                                        if(mpv->getAid() != track.id) // don't allow selection of the same track
-                                        {
-                                            mpv->Aid(track.id);
-                                            mpv->ShowText(QString("%0 %1: %2 (%3)").arg(tr("Audio"), QString::number(track.id), track.title, track.lang));
-                                        }
-                                        else
-                                            action->setChecked(true); // recheck the track
-                                    });
-                        }
-                        else if(track.type == "video") // video track
-                        {
-                            if(!track.albumart) // isn't album art
-                                video = true;
-                            else
-                                albumArt = true;
-                        }
-                    }
-                    if(video)
-                    {
-                        // if we were hiding album art, show it--we've gone to a video
-                        if(ui->mpvFrame->styleSheet() != QString()) // remove filler album art
-                            ui->mpvFrame->setStyleSheet("");
-                        if(ui->action_Hide_Album_Art->isChecked())
-                            HideAlbumArt(false);
-                        ui->action_Hide_Album_Art->setEnabled(false);
-                        ui->menuSubtitle_Track->setEnabled(true);
-                        if(ui->menuSubtitle_Track->actions().count() > 1)
-                        {
-                            ui->menuFont_Si_ze->setEnabled(true);
-                            ui->actionShow_Subtitles->setEnabled(true);
-                            ui->actionShow_Subtitles->setChecked(mpv->getSubtitleVisibility());
-                        }
-                        else
-                        {
-                            ui->menuFont_Si_ze->setEnabled(false);
-                            ui->actionShow_Subtitles->setEnabled(false);
-                            ui->actionShow_Subtitles->setChecked(false);
-                        }
-                        ui->menuTake_Screenshot->setEnabled(true);
-                        ui->menuFit_Window->setEnabled(true);
-                        ui->menuAspect_Ratio->setEnabled(true);
-                        ui->action_Frame_Step->setEnabled(true);
-                        ui->actionFrame_Back_Step->setEnabled(true);
-                        ui->action_Deinterlace->setEnabled(true);
-                        ui->action_Motion_Interpolation->setEnabled(true);
-                    }
-                    else
-                    {
-                        if(!albumArt)
-                        {
-                            // put in filler albumArt
-                            if(ui->mpvFrame->styleSheet() == QString())
-                                ui->mpvFrame->setStyleSheet("background-image:url(:/img/album-art.png);background-repeat:no-repeat;background-position:center;");
-                        }
-                        ui->action_Hide_Album_Art->setEnabled(true);
-                        ui->menuSubtitle_Track->setEnabled(false);
-                        ui->menuFont_Si_ze->setEnabled(false);
-                        ui->actionShow_Subtitles->setEnabled(false);
-                        ui->actionShow_Subtitles->setChecked(false);
-                        ui->menuTake_Screenshot->setEnabled(false);
-                        ui->menuFit_Window->setEnabled(false);
-                        ui->menuAspect_Ratio->setEnabled(false);
-                        ui->action_Frame_Step->setEnabled(false);
-                        ui->actionFrame_Back_Step->setEnabled(false);
-                        ui->action_Deinterlace->setEnabled(false);
-                        ui->action_Motion_Interpolation->setEnabled(false);
-
-                        if(baka->sysTrayIcon->isVisible() && !hidePopup)
-                        {
-                            // todo: use {artist} - {title}
-                            baka->sysTrayIcon->showMessage("Baka MPlayer", mpv->getFileInfo().media_title, QSystemTrayIcon::NoIcon, 4000);
-                        }
-                    }
-
-                    if(ui->menuAudio_Tracks->actions().count() == 1)
-                        ui->menuAudio_Tracks->actions().first()->setEnabled(false);
-
-                    if(pathChanged && autoFit)
-                    {
-                        baka->FitWindow(autoFit, false);
-                        pathChanged = false;
-                    }
-                }
-            });
+    connect(mpv, SIGNAL(chaptersChanged(QList<Mpv::Chapter>)),
+            this, SLOT(handleChaptersChanged(QList<Mpv::Chapter>)));
 
-    connect(mpv, &MpvHandler::chaptersChanged,
-            [=](const QList<Mpv::Chapter> &chapters)
-            {
-                if(mpv->getPlayState() > 0)
-                {
-                    QAction *action;
-                    QList<int> ticks;
-                    int n = 1,
-                        N = chapters.length();
-                    ui->menu_Chapters->clear();
-                    for(auto &ch : chapters)
-                    {
-                        action = ui->menu_Chapters->addAction(QString("%0: %1").arg(Util::FormatNumberWithAmpersand(n, N), ch.title));
-                        if(n <= 9)
-                            action->setShortcut(QKeySequence("Ctrl+"+QString::number(n)));
-                        connect(action, &QAction::triggered,
-                                [=]
-                                {
-                                    mpv->Seek(ch.time);
-                                });
-                        ticks.push_back(ch.time);
-                        n++;
-                    }
-                    if(ui->menu_Chapters->actions().count() == 0)
-                    {
-                        ui->menu_Chapters->setEnabled(false);
-                        ui->action_Next_Chapter->setEnabled(false);
-                        ui->action_Previous_Chapter->setEnabled(false);
-                    }
-                    else
-                    {
-                        ui->menu_Chapters->setEnabled(true);
-                        ui->action_Next_Chapter->setEnabled(true);
-                        ui->action_Previous_Chapter->setEnabled(true);
-                    }
-
-                    ui->seekBar->setTicks(ticks);
-                }
-            });
+    connect(mpv, SIGNAL(playStateChanged(Mpv::PlayState)),
+            this, SLOT(handlePlayStateChanged(Mpv::PlayState)));
 
-    connect(mpv, &MpvHandler::playStateChanged,
-            [=](Mpv::PlayState playState)
-            {
-                switch(playState)
-                {
-                case Mpv::Loaded:
-                    baka->mpv->ShowText("Loading...", 0);
-                    break;
-
-                case Mpv::Started:
-                    if(!init) // will only happen the first time a file is loaded.
-                    {
-                        ui->action_Play->setEnabled(true);
-                        ui->playButton->setEnabled(true);
-#if defined(Q_OS_WIN)
-                        playpause_toolbutton->setEnabled(true);
-#endif
-                        ui->playlistButton->setEnabled(true);
-                        ui->action_Show_Playlist->setEnabled(true);
-                        ui->menuAudio_Tracks->setEnabled(true);
-                        init = true;
-                    }
-                    SetPlaybackControls(true);
-                    mpv->Play();
-                    baka->overlay->showStatusText(QString(), 0);
-                case Mpv::Playing:
-                    SetPlayButtonIcon(false);
-                    if(onTop == "playing")
-                        Util::SetAlwaysOnTop(winId(), true);
-                    break;
-
-                case Mpv::Paused:
-                case Mpv::Stopped:
-                    SetPlayButtonIcon(true);
-                    if(onTop == "playing")
-                        Util::SetAlwaysOnTop(winId(), false);
-                    break;
-
-                case Mpv::Idle:
-                    if(init)
-                    {
-                        if(ui->action_This_File->isChecked()) // repeat this file
-                            ui->playlistWidget->PlayIndex(0, true); // restart file
-                        else if(ui->actionStop_after_Current->isChecked() ||  // stop after playing this file
-                                ui->playlistWidget->CurrentIndex() >= ui->playlistWidget->count()-1) // end of the playlist
-                        {
-                            if(!ui->actionStop_after_Current->isChecked() && // not supposed to stop after current
-                                ui->action_Playlist->isChecked() && // we're supposed to restart the playlist
-                                ui->playlistWidget->count() > 0) // playlist isn't empty
-                            {
-                                ui->playlistWidget->PlayIndex(0); // restart playlist
-                            }
-                            else // stop
-                            {
-                                setWindowTitle("Baka MPlayer");
-                                SetPlaybackControls(false);
-                                ui->seekBar->setTracking(0);
-                                ui->actionStop_after_Current->setChecked(false);
-                                if(ui->mpvFrame->styleSheet() != QString()) // remove filler album art
-                                    ui->mpvFrame->setStyleSheet("");
-                            }
-                        }
-                        else
-                            ui->playlistWidget->PlayIndex(1, true);
-                    }
-                    break;
-                }
-            });
+    connect(mpv, SIGNAL(pathChanged(QString)),
+            this, SLOT(handlePathChanged()));
 
-    connect(mpv, &MpvHandler::pathChanged,
-            [=]()
-            {
-                pathChanged = true;
-            });
-
-      connect(mpv, &MpvHandler::fileChanging,
-              [=](int t, int l)
-              {
-                  if(current != nullptr)
-                  {
-                      if(t > 0.05*l && t < 0.95*l) // only save if within the middle 90%
-                          current->time = t;
-                      else
-                          current->time = 0;
-                  }
-              });
+      connect(mpv, SIGNAL(fileChanging(int,int)),
+              this, SLOT(handleFileChanging(int,int)));
 
 //    connect(mpv, &MpvHandler::fileChanged,
 //            [=](QString f)
 //            {
 //            });
 
-    connect(mpv, &MpvHandler::timeChanged,
-            [=](int i)
-            {
-                const Mpv::FileInfo &fi = mpv->getFileInfo();
-                // set the seekBar's location with NoSignal function so that it doesn't trigger a seek
-                // the formula is a simple ratio seekBar's max * time/totalTime
-                ui->seekBar->setValueNoSignal(ui->seekBar->maximum()*((double)i/fi.length));
-
-                SetRemainingLabels(i);
+    connect(mpv, SIGNAL(timeChanged(int)),
+            this, SLOT(handleTimeChanged(int)));
 
-                // set next/previous chapter's enabled state
-                if(fi.chapters.length() > 0)
-                {
-                    ui->action_Next_Chapter->setEnabled(i < fi.chapters.last().time);
-                    ui->action_Previous_Chapter->setEnabled(i > fi.chapters.first().time);
-                }
-            });
+    connect(mpv, SIGNAL(volumeChanged(int)),
+            this, SLOT(handleVolumeChanged(int)));
 
-    connect(mpv, &MpvHandler::volumeChanged,
-            [=](int volume)
-            {
-                ui->volumeSlider->setValueNoSignal(volume);
-            });
+    connect(mpv, SIGNAL(speedChanged(double)),
+            this, SLOT(handleSpeedChanged(double)));
 
-    connect(mpv, &MpvHandler::speedChanged,
-            [=](double speed)
-            {
-                static double last = 1;
-                if(last != speed)
-                {
-                    if(init)
-                        mpv->ShowText(tr("Speed: %0x").arg(QString::number(speed)));
-                    if(speed <= 0.25)
-                        ui->action_Decrease->setEnabled(false);
-                    else
-                        ui->action_Decrease->setEnabled(true);
-                    last = speed;
-                }
-            });
+    connect(mpv, SIGNAL(sidChanged(int)),
+            this, SLOT(handleSidChanged(int)));
 
-    connect(mpv, &MpvHandler::sidChanged,
-            [=](int sid)
-            {
-                QList<QAction*> actions = ui->menuSubtitle_Track->actions();
-                for(auto &action : actions)
-                {
-                    if(action->text().startsWith(QString::number(sid)))
-                    {
-                        action->setCheckable(true);
-                        action->setChecked(true);
-                    }
-                    else
-                        action->setChecked(false);
-                }
-            });
+    connect(mpv, SIGNAL(aidChanged(int)),
+            this, SLOT(handleAidChanged(int)));
 
-    connect(mpv, &MpvHandler::aidChanged,
-            [=](int aid)
-            {
-                QList<QAction*> actions = ui->menuAudio_Tracks->actions();
-                for(auto &action : actions)
-                {
-                    if(action->text().startsWith(QString::number(aid)))
-                    {
-                        action->setCheckable(true);
-                        action->setChecked(true);
-                    }
-                    else
-                        action->setChecked(false);
-                }
-            });
+    connect(mpv, SIGNAL(subtitleVisibilityChanged(bool)),
+            this, SLOT(handleSubtitleVisibilityChanged(bool)));
 
-    connect(mpv, &MpvHandler::subtitleVisibilityChanged,
-            [=](bool b)
-            {
-                if(ui->actionShow_Subtitles->isEnabled())
-                    ui->actionShow_Subtitles->setChecked(b);
-                if(init)
-                    mpv->ShowText(b ? tr("Subtitles visible") : tr("Subtitles hidden"));
-            });
-
-    connect(mpv, &MpvHandler::muteChanged,
-            [=](bool b)
-            {
-                if(b)
-                    ui->muteButton->setIcon(QIcon(":/img/default_mute.svg"));
-                else
-                    ui->muteButton->setIcon(QIcon(":/img/default_unmute.svg"));
-                mpv->ShowText(b ? tr("Muted") : tr("Unmuted"));
-            });
+    connect(mpv, SIGNAL(muteChanged(bool)),
+            this, SLOT(handleMuteChanged(bool)));
 
-    connect(mpv, &MpvHandler::voChanged,
-            [=](QString vo)
-            {
-                ui->action_Motion_Interpolation->setChecked(vo.contains("interpolation"));
-            });
+    connect(mpv, SIGNAL(voChanged(QString)),
+            this, SLOT(handleVoChanged(QString)));
     // ui
 
-    connect(ui->seekBar, &SeekBar::valueChanged,                        // Playback: Seekbar clicked
-            [=](int i)
-            {
-                mpv->Seek(mpv->Relative(((double)i/ui->seekBar->maximum())*mpv->getFileInfo().length), true);
-            });
+    connect(ui->seekBar, SIGNAL(valueChanged(int)),                        // Playback: Seekbar clicked
+            this, SLOT(handleSeekBarValueChanged(int)));
 
-    connect(ui->openButton, &OpenButton::LeftClick,                     // Playback: Open button (left click)
-            [=]
-            {
-                baka->Open();
-            });
+    connect(ui->openButton, SIGNAL(LeftClick()),                     // Playback: Open button (left click)
+            this, SLOT(handleOpenButtonLeftClick()));
 
-    connect(ui->openButton, &OpenButton::MiddleClick,                   // Playback: Open button (middle click)
-            [=]
-            {
-                baka->Jump();
-            });
+    connect(ui->openButton, SIGNAL(MiddleClick()),                   // Playback: Open button (middle click)
+            this, SLOT(handleOpenButtonMiddleClick()));
 
-    connect(ui->openButton, &OpenButton::RightClick,                    // Playback: Open button (right click)
-            [=]
-            {
-                baka->OpenLocation();
-            });
+    connect(ui->openButton, SIGNAL(RightClick()),                    // Playback: Open button (right click)
+            this, SLOT(handleOpenButtonRightClick()));
 
-    connect(ui->rewindButton, &QPushButton::clicked,                    // Playback: Rewind button
-            [=]
-            {
-                mpv->Rewind();
-            });
+    connect(ui->rewindButton, SIGNAL(clicked()),                    // Playback: Rewind button
+            this, SLOT(handleRewindButtonClicked()));
 
-    connect(ui->previousButton, &IndexButton::clicked,                  // Playback: Previous button
-            [=]
-            {
-                ui->playlistWidget->PlayIndex(-1, true);
-            });
+    connect(ui->previousButton, SIGNAL(clicked()),                  // Playback: Previous button
+            this, SLOT(handlePreviousButtonClicked()));
 
-    connect(ui->playButton, &QPushButton::clicked,                      // Playback: Play/pause button
-            [=]
-            {
-                baka->PlayPause();
-            });
+    connect(ui->playButton, SIGNAL(clicked()),                      // Playback: Play/pause button
+            this, SLOT(handlePlayButtonClicked()));
 
-    connect(ui->nextButton, &IndexButton::clicked,                      // Playback: Next button
-            [=]
-            {
-                ui->playlistWidget->PlayIndex(1, true);
-            });
+    connect(ui->nextButton, SIGNAL(clicked()),                      // Playback: Next button
+            this, SLOT(handleNextButtonClicked()));
 
-    connect(ui->muteButton, &QPushButton::clicked,
-            [=]
-            {
-                mpv->Mute(!mpv->getMute());
-            });
+    connect(ui->muteButton, SIGNAL(clicked()),
+            this, SLOT(handleMuteButtonClicked()));
 
-    connect(ui->volumeSlider, &CustomSlider::valueChanged,              // Playback: Volume slider adjusted
-            [=](int i)
-            {
-                mpv->Volume(i, true);
-            });
+    connect(ui->volumeSlider, SIGNAL(valueChanged(int)),              // Playback: Volume slider adjusted
+            this, SLOT(handleVolumeSliderValueChanged(int)));
 
-    connect(ui->playlistButton, &QPushButton::clicked,                  // Playback: Clicked the playlist button
-            [=]
-            {
-                TogglePlaylist();
-            });
+    connect(ui->playlistButton, SIGNAL(clicked()),                  // Playback: Clicked the playlist button
+            this, SLOT(handlePlaylistButtonClicked()));
 
-    connect(ui->splitter, &CustomSplitter::positionChanged,             // Splitter position changed
-            [=](int i)
-            {
-                blockSignals(true);
-                if(i == 0) // right-most, playlist is hidden
-                {
-                    ui->action_Show_Playlist->setChecked(false);
-                    ui->action_Hide_Album_Art->setChecked(false);
-                    ui->playlistLayoutWidget->setVisible(false);
-                }
-                else if(i == ui->splitter->max()) // left-most, album art is hidden, playlist is visible
-                {
-                    ui->action_Show_Playlist->setChecked(true);
-                    ui->action_Hide_Album_Art->setChecked(true);
-                }
-                else // in the middle, album art is visible, playlist is visible
-                {
-                    ui->action_Show_Playlist->setChecked(true);
-                    ui->action_Hide_Album_Art->setChecked(false);
-                }
-                ui->playlistLayoutWidget->setVisible(ui->action_Show_Playlist->isChecked());
-                blockSignals(false);
-                if(ui->actionMedia_Info->isChecked())
-                    baka->overlay->showInfoText();
-            });
-
-    connect(ui->searchBox, &QLineEdit::textChanged,                     // Playlist: Search box
-            [=](QString s)
-            {
-                ui->playlistWidget->Search(s);
-            });
+    connect(ui->splitter, SIGNAL(positionChanged(int)),             // Splitter position changed
+            this, SLOT(handleSplitterPositionChanged(int)));
 
-    connect(ui->indexLabel, &CustomLabel::clicked,                      // Playlist: Clicked the indexLabel
-            [=]
-            {
-                QString res = InputDialog::getInput(tr("Enter the file number you want to play:\nNote: Value must be from %0 - %1").arg("1", QString::number(ui->playlistWidget->count())),
-                                                    tr("Enter File Number"),
-                                                    [this](QString input)
-                                                    {
-                                                        int in = input.toInt();
-                                                        if(in >= 1 && in <= ui->playlistWidget->count())
-                                                            return true;
-                                                        return false;
-                                                    },
-                                                    this);
-                if(res != "")
-                    ui->playlistWidget->PlayIndex(res.toInt()-1); // user index will be 1 greater than actual
-            });
-
-    connect(ui->playlistWidget, &PlaylistWidget::currentRowChanged,     // Playlist: Playlist selection changed
-            [=](int)
-            {
-                SetIndexLabels(true);
-            });
+    connect(ui->searchBox, SIGNAL(textChanged(QString)),                     // Playlist: Search box
+            this, SLOT(handleSearchBoxTextChanged(QString)));
 
-    connect(ui->currentFileButton, &QPushButton::clicked,               // Playlist: Select current file button
-            [=]
-            {
-                ui->playlistWidget->SelectIndex(ui->playlistWidget->CurrentIndex());
-            });
+    connect(ui->indexLabel, SIGNAL(clicked()),                      // Playlist: Clicked the indexLabel
+            this, SLOT(handleIndexLabelClicked()));
 
-    connect(ui->refreshButton, &QPushButton::clicked,                   // Playlist: Refresh playlist button
-            [=]
-            {
-                ui->playlistWidget->RefreshPlaylist();
-            });
+    connect(ui->playlistWidget, SIGNAL(currentRowChanged(int)),     // Playlist: Playlist selection changed
+            this, SLOT(handlePlaylistWidgetCurrentRowChanged(int)));
 
-    connect(ui->inputLineEdit, &CustomLineEdit::submitted,
-            [=](QString s)
-            {
-                baka->Command(s);
-                ui->inputLineEdit->setText("");
-            });
+    connect(ui->currentFileButton, SIGNAL(clicked()),               // Playlist: Select current file button
+            this, SLOT(handleCurrentFileButtonClicked()));
+
+    connect(ui->refreshButton, SIGNAL(clicked()),                   // Playlist: Refresh playlist button
+            this, SLOT(handleRefreshButtonClicked()));
+
+    connect(ui->inputLineEdit, SIGNAL(submitted(QString)),
+            this, SLOT(handleInputLineEditSubmitted(QString)));
 
     // add multimedia shortcuts
-    ui->action_Play->setShortcuts({ui->action_Play->shortcut(), QKeySequence(Qt::Key_MediaPlay)});
-    ui->action_Stop->setShortcuts({ui->action_Stop->shortcut(), QKeySequence(Qt::Key_MediaStop)});
-    ui->actionPlay_Next_File->setShortcuts({ui->actionPlay_Next_File->shortcut(), QKeySequence(Qt::Key_MediaNext)});
-    ui->actionPlay_Previous_File->setShortcuts({ui->actionPlay_Previous_File->shortcut(), QKeySequence(Qt::Key_MediaPrevious)});
+    QList<QKeySequence> playShortcuts;
+    playShortcuts << ui->action_Play->shortcut() << QKeySequence(Qt::Key_MediaPlay);
+    ui->action_Play->setShortcuts(playShortcuts);
+
+    QList<QKeySequence> stopShortcuts;
+    stopShortcuts << ui->action_Stop->shortcut() << QKeySequence(Qt::Key_MediaStop);
+    ui->action_Stop->setShortcuts(stopShortcuts);
+
+    QList<QKeySequence> nextShortcuts;
+    nextShortcuts << ui->actionPlay_Next_File->shortcut() << QKeySequence(Qt::Key_MediaNext);
+    ui->actionPlay_Next_File->setShortcuts(nextShortcuts);
+
+    QList<QKeySequence> prevShortcuts;
+    prevShortcuts << ui->actionPlay_Previous_File->shortcut() << QKeySequence(Qt::Key_MediaPrevious);
+    ui->actionPlay_Previous_File->setShortcuts(prevShortcuts);
 }
 
 MainWindow::~MainWindow()
 {
-    if(current != nullptr)
+    if(current != 0)
     {
         int t = mpv->getTime(),
             l = mpv->getFileInfo().length;
@@ -848,7 +295,7 @@ MainWindow::~MainWindow()
     // see: http://qt-project.org/doc/qt-4.8/objecttrees.html
 
     // but apparently they don't (https://github.com/u8sand/Baka-MPlayer/issues/47)
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
     delete prev_toolbutton;
     delete playpause_toolbutton;
     delete next_toolbutton;
@@ -863,7 +310,7 @@ void MainWindow::Load(QString file)
     // load the settings here--the constructor has already been called
     // this solves some issues with setting things before the constructor has ended
     menuVisible = ui->menubar->isVisible(); // does the OS use a menubar? (appmenu doesn't)
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
     // add windows 7+ thubnail toolbar buttons
     thumbnail_toolbar = new QWinThumbnailToolBar(this);
     thumbnail_toolbar->setWindow(this->windowHandle());
@@ -872,31 +319,22 @@ void MainWindow::Load(QString file)
     prev_toolbutton->setEnabled(false);
     prev_toolbutton->setToolTip(tr("Previous"));
     prev_toolbutton->setIcon(QIcon(":/img/tool-previous.ico"));
-    connect(prev_toolbutton, &QWinThumbnailToolButton::clicked,
-            [=]
-            {
-                ui->playlistWidget->PlayIndex(-1, true);
-            });
+    connect(prev_toolbutton, SIGNAL(clicked()),
+            this, SLOT(handlePrevToolButtonClicked()));
 
     playpause_toolbutton = new QWinThumbnailToolButton(thumbnail_toolbar);
     playpause_toolbutton->setEnabled(false);
     playpause_toolbutton->setToolTip(tr("Play"));
     playpause_toolbutton->setIcon(QIcon(":/img/tool-play.ico"));
-    connect(playpause_toolbutton, &QWinThumbnailToolButton::clicked,
-            [=]
-            {
-                baka->PlayPause();
-            });
+    connect(playpause_toolbutton, SIGNAL(clicked()),
+            this, SLOT(handlePlayPauseToolButtonClicked()));
 
     next_toolbutton = new QWinThumbnailToolButton(thumbnail_toolbar);
     next_toolbutton->setEnabled(false);
     next_toolbutton->setToolTip(tr("Next"));
     next_toolbutton->setIcon(QIcon(":/img/tool-next.ico"));
-    connect(next_toolbutton, &QWinThumbnailToolButton::clicked,
-            [=]
-            {
-                ui->playlistWidget->PlayIndex(1, true);
-            });
+    connect(next_toolbutton, SIGNAL(clicked()),
+            this, SLOT(handleNextToolButtonClicked()));
 
     thumbnail_toolbar->addButton(prev_toolbutton);
     thumbnail_toolbar->addButton(playpause_toolbutton);
@@ -909,11 +347,11 @@ void MainWindow::Load(QString file)
 
 void MainWindow::MapShortcuts()
 {
-    auto tmp = commandActionMap;
+    QHash<QString, QAction*> tmp = commandActionMap;
     // map shortcuts to actions
-    for(auto input_iter = baka->input.begin(); input_iter != baka->input.end(); ++input_iter)
+    for(QHash<QString, QPair<QString, QString> >::iterator input_iter = baka->input.begin(); input_iter != baka->input.end(); ++input_iter)
     {
-        auto commandAction = tmp.find(input_iter->first);
+        QHash<QString, QAction*>::iterator commandAction = tmp.find(input_iter->first);
         if(commandAction != tmp.end())
         {
             (*commandAction)->setShortcut(QKeySequence(input_iter.key()));
@@ -921,7 +359,7 @@ void MainWindow::MapShortcuts()
         }
     }
     // clear the rest
-    for(auto iter = tmp.begin(); iter != tmp.end(); ++iter)
+    for(QHash<QString, QAction*>::iterator iter = tmp.begin(); iter != tmp.end(); ++iter)
         (*iter)->setShortcut(QKeySequence());
 }
 
@@ -936,12 +374,14 @@ void MainWindow::dropEvent(QDropEvent *event)
     const QMimeData *mimeData = event->mimeData();
     if(mimeData->hasUrls()) // urls
     {
-        for(QUrl &url : mimeData->urls())
+        QList<QUrl> urls = mimeData->urls();
+        for(int i = 0; i < urls.size(); ++i)
         {
+            QUrl url = urls.at(i);
             if(url.isLocalFile())
                 mpv->LoadFile(url.toLocalFile());
             else
-                mpv->LoadFile(url.url());
+                mpv->LoadFile(url.toString());
         }
     }
     else if(mimeData->hasText()) // text
@@ -1063,7 +503,7 @@ void MainWindow::keyPressEvent(QKeyEvent *event)
         }
 
         // find shortcut in input hash table
-        auto iter = baka->input.find(key);
+        QHash<QString, QPair<QString, QString> >::iterator iter = baka->input.find(key);
         if(iter != baka->input.end())
             baka->Command(iter->first); // execute command
     }
@@ -1242,19 +682,19 @@ void MainWindow::HideAlbumArt(bool hide)
 void MainWindow::UpdateRecentFiles()
 {
     ui->menu_Recently_Opened->clear();
+    recentFileActionMap.clear();
     QAction *action;
     int n = 1,
         N = recent.length();
-    for(auto &f : recent)
+    for(int i = 0; i < recent.length(); ++i)
     {
+        const Recent &f = recent.at(i);
         action = ui->menu_Recently_Opened->addAction(QString("%0. %1").arg(Util::FormatNumberWithAmpersand(n, N), Util::ShortenPathToParent(f).replace("&","&&")));
         if(n++ == 1)
             action->setShortcut(QKeySequence("Ctrl+Z"));
-        connect(action, &QAction::triggered,
-                [=]
-                {
-                    mpv->LoadFile(f);
-                });
+        recentFileActionMap[action] = f;
+        connect(action, SIGNAL(triggered()),
+                this, SLOT(handleRecentFileActionTriggered()));
     }
 }
 
@@ -1262,7 +702,7 @@ void MainWindow::SetNextButtonEnabled(bool enable)
 {
     ui->nextButton->setEnabled(enable);
     ui->actionPlay_Next_File->setEnabled(enable);
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
     next_toolbutton->setEnabled(enable);
 #endif
 }
@@ -1271,7 +711,7 @@ void MainWindow::SetPreviousButtonEnabled(bool enable)
 {
     ui->previousButton->setEnabled(enable);
     ui->actionPlay_Previous_File->setEnabled(enable);
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
     prev_toolbutton->setEnabled(enable);
 #endif
 }
@@ -1282,7 +722,7 @@ void MainWindow::SetPlayButtonIcon(bool play)
     {
         ui->playButton->setIcon(QIcon(":/img/default_play.svg"));
         ui->action_Play->setText(tr("&Play"));
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
         playpause_toolbutton->setToolTip(tr("Play"));
         playpause_toolbutton->setIcon(QIcon(":/img/tool-play.ico"));
 #endif
@@ -1291,7 +731,7 @@ void MainWindow::SetPlayButtonIcon(bool play)
     {
         ui->playButton->setIcon(QIcon(":/img/default_pause.svg"));
         ui->action_Play->setText(tr("&Pause"));
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
         playpause_toolbutton->setToolTip(tr("Pause"));
         playpause_toolbutton->setIcon(QIcon(":/img/tool-pause.ico"));
 #endif
@@ -1337,3 +777,734 @@ void MainWindow::SetRemainingLabels(int time)
         }
     }
 }
+
+void MainWindow::handleCommandActionTriggered()
+{
+    QAction *action = qobject_cast<QAction*>(sender());
+    if(action)
+    {
+        QString cmd = commandActionMap.key(action);
+        if(!cmd.isEmpty())
+            baka->Command(cmd);
+    }
+}
+
+void MainWindow::handleLangChanged(QString lang)
+{
+    if(lang == "auto") // fetch lang from locale
+        lang = QLocale::system().name();
+
+    if(lang != "en")
+    {
+        QTranslator *tmp;
+
+        // load the system translations provided by Qt
+        tmp = baka->qtTranslator;
+        baka->qtTranslator = new QTranslator();
+        baka->qtTranslator->load(QString("qt_%0").arg(lang), QLibraryInfo::location(QLibraryInfo::TranslationsPath));
+        qApp->installTranslator(baka->qtTranslator);
+        if(tmp != 0)
+            delete tmp;
+
+        // load the application translations
+        tmp = baka->translator;
+        baka->translator = new QTranslator();
+        baka->translator->load(QString("baka-mplayer_%0").arg(lang), BAKA_MPLAYER_LANG_PATH);
+        qApp->installTranslator(baka->translator);
+        if(tmp != 0)
+            delete tmp;
+    }
+    else
+    {
+        if(baka->qtTranslator != 0)
+            qApp->removeTranslator(baka->qtTranslator);
+        if(baka->translator != 0)
+            qApp->removeTranslator(baka->translator);
+    }
+
+    // save strings we want to keep
+    QString title = windowTitle(),
+            duration = ui->durationLabel->text(),
+            remaining = ui->remainingLabel->text(),
+            index = ui->indexLabel->text();
+
+    ui->retranslateUi(this);
+
+    // reload strings we kept
+    setWindowTitle(title);
+    ui->durationLabel->setText(duration);
+    ui->remainingLabel->setText(remaining);
+    ui->indexLabel->setText(index);
+}
+
+void MainWindow::handleOnTopChanged(QString onTop)
+{
+    if(onTop == "never")
+        Util::SetAlwaysOnTop(winId(), false);
+    else if(onTop == "always")
+        Util::SetAlwaysOnTop(winId(), true);
+    else if(onTop == "playing" && mpv->getPlayState() > 0)
+        Util::SetAlwaysOnTop(winId(), true);
+}
+
+void MainWindow::handleRemainingChanged()
+{
+    SetRemainingLabels(mpv->getTime());
+}
+
+void MainWindow::handleDebugChanged(bool b)
+{
+    ui->actionShow_D_ebug_Output->setChecked(b);
+    ui->verticalWidget->setVisible(b);
+    mouseMoveEvent(new QMouseEvent(QMouseEvent::MouseMove,
+                                   QCursor::pos(),
+                                   Qt::NoButton,Qt::NoButton,Qt::NoModifier));
+    if(b)
+        ui->inputLineEdit->setFocus();
+}
+
+void MainWindow::handleHideAllControlsChanged(bool b)
+{
+    HideAllControls(b);
+    blockSignals(true);
+    ui->actionHide_All_Controls->setChecked(b);
+    blockSignals(false);
+}
+
+void MainWindow::handleLeftClickPlayPauseChanged(bool b)
+{
+    if(b)
+        setContextMenuPolicy(Qt::ActionsContextMenu);
+    else if(!isFullScreen())
+        setContextMenuPolicy(Qt::NoContextMenu);
+}
+
+void MainWindow::handleSysTrayIconActivated(QSystemTrayIcon::ActivationReason reason)
+{
+    if(reason == QSystemTrayIcon::Trigger)
+    {
+        if(!hidePopup)
+        {
+            if(mpv->getPlayState() == Mpv::Playing)
+                baka->sysTrayIcon->showMessage("Baka MPlayer", tr("Playing"), QSystemTrayIcon::NoIcon, 4000);
+            else if(mpv->getPlayState() == Mpv::Paused)
+                baka->sysTrayIcon->showMessage("Baka MPlayer", tr("Paused"), QSystemTrayIcon::NoIcon, 4000);
+        }
+        baka->PlayPause();
+    }
+}
+
+void MainWindow::handleAutohideTimeout()
+{
+    if(ui->mpvFrame->geometry().contains(ui->mpvFrame->mapFromGlobal(cursor().pos())))
+        setCursor(QCursor(Qt::BlankCursor));
+    if(autohide)
+        autohide->stop();
+}
+
+void MainWindow::handleDimDialogVisibilityChanged(bool dim)
+{
+    ui->action_Dim_Lights->setChecked(dim);
+    if(dim)
+        Util::SetAlwaysOnTop(winId(), true);
+    else if(onTop == "never" || (onTop == "playing" && mpv->getPlayState() > 0))
+        Util::SetAlwaysOnTop(winId(), false);
+}
+
+void MainWindow::handlePlaylistChanged(const QStringList &list)
+{
+    if(list.length() > 1)
+    {
+        ui->actionSh_uffle->setEnabled(true);
+        ui->actionStop_after_Current->setEnabled(true);
+        ShowPlaylist(true);
+    }
+    else
+    {
+        ui->actionSh_uffle->setEnabled(false);
+        ui->actionStop_after_Current->setEnabled(false);
+    }
+
+    if(list.length() > 0)
+        ui->menuR_epeat->setEnabled(true);
+    else
+        ui->menuR_epeat->setEnabled(false);
+}
+
+void MainWindow::handleFileInfoChanged(const Mpv::FileInfo &fileInfo)
+{
+    if(mpv->getPlayState() > 0)
+    {
+        if(fileInfo.media_title == "")
+            setWindowTitle("Baka MPlayer");
+        else if(fileInfo.media_title == "-")
+            setWindowTitle("Baka MPlayer: stdin"); // todo: disable playlist?
+        else
+            setWindowTitle(fileInfo.media_title);
+
+        QString f = mpv->getFile(), file = mpv->getPath()+f;
+        if(f != QString() && maxRecent > 0)
+        {
+            int i = recent.indexOf(file);
+            if(i >= 0)
+            {
+                int t = recent.at(i).time;
+                if(t > 0 && resume)
+                    mpv->Seek(t);
+                recent.removeAt(i);
+            }
+            if(recent.isEmpty() || recent.front() != file)
+            {
+                UpdateRecentFiles(); // update after initialization and only if the current file is different from the first recent
+                while(recent.length() > maxRecent-1)
+                    recent.removeLast();
+                recent.push_front(
+                    Recent(file,
+                           (mpv->getPath() == QString() || !Util::IsValidFile(file)) ?
+                               fileInfo.media_title : QString()));
+                current = &recent.front();
+            }
+        }
+
+        // reset speed if length isn't known and we have a streaming video
+        // todo: don't save this reset, put their speed back when a normal video comes on
+        // todo: disable speed alteration during streaming media
+        if(fileInfo.length == 0)
+            if(mpv->getSpeed() != 1)
+                mpv->Speed(1);
+
+        ui->seekBar->setTracking(fileInfo.length);
+
+        if(ui->actionMedia_Info->isChecked())
+            baka->MediaInfo(true);
+
+        SetRemainingLabels(fileInfo.length);
+    }
+}
+
+void MainWindow::handleTrackListChanged(const QList<Mpv::Track> &trackList)
+{
+    if(mpv->getPlayState() > 0)
+    {
+        QAction *action;
+        bool video = false,
+             albumArt = false;
+
+        ui->menuSubtitle_Track->clear();
+        subtitleActionMap.clear();
+        ui->menuSubtitle_Track->addAction(ui->action_Add_Subtitle_File);
+        ui->menuAudio_Tracks->clear();
+        audioActionMap.clear();
+        ui->menuAudio_Tracks->addAction(ui->action_Add_Audio_File);
+        for(int track_idx = 0; track_idx < trackList.length(); ++track_idx)
+        {
+            const Mpv::Track &track = trackList.at(track_idx);
+            if(track.type == "sub")
+            {
+                action = ui->menuSubtitle_Track->addAction(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.lang + (track.external ? "*" : "")).replace("&", "&&"));
+                TrackActionData data;
+                data.trackId = track.id;
+                data.title = track.title;
+                data.lang = track.lang;
+                data.external = track.external;
+                subtitleActionMap[action] = data;
+                connect(action, SIGNAL(triggered()),
+                        this, SLOT(handleSubtitleTrackActionTriggered()));
+            }
+            else if(track.type == "audio")
+            {
+                action = ui->menuAudio_Tracks->addAction(QString("%0: %1 (%2)").arg(QString::number(track.id), track.title, track.lang).replace("&", "&&"));
+                TrackActionData data;
+                data.trackId = track.id;
+                data.title = track.title;
+                data.lang = track.lang;
+                data.external = false;
+                audioActionMap[action] = data;
+                connect(action, SIGNAL(triggered()),
+                        this, SLOT(handleAudioTrackActionTriggered()));
+            }
+            else if(track.type == "video") // video track
+            {
+                if(!track.albumart) // isn't album art
+                    video = true;
+                else
+                    albumArt = true;
+            }
+        }
+        if(video)
+        {
+            // if we were hiding album art, show it--we've gone to a video
+            if(ui->mpvFrame->styleSheet() != QString()) // remove filler album art
+                ui->mpvFrame->setStyleSheet("");
+            if(ui->action_Hide_Album_Art->isChecked())
+                HideAlbumArt(false);
+            ui->action_Hide_Album_Art->setEnabled(false);
+            ui->menuSubtitle_Track->setEnabled(true);
+            if(ui->menuSubtitle_Track->actions().count() > 1)
+            {
+                ui->menuFont_Si_ze->setEnabled(true);
+                ui->actionShow_Subtitles->setEnabled(true);
+                ui->actionShow_Subtitles->setChecked(mpv->getSubtitleVisibility());
+            }
+            else
+            {
+                ui->menuFont_Si_ze->setEnabled(false);
+                ui->actionShow_Subtitles->setEnabled(false);
+                ui->actionShow_Subtitles->setChecked(false);
+            }
+            ui->menuTake_Screenshot->setEnabled(true);
+            ui->menuFit_Window->setEnabled(true);
+            ui->menuAspect_Ratio->setEnabled(true);
+            ui->action_Frame_Step->setEnabled(true);
+            ui->actionFrame_Back_Step->setEnabled(true);
+            ui->action_Deinterlace->setEnabled(true);
+            ui->action_Motion_Interpolation->setEnabled(true);
+        }
+        else
+        {
+            if(!albumArt)
+            {
+                // put in filler albumArt
+                if(ui->mpvFrame->styleSheet() == QString())
+                    ui->mpvFrame->setStyleSheet("background-image:url(:/img/album-art.png);background-repeat:no-repeat;background-position:center;");
+            }
+            ui->action_Hide_Album_Art->setEnabled(true);
+            ui->menuSubtitle_Track->setEnabled(false);
+            ui->menuFont_Si_ze->setEnabled(false);
+            ui->actionShow_Subtitles->setEnabled(false);
+            ui->actionShow_Subtitles->setChecked(false);
+            ui->menuTake_Screenshot->setEnabled(false);
+            ui->menuFit_Window->setEnabled(false);
+            ui->menuAspect_Ratio->setEnabled(false);
+            ui->action_Frame_Step->setEnabled(false);
+            ui->actionFrame_Back_Step->setEnabled(false);
+            ui->action_Deinterlace->setEnabled(false);
+            ui->action_Motion_Interpolation->setEnabled(false);
+
+            if(baka->sysTrayIcon->isVisible() && !hidePopup)
+            {
+                // todo: use {artist} - {title}
+                baka->sysTrayIcon->showMessage("Baka MPlayer", mpv->getFileInfo().media_title, QSystemTrayIcon::NoIcon, 4000);
+            }
+        }
+
+        if(ui->menuAudio_Tracks->actions().count() == 1)
+            ui->menuAudio_Tracks->actions().first()->setEnabled(false);
+
+        if(pathChanged && autoFit)
+        {
+            baka->FitWindow(autoFit, false);
+            pathChanged = false;
+        }
+    }
+}
+
+void MainWindow::handleChaptersChanged(const QList<Mpv::Chapter> &chapters)
+{
+    if(mpv->getPlayState() > 0)
+    {
+        QAction *action;
+        QList<int> ticks;
+        int n = 1,
+            N = chapters.length();
+        ui->menu_Chapters->clear();
+        chapterActionMap.clear();
+        for(int ch_idx = 0; ch_idx < chapters.length(); ++ch_idx)
+        {
+            const Mpv::Chapter &ch = chapters.at(ch_idx);
+            action = ui->menu_Chapters->addAction(QString("%0: %1").arg(Util::FormatNumberWithAmpersand(n, N), ch.title));
+            if(n <= 9)
+                action->setShortcut(QKeySequence("Ctrl+"+QString::number(n)));
+            chapterActionMap[action] = ch.time;
+            connect(action, SIGNAL(triggered()),
+                    this, SLOT(handleChapterActionTriggered()));
+            ticks.push_back(ch.time);
+            n++;
+        }
+        if(ui->menu_Chapters->actions().count() == 0)
+        {
+            ui->menu_Chapters->setEnabled(false);
+            ui->action_Next_Chapter->setEnabled(false);
+            ui->action_Previous_Chapter->setEnabled(false);
+        }
+        else
+        {
+            ui->menu_Chapters->setEnabled(true);
+            ui->action_Next_Chapter->setEnabled(true);
+            ui->action_Previous_Chapter->setEnabled(true);
+        }
+
+        ui->seekBar->setTicks(ticks);
+    }
+}
+
+void MainWindow::handlePlayStateChanged(Mpv::PlayState playState)
+{
+    switch(playState)
+    {
+    case Mpv::Loaded:
+        baka->mpv->ShowText("Loading...", 0);
+        break;
+
+    case Mpv::Started:
+        if(!init) // will only happen the first time a file is loaded.
+        {
+            ui->action_Play->setEnabled(true);
+            ui->playButton->setEnabled(true);
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
+            playpause_toolbutton->setEnabled(true);
+#endif
+            ui->playlistButton->setEnabled(true);
+            ui->action_Show_Playlist->setEnabled(true);
+            ui->menuAudio_Tracks->setEnabled(true);
+            init = true;
+        }
+        SetPlaybackControls(true);
+        mpv->Play();
+        baka->overlay->showStatusText(QString(), 0);
+    case Mpv::Playing:
+        SetPlayButtonIcon(false);
+        if(onTop == "playing")
+            Util::SetAlwaysOnTop(winId(), true);
+        break;
+
+    case Mpv::Paused:
+    case Mpv::Stopped:
+        SetPlayButtonIcon(true);
+        if(onTop == "playing")
+            Util::SetAlwaysOnTop(winId(), false);
+        break;
+
+    case Mpv::Idle:
+        if(init)
+        {
+            if(ui->action_This_File->isChecked()) // repeat this file
+                ui->playlistWidget->PlayIndex(0, true); // restart file
+            else if(ui->actionStop_after_Current->isChecked() ||  // stop after playing this file
+                    ui->playlistWidget->CurrentIndex() >= ui->playlistWidget->count()-1) // end of the playlist
+            {
+                if(!ui->actionStop_after_Current->isChecked() && // not supposed to stop after current
+                    ui->action_Playlist->isChecked() && // we're supposed to restart the playlist
+                    ui->playlistWidget->count() > 0) // playlist isn't empty
+                {
+                    ui->playlistWidget->PlayIndex(0); // restart playlist
+                }
+                else // stop
+                {
+                    setWindowTitle("Baka MPlayer");
+                    SetPlaybackControls(false);
+                    ui->seekBar->setTracking(0);
+                    ui->actionStop_after_Current->setChecked(false);
+                    if(ui->mpvFrame->styleSheet() != QString()) // remove filler album art
+                        ui->mpvFrame->setStyleSheet("");
+                }
+            }
+            else
+                ui->playlistWidget->PlayIndex(1, true);
+        }
+        break;
+    }
+}
+
+void MainWindow::handlePathChanged()
+{
+    pathChanged = true;
+}
+
+void MainWindow::handleFileChanging(int t, int l)
+{
+    if(current != 0)
+    {
+        if(t > 0.05*l && t < 0.95*l) // only save if within the middle 90%
+            current->time = t;
+        else
+            current->time = 0;
+    }
+}
+
+void MainWindow::handleTimeChanged(int i)
+{
+    const Mpv::FileInfo &fi = mpv->getFileInfo();
+    // set the seekBar's location with NoSignal function so that it doesn't trigger a seek
+    // the formula is a simple ratio seekBar's max * time/totalTime
+    ui->seekBar->setValueNoSignal(ui->seekBar->maximum()*((double)i/fi.length));
+
+    SetRemainingLabels(i);
+
+    // set next/previous chapter's enabled state
+    if(fi.chapters.length() > 0)
+    {
+        ui->action_Next_Chapter->setEnabled(i < fi.chapters.last().time);
+        ui->action_Previous_Chapter->setEnabled(i > fi.chapters.first().time);
+    }
+}
+
+void MainWindow::handleVolumeChanged(int volume)
+{
+    ui->volumeSlider->setValueNoSignal(volume);
+}
+
+void MainWindow::handleSpeedChanged(double speed)
+{
+    static double last = 1;
+    if(last != speed)
+    {
+        if(init)
+            mpv->ShowText(tr("Speed: %0x").arg(QString::number(speed)));
+        if(speed <= 0.25)
+            ui->action_Decrease->setEnabled(false);
+        else
+            ui->action_Decrease->setEnabled(true);
+        last = speed;
+    }
+}
+
+void MainWindow::handleSidChanged(int sid)
+{
+    QList<QAction*> actions = ui->menuSubtitle_Track->actions();
+    for(int i = 0; i < actions.size(); ++i)
+    {
+        QAction *action = actions.at(i);
+        if(action->text().startsWith(QString::number(sid)))
+        {
+            action->setCheckable(true);
+            action->setChecked(true);
+        }
+        else
+            action->setChecked(false);
+    }
+}
+
+void MainWindow::handleAidChanged(int aid)
+{
+    QList<QAction*> actions = ui->menuAudio_Tracks->actions();
+    for(int i = 0; i < actions.size(); ++i)
+    {
+        QAction *action = actions.at(i);
+        if(action->text().startsWith(QString::number(aid)))
+        {
+            action->setCheckable(true);
+            action->setChecked(true);
+        }
+        else
+            action->setChecked(false);
+    }
+}
+
+void MainWindow::handleSubtitleVisibilityChanged(bool b)
+{
+    if(ui->actionShow_Subtitles->isEnabled())
+        ui->actionShow_Subtitles->setChecked(b);
+    if(init)
+        mpv->ShowText(b ? tr("Subtitles visible") : tr("Subtitles hidden"));
+}
+
+void MainWindow::handleMuteChanged(bool b)
+{
+    if(b)
+        ui->muteButton->setIcon(QIcon(":/img/default_mute.svg"));
+    else
+        ui->muteButton->setIcon(QIcon(":/img/default_unmute.svg"));
+    mpv->ShowText(b ? tr("Muted") : tr("Unmuted"));
+}
+
+void MainWindow::handleVoChanged(QString vo)
+{
+    ui->action_Motion_Interpolation->setChecked(vo.contains("interpolation"));
+}
+
+void MainWindow::handleSeekBarValueChanged(int i)
+{
+    mpv->Seek(mpv->Relative(((double)i/ui->seekBar->maximum())*mpv->getFileInfo().length), true);
+}
+
+void MainWindow::handleOpenButtonLeftClick()
+{
+    baka->Open();
+}
+
+void MainWindow::handleOpenButtonMiddleClick()
+{
+    baka->Jump();
+}
+
+void MainWindow::handleOpenButtonRightClick()
+{
+    baka->OpenLocation();
+}
+
+void MainWindow::handleRewindButtonClicked()
+{
+    mpv->Rewind();
+}
+
+void MainWindow::handlePreviousButtonClicked()
+{
+    ui->playlistWidget->PlayIndex(-1, true);
+}
+
+void MainWindow::handlePlayButtonClicked()
+{
+    baka->PlayPause();
+}
+
+void MainWindow::handleNextButtonClicked()
+{
+    ui->playlistWidget->PlayIndex(1, true);
+}
+
+void MainWindow::handleMuteButtonClicked()
+{
+    mpv->Mute(!mpv->getMute());
+}
+
+void MainWindow::handleVolumeSliderValueChanged(int i)
+{
+    mpv->Volume(i, true);
+}
+
+void MainWindow::handlePlaylistButtonClicked()
+{
+    TogglePlaylist();
+}
+
+void MainWindow::handleSplitterPositionChanged(int i)
+{
+    blockSignals(true);
+    if(i == 0) // right-most, playlist is hidden
+    {
+        ui->action_Show_Playlist->setChecked(false);
+        ui->action_Hide_Album_Art->setChecked(false);
+        ui->playlistLayoutWidget->setVisible(false);
+    }
+    else if(i == ui->splitter->max()) // left-most, album art is hidden, playlist is visible
+    {
+        ui->action_Show_Playlist->setChecked(true);
+        ui->action_Hide_Album_Art->setChecked(true);
+    }
+    else // in the middle, album art is visible, playlist is visible
+    {
+        ui->action_Show_Playlist->setChecked(true);
+        ui->action_Hide_Album_Art->setChecked(false);
+    }
+    ui->playlistLayoutWidget->setVisible(ui->action_Show_Playlist->isChecked());
+    blockSignals(false);
+    if(ui->actionMedia_Info->isChecked())
+        baka->overlay->showInfoText();
+}
+
+void MainWindow::handleSearchBoxTextChanged(QString s)
+{
+    ui->playlistWidget->Search(s);
+}
+
+void MainWindow::handleIndexLabelClicked()
+{
+    bool ok;
+    int count = ui->playlistWidget->count();
+    int result = QInputDialog::getInt(this,
+                                      tr("Enter File Number"),
+                                      tr("Enter the file number you want to play:\nNote: Value must be from %0 - %1").arg("1", QString::number(count)),
+                                      1, 1, count, 1, &ok);
+    if(ok)
+        ui->playlistWidget->PlayIndex(result-1); // user index will be 1 greater than actual
+}
+
+void MainWindow::handlePlaylistWidgetCurrentRowChanged(int)
+{
+    SetIndexLabels(true);
+}
+
+void MainWindow::handleCurrentFileButtonClicked()
+{
+    ui->playlistWidget->SelectIndex(ui->playlistWidget->CurrentIndex());
+}
+
+void MainWindow::handleRefreshButtonClicked()
+{
+    ui->playlistWidget->RefreshPlaylist();
+}
+
+void MainWindow::handleInputLineEditSubmitted(QString s)
+{
+    baka->Command(s);
+    ui->inputLineEdit->setText("");
+}
+
+void MainWindow::handleSubtitleTrackActionTriggered()
+{
+    QAction *action = qobject_cast<QAction*>(sender());
+    if(action && subtitleActionMap.contains(action))
+    {
+        TrackActionData track = subtitleActionMap[action];
+        // basically, if you uncheck the selected subtitle id, we hide subtitles
+        // when you check a subtitle id, we make sure subtitles are showing and set it
+        if(mpv->getSid() == track.trackId)
+        {
+            if(mpv->getSubtitleVisibility())
+            {
+                mpv->ShowSubtitles(false);
+                return;
+            }
+            else
+                mpv->ShowSubtitles(true);
+        }
+        else if(!mpv->getSubtitleVisibility())
+            mpv->ShowSubtitles(true);
+        mpv->Sid(track.trackId);
+        mpv->ShowText(QString("%0 %1: %2 (%3)").arg(tr("Sub"), QString::number(track.trackId), track.title, track.lang + (track.external ? "*" : "")));
+    }
+}
+
+void MainWindow::handleAudioTrackActionTriggered()
+{
+    QAction *action = qobject_cast<QAction*>(sender());
+    if(action && audioActionMap.contains(action))
+    {
+        TrackActionData track = audioActionMap[action];
+        if(mpv->getAid() != track.trackId) // don't allow selection of the same track
+        {
+            mpv->Aid(track.trackId);
+            mpv->ShowText(QString("%0 %1: %2 (%3)").arg(tr("Audio"), QString::number(track.trackId), track.title, track.lang));
+        }
+        else
+            action->setChecked(true); // recheck the track
+    }
+}
+
+void MainWindow::handleChapterActionTriggered()
+{
+    QAction *action = qobject_cast<QAction*>(sender());
+    if(action && chapterActionMap.contains(action))
+    {
+        int time = chapterActionMap[action];
+        mpv->Seek(time);
+    }
+}
+
+void MainWindow::handleRecentFileActionTriggered()
+{
+    QAction *action = qobject_cast<QAction*>(sender());
+    if(action && recentFileActionMap.contains(action))
+    {
+        QString file = recentFileActionMap[action];
+        mpv->LoadFile(file);
+    }
+}
+
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
+void MainWindow::handlePrevToolButtonClicked()
+{
+    ui->playlistWidget->PlayIndex(-1, true);
+}
+
+void MainWindow::handlePlayPauseToolButtonClicked()
+{
+    baka->PlayPause();
+}
+
+void MainWindow::handleNextToolButtonClicked()
+{
+    ui->playlistWidget->PlayIndex(1, true);
+}
+#endif
diff --git a/src/ui/mainwindow.h b/src/ui/mainwindow.h
index 6d0f8b1..10901ee 100644
--- a/src/ui/mainwindow.h
+++ b/src/ui/mainwindow.h
@@ -14,12 +14,15 @@
 #include <QAction>
 #include <QRect>
 
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
 #include <QWinThumbnailToolBar>
 #include <QWinThumbnailToolButton>
 #endif
 
 #include "recent.h"
+#include "mpvtypes.h"
+
+#include <QSystemTrayIcon>
 
 namespace Ui {
 class MainWindow;
@@ -83,12 +86,76 @@ private slots:
     void SetNextButtonEnabled(bool enable);
     void SetPreviousButtonEnabled(bool enable);
     void SetRemainingLabels(int time);
+    // Slots for signal connections (converted from lambdas)
+    void handleCommandActionTriggered();
+    void handleLangChanged(QString lang);
+    void handleOnTopChanged(QString onTop);
+    void handleRemainingChanged();
+    void handleDebugChanged(bool b);
+    void handleHideAllControlsChanged(bool b);
+    void handleLeftClickPlayPauseChanged(bool b);
+    void handleSysTrayIconActivated(QSystemTrayIcon::ActivationReason reason);
+    void handleAutohideTimeout();
+    void handleDimDialogVisibilityChanged(bool dim);
+    void handlePlaylistChanged(const QStringList &list);
+    void handleFileInfoChanged(const Mpv::FileInfo &fileInfo);
+    void handleTrackListChanged(const QList<Mpv::Track> &trackList);
+    void handleChaptersChanged(const QList<Mpv::Chapter> &chapters);
+    void handlePlayStateChanged(Mpv::PlayState playState);
+    void handlePathChanged();
+    void handleFileChanging(int t, int l);
+    void handleTimeChanged(int i);
+    void handleVolumeChanged(int volume);
+    void handleSpeedChanged(double speed);
+    void handleSidChanged(int sid);
+    void handleAidChanged(int aid);
+    void handleSubtitleVisibilityChanged(bool b);
+    void handleMuteChanged(bool b);
+    void handleVoChanged(QString vo);
+    void handleSeekBarValueChanged(int i);
+    void handleOpenButtonLeftClick();
+    void handleOpenButtonMiddleClick();
+    void handleOpenButtonRightClick();
+    void handleRewindButtonClicked();
+    void handlePreviousButtonClicked();
+    void handlePlayButtonClicked();
+    void handleNextButtonClicked();
+    void handleMuteButtonClicked();
+    void handleVolumeSliderValueChanged(int i);
+    void handlePlaylistButtonClicked();
+    void handleSplitterPositionChanged(int i);
+    void handleSearchBoxTextChanged(QString s);
+    void handleIndexLabelClicked();
+    void handlePlaylistWidgetCurrentRowChanged(int);
+    void handleCurrentFileButtonClicked();
+    void handleRefreshButtonClicked();
+    void handleInputLineEditSubmitted(QString s);
+    void handleSubtitleTrackActionTriggered();
+    void handleAudioTrackActionTriggered();
+    void handleChapterActionTriggered();
+    void handleRecentFileActionTriggered();
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
+    void handlePrevToolButtonClicked();
+    void handlePlayPauseToolButtonClicked();
+    void handleNextToolButtonClicked();
+#endif
 
 private:
+    // Helper structure to store track/chapter data for dynamic actions
+    struct TrackActionData {
+        int trackId;
+        QString title;
+        QString lang;
+        bool external;
+    };
+    QMap<QAction*, TrackActionData> subtitleActionMap;
+    QMap<QAction*, TrackActionData> audioActionMap;
+    QMap<QAction*, int> chapterActionMap;
+    QMap<QAction*, QString> recentFileActionMap;
     BakaEngine      *baka;
     MpvHandler      *mpv;
 
-#if defined(Q_OS_WIN)
+#if defined(Q_OS_WIN) && QT_VERSION >= 0x050000
     QWinThumbnailToolBar    *thumbnail_toolbar;
     QWinThumbnailToolButton *prev_toolbutton,
                             *playpause_toolbutton,
@@ -96,14 +163,14 @@ private:
 #endif
     bool            pathChanged,
                     menuVisible,
-                    firstItem       = false,
-                    init            = false,
-                    playlistState   = false;
-    QTimer          *autohide       = nullptr;
+                    firstItem,
+                    init,
+                    playlistState;
+    QTimer          *autohide;
 
     // variables
     QList<Recent> recent;
-    Recent *current = nullptr;
+    Recent *current;
     QString lang,
             onTop;
     int autoFit,
@@ -115,7 +182,7 @@ private:
          gestures,
          leftClickPlayPause,
          resume,
-         hideAllControls = false;
+         hideAllControls;
     QHash<QString, QAction*> commandActionMap;
 
 public slots:
diff --git a/src/ui/mainwindow.ui b/src/ui/mainwindow.ui
index e196777..be486d1 100644
--- a/src/ui/mainwindow.ui
+++ b/src/ui/mainwindow.ui
@@ -263,9 +263,6 @@ QScrollBar::right-arrow:horizontal {
            <property name="placeholderText">
             <string>&gt;</string>
            </property>
-           <property name="clearButtonEnabled">
-            <bool>true</bool>
-           </property>
           </widget>
          </item>
         </layout>
@@ -305,9 +302,6 @@ QScrollBar::right-arrow:horizontal {
           <property name="placeholderText">
            <string>Search Playlist</string>
           </property>
-          <property name="clearButtonEnabled">
-           <bool>true</bool>
-          </property>
          </widget>
         </item>
         <item>
diff --git a/src/ui/preferencesdialog.cpp b/src/ui/preferencesdialog.cpp
index e3f06cd..4d58202 100644
--- a/src/ui/preferencesdialog.cpp
+++ b/src/ui/preferencesdialog.cpp
@@ -34,96 +34,47 @@ PreferencesDialog::PreferencesDialog(BakaEngine *baka, QWidget *parent) :
     ui->hidePopupCheckBox->setChecked(baka->window->getHidePopup());
     ui->gestureCheckBox->setChecked(baka->window->getGestures());
     ui->leftClickPlayPauseCheckBox->setChecked(baka->window->getLeftClickPlayPause());
-    ui->langComboBox->setCurrentText(baka->window->getLang());
+    ui->langComboBox->setCurrentIndex(ui->langComboBox->findText(baka->window->getLang()));
     int autofit = baka->window->getAutoFit();
     ui->autoFitCheckBox->setChecked((bool)autofit);
-    ui->comboBox->setCurrentText(QString::number(autofit)+"%");
+    ui->comboBox->setCurrentIndex(ui->comboBox->findText(QString::number(autofit)+"%"));
     ui->gestureCheckBox->setChecked(baka->window->getGestures());
     int maxRecent= baka->window->getMaxRecent();
     ui->recentCheckBox->setChecked(maxRecent > 0);
     ui->recentSpinBox->setValue(maxRecent);
     ui->resumeCheckBox->setChecked(baka->window->getResume());
-    ui->formatComboBox->setCurrentText(baka->mpv->getScreenshotFormat());
+    ui->formatComboBox->setCurrentIndex(ui->formatComboBox->findText(baka->mpv->getScreenshotFormat()));
     screenshotDir = QDir::toNativeSeparators(baka->mpv->getScreenshotDir());
     ui->templateLineEdit->setText(baka->mpv->getScreenshotTemplate());
-    ui->msgLvlComboBox->setCurrentText(baka->mpv->getMsgLevel());
+    ui->msgLvlComboBox->setCurrentIndex(ui->msgLvlComboBox->findText(baka->mpv->getMsgLevel()));
 
     // add shortcuts
     saved = baka->input;
     PopulateShortcuts();
 
-    connect(ui->autoFitCheckBox, &QCheckBox::clicked,
-            [=](bool b)
-            {
-                ui->comboBox->setEnabled(b);
-            });
+    connect(ui->autoFitCheckBox, SIGNAL(clicked(bool)),
+            this, SLOT(handleAutoFitCheckBoxClicked(bool)));
 
-    connect(ui->changeButton, &QPushButton::clicked,
-            [=]
-            {
-                QString dir = QFileDialog::getExistingDirectory(this, tr("Choose screenshot directory"), screenshotDir);
-                if(dir != QString())
-                    screenshotDir = dir;
-            });
+    connect(ui->changeButton, SIGNAL(clicked()),
+            this, SLOT(handleChangeButtonClicked()));
 
-    connect(ui->addKeyButton, &QPushButton::clicked,
-            [=]
-            {
-                SelectKey(true);
-            });
+    connect(ui->addKeyButton, SIGNAL(clicked()),
+            this, SLOT(handleAddKeyButtonClicked()));
 
-    connect(ui->editKeyButton, &QPushButton::clicked,
-            [=]
-            {
-                int i = ui->infoWidget->currentRow();
-                if(i == -1)
-                    return;
-
-                SelectKey(false,
-                    {ui->infoWidget->item(i, 0)->text(),
-                    {ui->infoWidget->item(i, 1)->text(),
-                     ui->infoWidget->item(i, 2)->text()}});
-            });
-
-    connect(ui->resetKeyButton, &QPushButton::clicked,
-            [=]
-            {
-                if(QMessageBox::question(this, tr("Reset All Key Bindings?"), tr("Are you sure you want to reset all shortcut keys to its original bindings?")) == QMessageBox::Yes)
-                {
-                    baka->input = baka->default_input;
-                    while(numberOfShortcuts > 0)
-                        RemoveRow(numberOfShortcuts-1);
-                    PopulateShortcuts();
-                }
-            });
+    connect(ui->editKeyButton, SIGNAL(clicked()),
+            this, SLOT(handleEditKeyButtonClicked()));
 
-    connect(ui->removeKeyButton, &QPushButton::clicked,
-            [=]
-            {
-                int row = ui->infoWidget->currentRow();
-                if(row == -1)
-                    return;
+    connect(ui->resetKeyButton, SIGNAL(clicked()),
+            this, SLOT(handleResetKeyButtonClicked()));
 
-                baka->input[ui->infoWidget->item(row, 0)->text()] = {QString(), QString()};
-                RemoveRow(row);
-            });
+    connect(ui->removeKeyButton, SIGNAL(clicked()),
+            this, SLOT(handleRemoveKeyButtonClicked()));
 
-    connect(ui->infoWidget, &QTableWidget::currentCellChanged,
-            [=](int r,int,int,int)
-            {
-                ui->editKeyButton->setEnabled(r != -1);
-                ui->removeKeyButton->setEnabled(r != -1);
-            });
+    connect(ui->infoWidget, SIGNAL(currentCellChanged(int,int,int,int)),
+            this, SLOT(handleInfoWidgetCurrentCellChanged(int,int,int,int)));
 
-    connect(ui->infoWidget, &QTableWidget::doubleClicked,
-            [=](const QModelIndex &index)
-            {
-                int i = index.row();
-                SelectKey(false,
-                    {ui->infoWidget->item(i, 0)->text(),
-                    {ui->infoWidget->item(i, 1)->text(),
-                     ui->infoWidget->item(i, 2)->text()}});
-            });
+    connect(ui->infoWidget, SIGNAL(doubleClicked(QModelIndex)),
+            this, SLOT(handleInfoWidgetDoubleClicked(QModelIndex)));
 
     connect(ui->recentCheckBox, SIGNAL(toggled(bool)),
             ui->recentSpinBox, SLOT(setEnabled(bool)));
@@ -182,12 +133,15 @@ void PreferencesDialog::PopulateLangs()
     QDir root(BAKA_MPLAYER_LANG_PATH);
     // get files in the directory with .qm extension
     QFileInfoList flist;
-    flist = root.entryInfoList({"*.qm"}, QDir::Files);
+    QStringList filters;
+    filters << "*.qm";
+    flist = root.entryInfoList(filters, QDir::Files);
     // add the languages to the combo box
     ui->langComboBox->addItem("auto");
-    for(auto &i : flist)
+    for(int i = 0; i < flist.length(); ++i)
     {
-        QString lang = i.fileName().mid(i.fileName().indexOf("_") + 1); // baka-mplayer_....
+        QFileInfo fileInfo = flist.at(i);
+        QString lang = fileInfo.fileName().mid(fileInfo.fileName().indexOf("_") + 1); // baka-mplayer_....
         lang.chop(3); // -  .qm
         ui->langComboBox->addItem(lang);
     }
@@ -197,7 +151,7 @@ void PreferencesDialog::PopulateShortcuts()
 {
     sortLock->lock();
     numberOfShortcuts = 0;
-    for(auto iter = baka->input.begin(); iter != baka->input.end(); ++iter)
+    for(QHash<QString, QPair<QString, QString> >::iterator iter = baka->input.begin(); iter != baka->input.end(); ++iter)
     {
         QPair<QString, QString> p = iter.value();
         if(p.first == QString() || p.second == QString())
@@ -241,15 +195,15 @@ void PreferencesDialog::RemoveRow(int row)
         sortLock->unlock();
 }
 
-void PreferencesDialog::SelectKey(bool add, QPair<QString, QPair<QString, QString>> init)
+void PreferencesDialog::SelectKey(bool add, QPair<QString, QPair<QString, QString> > init)
 {
     sortLock->lock();
     KeyDialog dialog(this);
     int status = 0;
     while(status != 2)
     {
-        QPair<QString, QPair<QString, QString>> result = dialog.SelectKey(add, init);
-        if(result == QPair<QString, QPair<QString, QString>>()) // cancel
+        QPair<QString, QPair<QString, QString> > result = dialog.SelectKey(add, init);
+        if(result == QPair<QString, QPair<QString, QString> >()) // cancel
             break;
         for(int i = 0; i < numberOfShortcuts; ++i)
         {
@@ -262,7 +216,7 @@ void PreferencesDialog::SelectKey(bool add, QPair<QString, QPair<QString, QStrin
                        tr("%0 is already being used. Would you like to change its function?").arg(
                            result.first)) == QMessageBox::Yes)
                 {
-                    baka->input[ui->infoWidget->item(i, 0)->text()] = {QString(), QString()};
+                    baka->input[ui->infoWidget->item(i, 0)->text()] = qMakePair(QString(), QString());
                     RemoveRow(i);
                     status = 0;
                 }
@@ -281,7 +235,7 @@ void PreferencesDialog::SelectKey(bool add, QPair<QString, QPair<QString, QStrin
             else // change
             {
                 if(result.first != init.first)
-                    baka->input[init.first] = {QString(), QString()};
+                    baka->input[init.first] = qMakePair(QString(), QString());
                 ModifyRow(ui->infoWidget->currentRow(), result.first, result.second.first, result.second.second);
             }
             baka->input[result.first] = result.second;
@@ -306,3 +260,68 @@ void PreferencesDialog::SortLock::unlock()
     QMutex::unlock();
     parent->setSortingEnabled(true);
 }
+
+void PreferencesDialog::handleAutoFitCheckBoxClicked(bool b)
+{
+    ui->comboBox->setEnabled(b);
+}
+
+void PreferencesDialog::handleChangeButtonClicked()
+{
+    QString dir = QFileDialog::getExistingDirectory(this, tr("Choose screenshot directory"), screenshotDir);
+    if(dir != QString())
+        screenshotDir = dir;
+}
+
+void PreferencesDialog::handleAddKeyButtonClicked()
+{
+    SelectKey(true);
+}
+
+void PreferencesDialog::handleEditKeyButtonClicked()
+{
+    int i = ui->infoWidget->currentRow();
+    if(i == -1)
+        return;
+
+    SelectKey(false,
+        qMakePair(ui->infoWidget->item(i, 0)->text(),
+        qMakePair(ui->infoWidget->item(i, 1)->text(),
+         ui->infoWidget->item(i, 2)->text())));
+}
+
+void PreferencesDialog::handleResetKeyButtonClicked()
+{
+    if(QMessageBox::question(this, tr("Reset All Key Bindings?"), tr("Are you sure you want to reset all shortcut keys to its original bindings?")) == QMessageBox::Yes)
+    {
+        baka->input = baka->default_input;
+        while(numberOfShortcuts > 0)
+            RemoveRow(numberOfShortcuts-1);
+        PopulateShortcuts();
+    }
+}
+
+void PreferencesDialog::handleRemoveKeyButtonClicked()
+{
+    int row = ui->infoWidget->currentRow();
+    if(row == -1)
+        return;
+
+    baka->input[ui->infoWidget->item(row, 0)->text()] = qMakePair(QString(), QString());
+    RemoveRow(row);
+}
+
+void PreferencesDialog::handleInfoWidgetCurrentCellChanged(int r, int, int, int)
+{
+    ui->editKeyButton->setEnabled(r != -1);
+    ui->removeKeyButton->setEnabled(r != -1);
+}
+
+void PreferencesDialog::handleInfoWidgetDoubleClicked(const QModelIndex &index)
+{
+    int i = index.row();
+    SelectKey(false,
+        qMakePair(ui->infoWidget->item(i, 0)->text(),
+        qMakePair(ui->infoWidget->item(i, 1)->text(),
+         ui->infoWidget->item(i, 2)->text())));
+}
diff --git a/src/ui/preferencesdialog.h b/src/ui/preferencesdialog.h
index 5b3bfc4..04e659d 100644
--- a/src/ui/preferencesdialog.h
+++ b/src/ui/preferencesdialog.h
@@ -28,12 +28,22 @@ protected:
     void AddRow(QString first, QString second, QString third);
     void ModifyRow(int row, QString first, QString second, QString third);
     void RemoveRow(int row);
-    void SelectKey(bool add, QPair<QString, QPair<QString, QString>> init = (QPair<QString, QPair<QString, QString>>()));
+    void SelectKey(bool add, QPair<QString, QPair<QString, QString> > init = (QPair<QString, QPair<QString, QString> >()));
+
+private slots:
+    void handleAutoFitCheckBoxClicked(bool b);
+    void handleChangeButtonClicked();
+    void handleAddKeyButtonClicked();
+    void handleEditKeyButtonClicked();
+    void handleResetKeyButtonClicked();
+    void handleRemoveKeyButtonClicked();
+    void handleInfoWidgetCurrentCellChanged(int r, int, int, int);
+    void handleInfoWidgetDoubleClicked(const QModelIndex &index);
 
 private:
     Ui::PreferencesDialog *ui;
     BakaEngine *baka;
-    QHash<QString, QPair<QString, QString>> saved;
+    QHash<QString, QPair<QString, QString> > saved;
 
     QString screenshotDir;
     int numberOfShortcuts;
diff --git a/src/ui/screenshotdialog.cpp b/src/ui/screenshotdialog.cpp
index 7ef0999..3336ddd 100644
--- a/src/ui/screenshotdialog.cpp
+++ b/src/ui/screenshotdialog.cpp
@@ -7,6 +7,7 @@
 ScreenshotDialog::ScreenshotDialog(bool &_always, bool &_screenshot, MpvHandler *mpv, QWidget *parent) :
     QDialog(parent),
     ui(new Ui::ScreenshotDialog),
+    mpv(mpv),
     always(_always),
     screenshot(_screenshot)
 {
@@ -15,30 +16,16 @@ ScreenshotDialog::ScreenshotDialog(bool &_always, bool &_screenshot, MpvHandler
     ui->showCheckBox->setChecked(always);
     ui->subtitlesCheckBox->setChecked(screenshot);
     ui->templateEdit->setText(mpv->getScreenshotTemplate());
-    ui->formatComboBox->setCurrentText(mpv->getScreenshotFormat());
+    ui->formatComboBox->setCurrentIndex(ui->formatComboBox->findText(mpv->getScreenshotFormat()));
 
     ui->locationEdit->setText(QDir::toNativeSeparators(mpv->getScreenshotDir()));
     ui->templateEdit->setText(mpv->getScreenshotTemplate());
 
-    connect(ui->browseButton, &QPushButton::clicked,
-            [=]
-            {
-                QString dir = QFileDialog::getExistingDirectory(this, tr("Choose screenshot directory"), ui->locationEdit->text());
-                if(dir != QString())
-                    ui->locationEdit->setText(dir);
-            });
-
-    connect(ui->saveButton, &QPushButton::clicked,
-            [=]
-            {
-                mpv->ScreenshotFormat(ui->formatComboBox->currentText());
-                mpv->ScreenshotDirectory(QDir::fromNativeSeparators(ui->locationEdit->text()));
-                mpv->ScreenshotTemplate(ui->templateEdit->text());
-                always = ui->showCheckBox->isChecked();
-                screenshot = ui->subtitlesCheckBox->isChecked();
-                mpv->Screenshot(screenshot);
-                accept();
-            });
+    connect(ui->browseButton, SIGNAL(clicked()),
+            this, SLOT(handleBrowseButtonClicked()));
+
+    connect(ui->saveButton, SIGNAL(clicked()),
+            this, SLOT(handleSaveButtonClicked()));
 }
 
 ScreenshotDialog::~ScreenshotDialog()
@@ -51,3 +38,21 @@ int ScreenshotDialog::showScreenshotDialog(bool &always, bool &screenshot, MpvHa
     ScreenshotDialog dialog(always, screenshot, mpv, parent);
     return dialog.exec();
 }
+
+void ScreenshotDialog::handleBrowseButtonClicked()
+{
+    QString dir = QFileDialog::getExistingDirectory(this, tr("Choose screenshot directory"), ui->locationEdit->text());
+    if(dir != QString())
+        ui->locationEdit->setText(dir);
+}
+
+void ScreenshotDialog::handleSaveButtonClicked()
+{
+    mpv->ScreenshotFormat(ui->formatComboBox->currentText());
+    mpv->ScreenshotDirectory(QDir::fromNativeSeparators(ui->locationEdit->text()));
+    mpv->ScreenshotTemplate(ui->templateEdit->text());
+    always = ui->showCheckBox->isChecked();
+    screenshot = ui->subtitlesCheckBox->isChecked();
+    mpv->Screenshot(screenshot);
+    accept();
+}
diff --git a/src/ui/screenshotdialog.h b/src/ui/screenshotdialog.h
index 35ecc94..320fbf2 100644
--- a/src/ui/screenshotdialog.h
+++ b/src/ui/screenshotdialog.h
@@ -19,8 +19,14 @@ public:
     ~ScreenshotDialog();
 
     static int showScreenshotDialog(bool &always, bool &screenshot, MpvHandler *mpv, QWidget *parent = 0);
+
+private slots:
+    void handleBrowseButtonClicked();
+    void handleSaveButtonClicked();
+
 private:
     Ui::ScreenshotDialog *ui;
+    MpvHandler *mpv;
     bool &always,
          &screenshot;
 };
diff --git a/src/ui/updatedialog.cpp b/src/ui/updatedialog.cpp
index ca2e2de..ceab4cc 100644
--- a/src/ui/updatedialog.cpp
+++ b/src/ui/updatedialog.cpp
@@ -11,7 +11,12 @@ UpdateDialog::UpdateDialog(BakaEngine *baka, QWidget *parent) :
     QDialog(parent),
     ui(new Ui::UpdateDialog),
     baka(baka),
-    timer(nullptr),
+    timer(0),
+    avgSpeed(1),
+    lastSpeed(0),
+    lastProgress(0),
+    lastTime(0),
+    state(0),
     init(false)
 {
     ui->setupUi(this);
@@ -23,73 +28,15 @@ UpdateDialog::UpdateDialog(BakaEngine *baka, QWidget *parent) :
     ui->cancelButton->setDefault(true);
 #endif
 
-    connect(baka->update, &UpdateManager::progressSignal,
-            [=](int percent)
-            {
-                ui->progressBar->setValue(percent);
-                if(percent == 100)
-                {
-                    ui->updateLabel->setText(tr("Download Complete"));
-                    ui->progressBar->setVisible(false);
-                    ui->timeRemainingLabel->setVisible(false);
-                    if(timer != nullptr)
-                    {
-                        delete timer;
-                        timer = nullptr;
-                    }
-
-                    if(!init)
-                    {
-                        ShowInfo();
-                        init = false;
-                    }
-                }
-                else if(percent == 0)
-                {
-                    avgSpeed = 0;
-                    lastSpeed = 0;
-                    lastProgress = 0;
-                    lastTime = 0;
-                    ui->progressBar->setValue(0);
-                    ui->progressBar->setVisible(true);
-                    ui->timeRemainingLabel->setText(QString());
-                    ui->timeRemainingLabel->setVisible(true);
-                    if(timer != nullptr)
-                        delete timer;
-                    timer = new QTime();
-                    timer->start();
-                }
-                else if(timer) // don't execute this if timer is not defined--this shouldn't happen though.. but it does
-                {
-                    avgSpeed = 0.005*lastSpeed + 0.995*avgSpeed;
-
-                    if(avgSpeed > 0)
-                        ui->timeRemainingLabel->setText(tr("About %0 second(s) remaining").arg(QString::number(1/(1000*avgSpeed))));
-                    else
-                        ui->timeRemainingLabel->setText(tr("Calculating..."));
-
-                    int time = timer->elapsed();
-                    if(time != lastTime) // prevent cases when we're too fast haha
-                        lastSpeed = (percent-lastProgress)/(time-lastTime);
-
-                    lastTime = time;
-                    lastProgress = percent;
-                }
-            });
-
-    connect(baka->update, &UpdateManager::messageSignal,
-            [=](QString msg)
-            {
-                ui->plainTextEdit->appendPlainText(msg+"\n");
-            });
+    connect(baka->update, SIGNAL(progressSignal(int)),
+            this, SLOT(handleProgressSignal(int)));
+
+    connect(baka->update, SIGNAL(messageSignal(QString)),
+            this, SLOT(handleMessageSignal(QString)));
 
 #if defined(Q_OS_WIN)
-    connect(ui->updateButton, &QPushButton::clicked,
-            [=]
-            {
-                ui->plainTextEdit->setPlainText(QString());
-                baka->update->DownloadUpdate(Util::DownloadFileUrl());
-            });
+    connect(ui->updateButton, SIGNAL(clicked()),
+            this, SLOT(handleUpdateButtonClicked()));
 #endif
 
     connect(ui->cancelButton, SIGNAL(clicked()),
@@ -106,7 +53,7 @@ UpdateDialog::UpdateDialog(BakaEngine *baka, QWidget *parent) :
 
 UpdateDialog::~UpdateDialog()
 {
-    if(timer != nullptr)
+    if(timer != 0)
         delete timer;
     delete ui;
 }
@@ -119,7 +66,7 @@ void UpdateDialog::CheckForUpdates(BakaEngine *baka, QWidget *parent)
 
 void UpdateDialog::ShowInfo()
 {
-    auto &info = baka->update->getInfo();
+    const QMap<QString, QString> &info = baka->update->getInfo();
     ui->plainTextEdit->setPlainText(info["bugfixes"]);
     if(info["version"].trimmed() == BAKA_MPLAYER_VERSION)
     {
@@ -138,3 +85,69 @@ void UpdateDialog::ShowInfo()
     ui->progressBar->setVisible(false);
     ui->timeRemainingLabel->setVisible(false);
 }
+
+void UpdateDialog::handleProgressSignal(int percent)
+{
+    ui->progressBar->setValue(percent);
+    if(percent == 100)
+    {
+        ui->updateLabel->setText(tr("Download Complete"));
+        ui->progressBar->setVisible(false);
+        ui->timeRemainingLabel->setVisible(false);
+        if(timer != 0)
+        {
+            delete timer;
+            timer = 0;
+        }
+
+        if(!init)
+        {
+            ShowInfo();
+            init = false;
+        }
+    }
+    else if(percent == 0)
+    {
+        avgSpeed = 0;
+        lastSpeed = 0;
+        lastProgress = 0;
+        lastTime = 0;
+        ui->progressBar->setValue(0);
+        ui->progressBar->setVisible(true);
+        ui->timeRemainingLabel->setText(QString());
+        ui->timeRemainingLabel->setVisible(true);
+        if(timer != 0)
+            delete timer;
+        timer = new QTime();
+        timer->start();
+    }
+    else if(timer) // don't execute this if timer is not defined--this shouldn't happen though.. but it does
+    {
+        avgSpeed = 0.005*lastSpeed + 0.995*avgSpeed;
+
+        if(avgSpeed > 0)
+            ui->timeRemainingLabel->setText(tr("About %0 second(s) remaining").arg(QString::number(1/(1000*avgSpeed))));
+        else
+            ui->timeRemainingLabel->setText(tr("Calculating..."));
+
+        int time = timer->elapsed();
+        if(time != lastTime) // prevent cases when we're too fast haha
+            lastSpeed = (percent-lastProgress)/(time-lastTime);
+
+        lastTime = time;
+        lastProgress = percent;
+    }
+}
+
+void UpdateDialog::handleMessageSignal(QString msg)
+{
+    ui->plainTextEdit->appendPlainText(msg+"\n");
+}
+
+void UpdateDialog::handleUpdateButtonClicked()
+{
+    ui->plainTextEdit->setPlainText(QString());
+#if defined(Q_OS_WIN)
+    baka->update->DownloadUpdate(Util::DownloadFileUrl());
+#endif
+}
diff --git a/src/ui/updatedialog.h b/src/ui/updatedialog.h
index eca005f..b31ddac 100644
--- a/src/ui/updatedialog.h
+++ b/src/ui/updatedialog.h
@@ -24,16 +24,21 @@ public:
 protected slots:
     void ShowInfo();
 
+private slots:
+    void handleProgressSignal(int percent);
+    void handleMessageSignal(QString msg);
+    void handleUpdateButtonClicked();
+
 private:
     Ui::UpdateDialog *ui;
     BakaEngine *baka;
 
     QTime *timer;
-    double avgSpeed = 1,
-           lastSpeed = 0;
-    int lastProgress,
-        lastTime,
-        state;
+    double avgSpeed;
+    double lastSpeed;
+    int lastProgress;
+    int lastTime;
+    int state;
     bool init;
 };
 
diff --git a/src/updatemanager.cpp b/src/updatemanager.cpp
index 9cee91c..beeed74 100644
--- a/src/updatemanager.cpp
+++ b/src/updatemanager.cpp
@@ -22,7 +22,9 @@ UpdateManager::UpdateManager(QObject *parent) :
     QObject(parent),
     baka(static_cast<BakaEngine*>(parent)),
     manager(new QNetworkAccessManager(this)),
-    busy(false)
+    busy(false),
+    downloadFile(0),
+    currentReply(0)
 {
 
 }
@@ -40,40 +42,13 @@ bool UpdateManager::CheckForUpdates()
     emit messageSignal(tr("Checking for updates..."));
     emit progressSignal(0);
     QNetworkRequest request(Util::VersionFileUrl());
-    QNetworkReply *reply = manager->get(request);
-
-    connect(reply, &QNetworkReply::downloadProgress,
-            [=](qint64 received, qint64 total)
-            {
-                emit progressSignal((int)(50.0*received/total));
-            });
-
-    connect(reply, &QNetworkReply::finished,
-            [=]
-            {
-                if(reply->error())
-                    emit messageSignal(reply->errorString());
-                else
-                {
-                    QList<QByteArray> lines = reply->readAll().split('\n');
-                    QList<QByteArray> pair;
-                    QString lastPair;
-                    // go through the next 50% incrementally during parsing
-                    double amnt = 50.0/lines.length(),
-                           cur = 50+amnt;
-                    for(auto line : lines)
-                    {
-                        if((pair = line.split('=')).size() != 2)
-                            info[lastPair].append(line);
-                        else
-                            info[(lastPair = pair[0])] = QString(pair[1]);
-                        emit progressSignal((int)(cur += amnt));
-                    }
-                    emit progressSignal(100);
-                    busy = false;
-                }
-                reply->deleteLater();
-            });
+    currentReply = manager->get(request);
+
+    connect(currentReply, SIGNAL(downloadProgress(qint64,qint64)),
+            this, SLOT(handleCheckDownloadProgress(qint64,qint64)));
+
+    connect(currentReply, SIGNAL(finished()),
+            this, SLOT(handleCheckFinished()));
     return true;
 }
 
@@ -87,63 +62,26 @@ bool UpdateManager::DownloadUpdate(const QString &url)
     emit progressSignal(0);
     QNetworkRequest request(url);
     QString filename = QDir::toNativeSeparators(QString("%0/Baka-MPlayer.zip").arg(QCoreApplication::applicationDirPath()));
-    QFile *file = new QFile(filename);
-    if(!file->open(QFile::WriteOnly | QFile::Truncate))
+    downloadFile = new QFile(filename);
+    if(!downloadFile->open(QFile::WriteOnly | QFile::Truncate))
     {
         emit messageSignal(tr("fopen error\n"));
-        delete file;
+        delete downloadFile;
+        downloadFile = 0;
         busy = false;
         return false;
     }
 
-    QNetworkReply *reply = manager->get(request);
-
-    connect(reply, &QNetworkReply::downloadProgress,
-            [=](qint64 received, qint64 total)
-            {
-                emit progressSignal((int)(99.0*received/total));
-            });
-
-    connect(reply, &QNetworkReply::readyRead,
-            [=]
-            {
-                if(reply->error())
-                    emit messageSignal(reply->errorString());
-                else if(file->write(reply->read(reply->bytesAvailable()), reply->bytesAvailable()) == -1)
-                    emit messageSignal(tr("write error"));
-            });
-
-    connect(reply, &QNetworkReply::finished,
-            [=]
-            {
-                if(reply->error())
-                {
-                    emit messageSignal(reply->errorString());
-                    file->close();
-                    delete file;
-                }
-                else
-                {
-                    file->flush();
-                    file->close();
-                    delete file;
-                    QUrl redirect = reply->attribute(QNetworkRequest::RedirectionTargetAttribute).toUrl();
-                    if(redirect.isEmpty())
-                    {
-                        busy = false;
-                        emit messageSignal(tr("Download complete"));
-                        ApplyUpdate(filename);
-                        emit progressSignal(100);
-                    }
-                    else
-                    {
-                        emit messageSignal(tr("Redirected..."));
-                        busy = false;
-                        DownloadUpdate(redirect.toString());
-                    }
-                }
-                reply->deleteLater();
-            });
+    currentReply = manager->get(request);
+
+    connect(currentReply, SIGNAL(downloadProgress(qint64,qint64)),
+            this, SLOT(handleUpdateDownloadProgress(qint64,qint64)));
+
+    connect(currentReply, SIGNAL(readyRead()),
+            this, SLOT(handleUpdateReadyRead()));
+
+    connect(currentReply, SIGNAL(finished()),
+            this, SLOT(handleUpdateFinished()));
     return true;
 }
 
@@ -210,3 +148,95 @@ void UpdateManager::ApplyUpdate(const QString &file)
     baka->Quit();
 }
 #endif
+
+void UpdateManager::handleCheckDownloadProgress(qint64 received, qint64 total)
+{
+    emit progressSignal((int)(50.0*received/total));
+}
+
+void UpdateManager::handleCheckFinished()
+{
+    QNetworkReply *reply = currentReply;
+    if(reply->error())
+        emit messageSignal(reply->errorString());
+    else
+    {
+        QList<QByteArray> lines = reply->readAll().split('\n');
+        QList<QByteArray> pair;
+        QString lastPair;
+        // go through the next 50% incrementally during parsing
+        double amnt = 50.0/lines.length(),
+               cur = 50+amnt;
+        for(int i = 0; i < lines.size(); ++i)
+        {
+            QByteArray line = lines[i];
+            if((pair = line.split('=')).size() != 2)
+                info[lastPair].append(line);
+            else
+                info[(lastPair = pair[0])] = QString(pair[1]);
+            emit progressSignal((int)(cur += amnt));
+        }
+        emit progressSignal(100);
+        busy = false;
+    }
+    reply->deleteLater();
+    currentReply = 0;
+}
+
+#if defined(Q_OS_WIN)
+void UpdateManager::handleUpdateDownloadProgress(qint64 received, qint64 total)
+{
+    emit progressSignal((int)(99.0*received/total));
+}
+
+void UpdateManager::handleUpdateReadyRead()
+{
+    QNetworkReply *reply = currentReply;
+    if(reply->error())
+        emit messageSignal(reply->errorString());
+    else if(downloadFile && downloadFile->write(reply->read(reply->bytesAvailable()), reply->bytesAvailable()) == -1)
+        emit messageSignal(tr("write error"));
+}
+
+void UpdateManager::handleUpdateFinished()
+{
+    QNetworkReply *reply = currentReply;
+    QString filename = QDir::toNativeSeparators(QString("%0/Baka-MPlayer.zip").arg(QCoreApplication::applicationDirPath()));
+    if(reply->error())
+    {
+        emit messageSignal(reply->errorString());
+        if(downloadFile)
+        {
+            downloadFile->close();
+            delete downloadFile;
+            downloadFile = 0;
+        }
+    }
+    else
+    {
+        if(downloadFile)
+        {
+            downloadFile->flush();
+            downloadFile->close();
+            delete downloadFile;
+            downloadFile = 0;
+        }
+        QUrl redirect = reply->attribute(QNetworkRequest::RedirectionTargetAttribute).toUrl();
+        if(redirect.isEmpty())
+        {
+            busy = false;
+            emit messageSignal(tr("Download complete"));
+            ApplyUpdate(filename);
+            emit progressSignal(100);
+        }
+        else
+        {
+            emit messageSignal(tr("Redirected..."));
+            busy = false;
+            DownloadUpdate(redirect.toString());
+        }
+    }
+    reply->deleteLater();
+    currentReply = 0;
+}
+#endif
diff --git a/src/updatemanager.h b/src/updatemanager.h
index 402439f..be788c2 100644
--- a/src/updatemanager.h
+++ b/src/updatemanager.h
@@ -3,6 +3,8 @@
 
 #include <QObject>
 #include <QNetworkAccessManager>
+#include <QNetworkReply>
+#include <QFile>
 #include <QMap>
 #include <QString>
 
@@ -29,12 +31,21 @@ signals:
     void progressSignal(int percent);
     void messageSignal(QString msg);
 
+private slots:
+    void handleCheckDownloadProgress(qint64 received, qint64 total);
+    void handleCheckFinished();
+    void handleUpdateDownloadProgress(qint64 received, qint64 total);
+    void handleUpdateReadyRead();
+    void handleUpdateFinished();
+
 private:
     BakaEngine *baka;
 
     QNetworkAccessManager *manager;
     QMap<QString, QString> info;
     bool busy;
+    QFile *downloadFile;
+    QNetworkReply *currentReply;
 };
 
 #endif // UPDATEMANAGER_H
diff --git a/src/util.cpp b/src/util.cpp
index 2133610..d0d3ea8 100644
--- a/src/util.cpp
+++ b/src/util.cpp
@@ -15,7 +15,11 @@ bool IsValidUrl(QString url)
 
 QString FormatTime(int _time, int _totalTime)
 {
+#if QT_VERSION >= 0x050000
     QTime time = QTime::fromMSecsSinceStartOfDay(_time * 1000);
+#else
+    QTime time = QTime(0, 0).addMSecs(_time * 1000);
+#endif
     if(_totalTime >= 3600) // hours
         return time.toString("h:mm:ss");
     if(_totalTime >= 60)   // minutes
@@ -33,7 +37,11 @@ QString FormatRelativeTime(int _time)
     }
     else
         prefix = "+";
+#if QT_VERSION >= 0x050000
     QTime time = QTime::fromMSecsSinceStartOfDay(_time * 1000);
+#else
+    QTime time = QTime(0, 0).addMSecs(_time * 1000);
+#endif
     if(_time >= 3600) // hours
         return prefix+time.toString("h:mm:ss");
     if(_time >= 60)   // minutes
@@ -128,8 +136,9 @@ QString ShortenPathToParent(const Recent &recent)
 QStringList ToNativeSeparators(QStringList list)
 {
     QStringList ret;
-    for(auto element : list)
+    for(int i = 0; i < list.size(); ++i)
     {
+        QString element = list.at(i);
         if(Util::IsValidLocation(element))
             ret.push_back(element);
         else
@@ -141,8 +150,8 @@ QStringList ToNativeSeparators(QStringList list)
 QStringList FromNativeSeparators(QStringList list)
 {
     QStringList ret;
-    for(auto element : list)
-        ret.push_back(QDir::fromNativeSeparators(element));
+    for(int i = 0; i < list.size(); ++i)
+        ret.push_back(QDir::fromNativeSeparators(list.at(i)));
     return ret;
 }
 
diff --git a/src/util.h b/src/util.h
index 9e2175c..1bf4f54 100644
--- a/src/util.h
+++ b/src/util.h
@@ -43,7 +43,7 @@ QString Ratio(int w, int h);
 
 inline QTextStream& qStdout()
 {
-    static QTextStream r{stdout};
+    static QTextStream r(stdout);
     return r;
 }
 
diff --git a/src/versions/2_0_3.cpp b/src/versions/2_0_3.cpp
index 19c7a2c..f4d2647 100644
--- a/src/versions/2_0_3.cpp
+++ b/src/versions/2_0_3.cpp
@@ -6,12 +6,21 @@
 #include "util.h"
 #include "mpvhandler.h"
 
+#include <QDir>
+
+#if QT_VERSION >= 0x050000
 #include <QJsonDocument>
 #include <QJsonObject>
 #include <QJsonArray>
 #include <QJsonValue>
 #include <QJsonValueRef>
-#include <QDir>
+#else
+#include <QJsonDocument.h>
+#include <QJsonObject.h>
+#include <QJsonArray.h>
+#include <QJsonValue.h>
+#include <QJsonValueRef.h>
+#endif
 
 #if defined(Q_OS_WIN)
 #include <QDate>
@@ -64,8 +73,10 @@ void BakaEngine::Load2_0_3()
     root["showAll"] = true;
     window->setScreenshotDialog(QJsonValueRef2(root["screenshotDialog"]).toBool(true));
     window->recent.clear();
-    for(auto entry : root["recent"].toArray())
+    QJsonArray recent_array = root["recent"].toArray();
+    for(int i = 0; i < recent_array.count(); ++i)
     {
+        QJsonValue entry = recent_array[i];
         QJsonObject entry_json = entry.toObject();
         window->recent.append(Recent(entry_json["path"].toString(), entry_json["title"].toString(), QJsonValueRef2(entry_json["time"]).toInt(0)));
     }
@@ -90,13 +101,15 @@ void BakaEngine::Load2_0_3()
 
     // load settings defined input bindings
     QJsonObject input_json = root["input"].toObject();
-    for(auto &key : input_json.keys())
+    QStringList input_keys = input_json.keys();
+    for(int i = 0; i < input_keys.length(); ++i)
     {
+        QString key = input_keys[i];
         QJsonArray parts = input_json[key].toArray();
-        input[key] = QPair<QString, QString>{
+        input[key] = QPair<QString, QString>(
             parts[0].toString(),
             parts[1].toString()
-        };
+        );
     }
 
     window->MapShortcuts();
@@ -106,7 +119,11 @@ void BakaEngine::Load2_0_3()
     mpv_json.remove("volume");
     mpv->Speed(QJsonValueRef2(mpv_json["speed"]).toDouble(1.0));
     mpv_json.remove("speed");
+#if !defined(Q_OS_MAC) && !defined(Q_OS_DARWIN) && !defined(__APPLE__)
+    // On macOS with Qt4, video output doesn't work (Cocoa/Qt4 conflict)
+    // Skip loading vo setting to avoid initialization errors
     mpv->Vo(mpv_json["vo"].toString());
+#endif
     mpv_json.remove("vo");
     mpv->ScreenshotTemplate(QJsonValueRef2(mpv_json["screenshot-template"]).toString("screenshot%#04n"));
     mpv_json.remove("screenshot-template");
@@ -114,9 +131,13 @@ void BakaEngine::Load2_0_3()
     mpv_json.remove("screenshot-directory");
     mpv->MsgLevel(QJsonValueRef2(mpv_json["msg-level"]).toString("status"));
     mpv_json.remove("msg-level");
-    for(auto &key : mpv_json.keys())
+    QStringList mpv_keys = mpv_json.keys();
+    for(int i = 0; i < mpv_keys.length(); ++i)
+    {
+        QString key = mpv_keys[i];
         if(key != QString() && mpv_json[key].toString() != QString())
             mpv->SetOption(key, mpv_json[key].toString());
+    }
 }
 
 void BakaEngine::SaveSettings()
@@ -144,8 +165,9 @@ void BakaEngine::SaveSettings()
     root["version"] = version;
 
     QJsonArray recent_json;
-    for(auto &entry : window->recent)
+    for(int i = 0; i < window->recent.length(); ++i)
     {
+        const Recent &entry = window->recent[i];
         QJsonObject recent_sub_object_json;
         recent_sub_object_json["path"] = QDir::fromNativeSeparators(entry.path);
         if(entry.title != QString())
@@ -157,9 +179,9 @@ void BakaEngine::SaveSettings()
     root["recent"] = recent_json;
 
     QJsonObject input_json;
-    for(auto input_iter = input.begin(); input_iter != input.end(); ++input_iter)
+    for(QHash<QString, QPair<QString, QString> >::iterator input_iter = input.begin(); input_iter != input.end(); ++input_iter)
     {
-        auto default_iter = default_input.find(input_iter.key());
+        QHash<QString, QPair<QString, QString> >::const_iterator default_iter = default_input.find(input_iter.key());
         if(default_iter != default_input.end())
         {
             if(input_iter->first == default_iter->first &&
@@ -168,7 +190,8 @@ void BakaEngine::SaveSettings()
         }
         else // not found in defaults
         {
-            if(*input_iter == QPair<QString, QString>({QString(), QString()})) // skip empty entries
+            QPair<QString, QString> empty_pair = qMakePair(QString(), QString());
+            if(*input_iter == empty_pair) // skip empty entries
                 continue;
         }
         QJsonArray arr;
diff --git a/src/widgets/customsplitter.cpp b/src/widgets/customsplitter.cpp
index 982bd30..19878b5 100644
--- a/src/widgets/customsplitter.cpp
+++ b/src/widgets/customsplitter.cpp
@@ -5,12 +5,8 @@ CustomSplitter::CustomSplitter(QWidget *parent) :
     normalPos(0)
 {
     this->setHandleWidth(0);
-    connect(this, &CustomSplitter::splitterMoved,
-            [=](int pos, int index)
-            {
-                if(index == 1)
-                    emit positionChanged(max()-pos);
-            });
+    connect(this, SIGNAL(splitterMoved(int,int)),
+            this, SLOT(handleSplitterMoved(int,int)));
 }
 
 int CustomSplitter::position() const
@@ -31,7 +27,9 @@ int CustomSplitter::max() const
 
 void CustomSplitter::setPosition(int pos)
 {
-    setSizes({max()-pos, pos});
+    QList<int> sizes;
+    sizes << (max()-pos) << pos;
+    setSizes(sizes);
     emit positionChanged(pos);
 }
 
@@ -39,3 +37,9 @@ void CustomSplitter::setNormalPosition(int pos)
 {
     normalPos = pos;
 }
+
+void CustomSplitter::handleSplitterMoved(int pos, int index)
+{
+    if(index == 1)
+        emit positionChanged(max()-pos);
+}
diff --git a/src/widgets/customsplitter.h b/src/widgets/customsplitter.h
index 225726f..570a47f 100644
--- a/src/widgets/customsplitter.h
+++ b/src/widgets/customsplitter.h
@@ -17,6 +17,9 @@ public slots:
     void setPosition(int pos);
     void setNormalPosition(int pos);
 
+private slots:
+    void handleSplitterMoved(int pos, int index);
+
 signals:
     void positionChanged(int pos);
     void entered();
diff --git a/src/widgets/dimdialog.cpp b/src/widgets/dimdialog.cpp
index 75227dd..ab72e30 100644
--- a/src/widgets/dimdialog.cpp
+++ b/src/widgets/dimdialog.cpp
@@ -5,7 +5,6 @@
 #include "util.h"
 
 #include <QApplication>
-#include <QWindow>
 #include <QDesktopWidget>
 
 DimDialog::DimDialog(MainWindow *window, QWidget *parent) :
@@ -16,23 +15,8 @@ DimDialog::DimDialog(MainWindow *window, QWidget *parent) :
     setWindowOpacity(.6);
     setStyleSheet("background-color: black;");
 
-    connect(qApp, &QApplication::focusWindowChanged,
-            [=](QWindow *focusWindow)
-            {
-                // note: focusWindow will be nullptr if anything is clicked outside of our program which is useful
-                // the only other problem is that when dragging by the top handle
-                // it will be 0 thus reverting dim lights, this is a side effect
-                // which will have to stay for now.
-                if(this->isVisible())
-                {
-                    // this may indeed disallow opening menus in dimDesktop but it also corrects
-                    // a glitch caused by the needed AlwaysOnTop state of the window and other dialogs
-                    if(focusWindow == this->windowHandle())
-                        window->activateWindow();
-                    else if(focusWindow != window->windowHandle())
-                        this->close();
-                }
-            });
+    connect(qApp, SIGNAL(focusChanged(QWidget*,QWidget*)),
+            this, SLOT(handleFocusWindowChanged(QWidget*)));
 }
 
 void DimDialog::show()
@@ -54,3 +38,20 @@ void DimDialog::mousePressEvent(QMouseEvent *event)
     close();
     QDialog::mousePressEvent(event);
 }
+
+void DimDialog::handleFocusWindowChanged(QWidget *focusWidget)
+{
+    // note: focusWidget will be 0 if anything is clicked outside of our program which is useful
+    // the only other problem is that when dragging by the top handle
+    // it will be 0 thus reverting dim lights, this is a side effect
+    // which will have to stay for now.
+    if(this->isVisible())
+    {
+        // this may indeed disallow opening menus in dimDesktop but it also corrects
+        // a glitch caused by the needed AlwaysOnTop state of the window and other dialogs
+        if(focusWidget == this)
+            window->activateWindow();
+        else if(focusWidget != window)
+            this->close();
+    }
+}
diff --git a/src/widgets/dimdialog.h b/src/widgets/dimdialog.h
index 5ef2509..2dca1a0 100644
--- a/src/widgets/dimdialog.h
+++ b/src/widgets/dimdialog.h
@@ -17,6 +17,9 @@ public:
 protected:
     void mousePressEvent(QMouseEvent *event);
 
+private slots:
+    void handleFocusWindowChanged(QWidget *focusWidget);
+
 signals:
     void visbilityChanged(bool dim);
 
diff --git a/src/widgets/playlistwidget.cpp b/src/widgets/playlistwidget.cpp
index 27f3428..9661b11 100644
--- a/src/widgets/playlistwidget.cpp
+++ b/src/widgets/playlistwidget.cpp
@@ -14,7 +14,8 @@ PlaylistWidget::PlaylistWidget(QWidget *parent) :
     QListWidget(parent),
     newPlaylist(false),
     refresh(false),
-    showAll(true)
+    showAll(true),
+    contextItem(0)
 {
     setAttribute(Qt::WA_NoMousePropagation);
 }
@@ -22,45 +23,14 @@ PlaylistWidget::PlaylistWidget(QWidget *parent) :
 void PlaylistWidget::AttachEngine(BakaEngine *baka)
 {
     this->baka = baka;
-    connect(baka->mpv, &MpvHandler::playlistChanged,
-            [=](const QStringList &list)
-            {
-                playlist = list;
-                newPlaylist = true;
-                if(refresh)
-                {
-                    Populate();
-                    BoldText(file, true);
-                    refresh = false;
-                }
-            });
-
-    connect(baka->mpv, &MpvHandler::fileChanged,
-            [=](QString f)
-            {
-                if(newPlaylist)
-                {
-                    file = f;
-                    if(f != QString())
-                        suffix = file.split('.').last();
-                    Populate();
-                    BoldText(file, true);
-                    newPlaylist = false;
-                }
-                else
-                {
-                    BoldText(file, false);
-                    BoldText(f, true);
-                    file = f;
-                }
-                SelectIndex(CurrentIndex());
-            });
-
-    connect(this, &PlaylistWidget::doubleClicked,
-            [=](const QModelIndex &i)
-            {
-                PlayIndex(i.row());
-            });
+    connect(baka->mpv, SIGNAL(playlistChanged(QStringList)),
+            this, SLOT(handlePlaylistChanged(QStringList)));
+
+    connect(baka->mpv, SIGNAL(fileChanged(QString)),
+            this, SLOT(handleFileChanged(QString)));
+
+    connect(this, SIGNAL(doubleClicked(QModelIndex)),
+            this, SLOT(handleDoubleClicked(QModelIndex)));
 }
 
 void PlaylistWidget::Populate()
@@ -70,7 +40,7 @@ void PlaylistWidget::Populate()
 
     QListWidgetItem *current = currentItem();
     QString item;
-    if(current != nullptr)
+    if(current != 0)
         item = current->text();
     else
         item = file;
@@ -84,7 +54,7 @@ void PlaylistWidget::Populate()
     {
         // filter by suffix
         QStringList newPlaylist;
-        for(auto i = playlist.begin(); i != playlist.end(); ++i)
+        for(QStringList::const_iterator i = playlist.begin(); i != playlist.end(); ++i)
             if(i->endsWith(suffix))
                 newPlaylist.append(*i);
         // load
@@ -103,14 +73,14 @@ void PlaylistWidget::RefreshPlaylist()
 QString PlaylistWidget::CurrentItem()
 {
     QListWidgetItem *current = currentItem();
-    if(current != nullptr)
+    if(current != 0)
         return current->text();
     return QString();
 }
 
 int PlaylistWidget::CurrentIndex()
 {
-    auto items = findItems(file, Qt::MatchExactly);
+    QList<QListWidgetItem*> items = findItems(file, Qt::MatchExactly);
     if(!items.empty())
         return indexFromItem(items.first()).row();
     return 0;
@@ -138,7 +108,7 @@ void PlaylistWidget::PlayIndex(int index, bool relative)
     int newIndex = 0;
     if(relative)
     {
-        auto items = findItems(file, Qt::MatchExactly);
+        QList<QListWidgetItem*> items = findItems(file, Qt::MatchExactly);
         if(!items.empty())
             newIndex = indexFromItem(items.first()).row();
     }
@@ -150,7 +120,7 @@ void PlaylistWidget::PlayIndex(int index, bool relative)
         newIndex = count();
 
     QListWidgetItem *current = item(newIndex);
-    if(current != nullptr)
+    if(current != 0)
     {
         scrollToItem(current);
         if(!baka->mpv->PlayFile(current->text()))
@@ -169,16 +139,16 @@ void PlaylistWidget::RemoveIndex(int index)
         index = count();
 
     QListWidgetItem *current = item(index);
-    if(current != nullptr)
+    if(current != 0)
         RemoveFromPlaylist(current);
 }
 
 void PlaylistWidget::BoldText(const QString &f, bool state)
 {
-    auto items = findItems(f, Qt::MatchExactly);
+    QList<QListWidgetItem*> items = findItems(f, Qt::MatchExactly);
     if(items.empty())
         return;
-    auto *item = items.first();
+    QListWidgetItem *item = items.first();
     if(item)
     {
         QFont font = item->font();
@@ -191,7 +161,7 @@ void PlaylistWidget::Search(const QString &s)
 {
     QListWidgetItem *current = currentItem();
     QString item;
-    if(current != nullptr)
+    if(current != 0)
         item = current->text();
     else
         item = file;
@@ -214,7 +184,7 @@ void PlaylistWidget::ShowAll(bool b)
 {
     QListWidgetItem *current = currentItem();
     QString item;
-    if(current != nullptr)
+    if(current != 0)
         item = current->text();
     else
         item = file;
@@ -233,7 +203,7 @@ void PlaylistWidget::Shuffle()
 
     QListWidgetItem *current = currentItem();
     QString item;
-    if(current != nullptr)
+    if(current != 0)
         item = current->text();
     else
         item = file;
@@ -244,7 +214,7 @@ void PlaylistWidget::Shuffle()
 
     std::random_shuffle(newPlaylist.begin(), newPlaylist.end());
     // make current playing item the first
-    auto iter = std::find(newPlaylist.begin(), newPlaylist.end(), file);
+    QStringList::iterator iter = std::find(newPlaylist.begin(), newPlaylist.end(), file);
     std::swap(*iter, *newPlaylist.begin());
     // load
     clear();
@@ -258,7 +228,7 @@ void PlaylistWidget::SelectItem(const QString &item)
 {
     if(item != QString())
     {
-        auto items = this->findItems(item, Qt::MatchExactly);
+        QList<QListWidgetItem*> items = this->findItems(item, Qt::MatchExactly);
         if(!items.empty())
         {
             setCurrentItem(items.first());
@@ -282,8 +252,9 @@ void PlaylistWidget::DeleteFromDisk(QListWidgetItem *item)
     playlist.removeOne(item->text());
     QString r = item->text().left(item->text().lastIndexOf('.')+1); // get file root (no extension)
     // check and remove all subtitle_files with the same root as the video
-    for(auto ext : Mpv::subtitle_filetypes)
+    for(int i = 0; i < Mpv::subtitle_filetypes.length(); ++i)
     {
+        QString ext = Mpv::subtitle_filetypes[i];
         QFile subf(r+ext.mid(2));
         if(subf.exists() &&
            QMessageBox::question(
@@ -294,8 +265,10 @@ void PlaylistWidget::DeleteFromDisk(QListWidgetItem *item)
             subf.remove();
     }
     // check and remove all external subtitle files in the video
-    for(auto track : baka->mpv->getFileInfo().tracks)
+    Mpv::FileInfo fileInfo = baka->mpv->getFileInfo();
+    for(int i = 0; i < fileInfo.tracks.length(); ++i)
     {
+        Mpv::Track track = fileInfo.tracks[i];
         if(track.external)
         {
             QFile subf(track.external_filename);
@@ -318,26 +291,19 @@ void PlaylistWidget::DeleteFromDisk(QListWidgetItem *item)
 void PlaylistWidget::contextMenuEvent(QContextMenuEvent *event)
 {
     QListWidgetItem *item = itemAt(event->pos());
-    if(item != nullptr)
+    if(item != 0)
     {
+        contextItem = item;
         QMenu *menu = new QMenu();
-        connect(menu->addAction(tr("R&emove from Playlist")), &QAction::triggered, // Playlist: Remove from playlist (right-click)
-                [=]
-                {
-                    RemoveFromPlaylist(item);
-                });
-        connect(menu->addAction(tr("&Delete from Disk")), &QAction::triggered,     // Playlist: Delete from Disk (right-click)
-                [=]
-                {
-                    DeleteFromDisk(item);
-                });
-        connect(menu->addAction(tr("&Refresh")), &QAction::triggered,              // Playlist: Refresh (right-click)
-                [=]
-                {
-                    RefreshPlaylist();
-                });
+        connect(menu->addAction(tr("R&emove from Playlist")), SIGNAL(triggered()), // Playlist: Remove from playlist (right-click)
+                this, SLOT(handleRemoveActionTriggered()));
+        connect(menu->addAction(tr("&Delete from Disk")), SIGNAL(triggered()),     // Playlist: Delete from Disk (right-click)
+                this, SLOT(handleDeleteActionTriggered()));
+        connect(menu->addAction(tr("&Refresh")), SIGNAL(triggered()),              // Playlist: Refresh (right-click)
+                this, SLOT(handleRefreshActionTriggered()));
         menu->exec(viewport()->mapToGlobal(event->pos()));
         delete menu;
+        contextItem = 0;
     }
 }
 
@@ -346,3 +312,57 @@ void PlaylistWidget::dropEvent(QDropEvent *event)
     QListWidget::dropEvent(event);
     emit currentRowChanged(currentRow());
 }
+
+void PlaylistWidget::handlePlaylistChanged(const QStringList &list)
+{
+    playlist = list;
+    newPlaylist = true;
+    if(refresh)
+    {
+        Populate();
+        BoldText(file, true);
+        refresh = false;
+    }
+}
+
+void PlaylistWidget::handleFileChanged(QString f)
+{
+    if(newPlaylist)
+    {
+        file = f;
+        if(f != QString())
+            suffix = file.split('.').last();
+        Populate();
+        BoldText(file, true);
+        newPlaylist = false;
+    }
+    else
+    {
+        BoldText(file, false);
+        BoldText(f, true);
+        file = f;
+    }
+    SelectIndex(CurrentIndex());
+}
+
+void PlaylistWidget::handleDoubleClicked(const QModelIndex &i)
+{
+    PlayIndex(i.row());
+}
+
+void PlaylistWidget::handleRemoveActionTriggered()
+{
+    if(contextItem)
+        RemoveFromPlaylist(contextItem);
+}
+
+void PlaylistWidget::handleDeleteActionTriggered()
+{
+    if(contextItem)
+        DeleteFromDisk(contextItem);
+}
+
+void PlaylistWidget::handleRefreshActionTriggered()
+{
+    RefreshPlaylist();
+}
diff --git a/src/widgets/playlistwidget.h b/src/widgets/playlistwidget.h
index 70f07a0..2b8590c 100644
--- a/src/widgets/playlistwidget.h
+++ b/src/widgets/playlistwidget.h
@@ -35,6 +35,12 @@ protected slots:
     void BoldText(const QString &f, bool state);
     void RemoveFromPlaylist(QListWidgetItem *item);
     void DeleteFromDisk(QListWidgetItem *item);
+    void handlePlaylistChanged(const QStringList &list);
+    void handleFileChanged(QString f);
+    void handleDoubleClicked(const QModelIndex &i);
+    void handleRemoveActionTriggered();
+    void handleDeleteActionTriggered();
+    void handleRefreshActionTriggered();
 
 protected:
     void contextMenuEvent(QContextMenuEvent *event);
@@ -48,6 +54,7 @@ private:
     bool newPlaylist,
          refresh,
          showAll;
+    QListWidgetItem *contextItem;
 };
 
 #endif // PLAYLISTWIDGET_H
diff --git a/src/widgets/seekbar.cpp b/src/widgets/seekbar.cpp
index b214b3c..c745aef 100644
--- a/src/widgets/seekbar.cpp
+++ b/src/widgets/seekbar.cpp
@@ -22,8 +22,8 @@ void SeekBar::setTracking(int _totalTime)
         totalTime = _totalTime;
         // now that we've got totalTime, calculate the tick locations
         // we need to do this because totalTime is obtained after the LOADED event is fired--we need totalTime for calculations
-        for(auto &tick : ticks)
-            tick = ((double)tick/totalTime)*maximum();
+        for(int i = 0; i < ticks.length(); ++i)
+            ticks[i] = ((double)ticks[i]/totalTime)*maximum();
         if(ticks.length() > 0)
         {
             tickReady = true; // ticks are ready to be displayed
@@ -60,9 +60,9 @@ void SeekBar::paintEvent(QPaintEvent *event)
         QRect region = event->rect();
         QPainter painter(this);
         painter.setPen(QColor(190,190,190));
-        for(auto &tick : ticks)
+        for(int i = 0; i < ticks.length(); ++i)
         {
-            int x = QStyle::sliderPositionFromValue(minimum(), maximum(), tick, width());
+            int x = QStyle::sliderPositionFromValue(minimum(), maximum(), ticks[i], width());
             painter.drawLine(x, region.top(), x, region.bottom());
         }
     }
