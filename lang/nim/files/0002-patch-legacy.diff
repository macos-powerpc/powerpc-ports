--- a/build.sh	2025-12-19 19:30:12.000000000 +0800
+++ b/build.sh	2025-12-19 23:18:46.000000000 +0800
@@ -60,8 +60,8 @@
   fi
   CC="sem -j $parallel --id $$ ${CC}"
 fi
-COMP_FLAGS="${CPPFLAGS:-} ${CFLAGS:-} -w -fmax-errors=3 -fno-strict-aliasing $extraBuildArgs"
-LINK_FLAGS="${LDFLAGS:-} "
+COMP_FLAGS="${CPPFLAGS:-} ${CFLAGS:-} -isystem@PREFIX@/include/LegacySupport -w -fmax-errors=3 -fno-strict-aliasing $extraBuildArgs"
+LINK_FLAGS="${LDFLAGS:-} -L@PREFIX@/lib -lMacportsLegacySupport"
 PS4=""
 # platform detection
 ucpu=`uname -m`

--- a/makefile	2025-12-19 19:30:12.000000000 +0800
+++ b/makefile	2025-12-19 23:18:40.000000000 +0800
@@ -3,7 +3,7 @@
 # To regenerate run ``niminst csource`` or ``koch csource``
 
 CC ?= gcc
-CFLAGS += -Ic_code -w -fmax-errors=3 -fno-strict-aliasing 
+CFLAGS += -Ic_code -isystem@PREFIX@/include/LegacySupport -w -fmax-errors=3 -fno-strict-aliasing 
 LDFLAGS += 
 binDir = bin
 
@@ -47,7 +47,7 @@
 ifeq ($(uos),darwin)
   myos = macosx
   CC = gcc
-  LDFLAGS += -ldl -lm
+  LDFLAGS += -L@PREFIX@/lib -lMacportsLegacySupport -ldl -lm
   ifeq ($(HOSTTYPE),x86_64)
     ucpu = amd64
   endif

--- a/config/nim.cfg
+++ b/config/nim.cfg	2025-12-22 12:19:19.000000000 +0800
@@ -216,6 +216,10 @@
 # Options for Mac OS X. Mac OS X uses its own Objective-C stack that is
 # totally different from GNUStep.
 @if macosx:
+  gcc.options.always %= "-isystem@PREFIX@/include/LegacySupport ${gcc.options.always}"
+  gcc.cpp.options.always %= "-isystem@PREFIX@/include/LegacySupport ${gcc.cpp.options.always}"
+  gcc.options.linker = "-lMacportsLegacySupport"
+  gcc.cpp.options.linker = "-lMacportsLegacySupport"
   gcc.objc.options.linker = "-framework Foundation"
   llvm_gcc.objc.options.linker = "-framework Foundation"
   clang.objc.options.linker = "-framework Foundation"
