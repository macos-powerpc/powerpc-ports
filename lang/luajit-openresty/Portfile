# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim: fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           legacysupport 1.1
PortGroup           xcode_workaround 1.0

# O_CLOEXEC
legacysupport.newest_darwin_requires_legacy 10

github.setup        openresty luajit2 2.1-20260114 v
name                luajit-openresty
revision            0
categories          lang
license             MIT
maintainers         {l2dy @l2dy} openmaintainer
description         OpenResty's maintained branch of LuaJIT
long_description    ${description}. LuaJIT is a Just-In-Time Compiler for the Lua programming language.
checksums           rmd160  0143b5a7032649cd47ee1a8a368cc87aa34a400a \
                    sha256  732b6d7f5f40d637805c0aa7e53c69644372ebff23dbf77f3bf187f8f7fde6f6 \
                    size    1174448
github.tarball_from archive

patchfiles          powerpc.patch

conflicts           luajit

use_configure       no

compiler.blacklist  *gcc-4.0 *gcc-4.2 {clang < 700} macports-clang-3.3 macports-clang-3.4

# changes to compiler flags must be made before `CFLAGS=...`
xcode_workaround.type append_to_compiler_flags

build.target        amalg
build.args-append   CC="${configure.cc}" \
                    CFLAGS="${configure.cppflags} ${configure.cflags} [get_canonical_archflags] -DLUAJIT_ENABLE_LUA52COMPAT" \
                    LDFLAGS="${configure.ldflags} [get_canonical_archflags]" \
                    PREFIX="${prefix}" \
                    Q=""

destroot.args-append \
                    PREFIX="${prefix}"

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc
    copy ${worksrcpath}/doc/ ${destroot}${prefix}/share/doc/${name}
}
