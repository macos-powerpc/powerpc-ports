From 9536a6695c859b84797a4a847954362c8265bb1a Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 10 Nov 2025 17:43:06 +0800
Subject: [PATCH 1/2] Do not force libc++ on macOS

This reverts commit 400dec059e9d71b06e6cfa5cfe399b4c57eb8119.
---
 src/bootstrap/lib.rs       | 8 --------
 src/librustc_llvm/build.rs | 2 --
 2 files changed, 10 deletions(-)

diff --git a/src/bootstrap/lib.rs b/src/bootstrap/lib.rs
index 9203a558f64..99f82c5688a 100644
--- a/src/bootstrap/lib.rs
+++ b/src/bootstrap/lib.rs
@@ -760,14 +760,6 @@ impl Build {
                            .filter(|s| !s.starts_with("-O") && !s.starts_with("/O"))
                            .collect::<Vec<String>>();
 
-        // If we're compiling on macOS then we add a few unconditional flags
-        // indicating that we want libc++ (more filled out than libstdc++) and
-        // we want to compile for 10.7. This way we can ensure that
-        // LLVM/etc are all properly compiled.
-        if target.contains("apple-darwin") {
-            base.push("-stdlib=libc++".into());
-        }
-
         // Work around an apparently bad MinGW / GCC optimization,
         // See: http://lists.llvm.org/pipermail/cfe-dev/2016-December/051980.html
         // See: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=78936
diff --git a/src/librustc_llvm/build.rs b/src/librustc_llvm/build.rs
index 62a3757757b..4377f8eba87 100644
--- a/src/librustc_llvm/build.rs
+++ b/src/librustc_llvm/build.rs
@@ -261,8 +261,6 @@ fn main() {
         }
     } else if target.contains("freebsd") {
         "c++"
-    } else if target.contains("darwin") {
-        "c++"
     } else if target.contains("netbsd") && llvm_static_stdcpp.is_some() {
         // NetBSD uses a separate library when relocation is required
         "stdc++_pic"
