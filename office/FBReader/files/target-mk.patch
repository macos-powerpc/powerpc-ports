--- makefiles/target.mk
+++ makefiles/target.mk
@@ -0,0 +1 @@
+TARGET_ARCH = macosx
--- makefiles/target.mk
+++ makefiles/target.mk
@@ -1,1 +1,3 @@
 TARGET_ARCH = macosx
+UI_TYPE = qt4
+TARGET_STATUS = "release"
--- makefiles/arch/macosx.mk
+++ makefiles/arch/macosx.mk
@@ -17,14 +17,24 @@
 AR = ar rsu
 LD = g++ -headerpad_max_install_names
-
+prefix=$(prefix)
+FBREADERQTLIB_FLAGS=$(prefix)/libexec/qt4/lib \
+FBREADERQTFRAME_FLAGS=$(prefix)/libexec/qt4/Library/Frameworks/QtCore.framework/Versions/4 \
+FBREADERIQT_FLAGS=$(prefix)/libexec/qt4/include \
+FBREADERIQTCORE_FLAGS=$(prefix)/libexec/qt4/include/QtCore \
+FBREADERIQTGUI_FLAGS=$(prefix)/libexec/qt4/include/QtGui \
+FBREADERIQTNETWORK_FLAGS=$(prefix)/libexec/qt4/include/QtNetwork \
+FBREADERQTINCLUDE_FLAGS=$(prefix)/libexec/qt4/include \
+FBREADERFFREAMEWORKS_FLAGS=$(prefix)/libexec/qt4/Library/Frameworks \
+FBREADERFINCLUDE_FLAGS=$(prefix)/libexec/qt4/include \
+FBREADERFLIB_FLAGS=$(prefix)/libexec/qt4/lib
-ARCH_FLAGS = -arch x86_64 -mmacosx-version-min=10.5
+ARCH_FLAGS = -arch ppc -mmacosx-version-min=10.4
-CFLAGS = $(ARCH_FLAGS) -pipe -fno-exceptions -Wall -Wno-ctor-dtor-privacy -W
+CFLAGS = $(ARCH_FLAGS) -pipe -fno-exceptions -Wall -Wno-ctor-dtor-privacy -W -I$(FBREADERIQT_FLAGS) -framework QtCore -framework QtGui -framework QtNetwork -Wno-narrowing -I$(FBREADERIQTCORE_FLAGS) -I$(FBREADERIQTGUI_FLAGS) -I$(FBREADERIQTNETWORK_FLAGS)
-LDFLAGS = $(ARCH_FLAGS)
+LDFLAGS = $(ARCH_FLAGS) -L$(FBREADERQTLIB_FLAGS) -L$(FBREADERQTFRAME_FLAGS) -framework QtCore -framework QtGui -framework QtNetwork
 
-EXTERNAL_LIBS = -liconv
+EXTERNAL_LIBS = -liconv -lunibreak -F$(FBREADERFFREAMEWORKS_FLAGS) -F$(FBREADERFINCLUDE_FLAGS) -F$(FBREADERFLIB_FLAGS) -lfribidi -lexpat -lcurl -lsqlite3
 
 ifeq "$(UI_TYPE)" "qt4"
-  QTINCLUDE =
+  QTINCLUDE = -I$(FBREADERQTINCLUDE_FLAGS)
   MOC = moc
   UILIBS = -framework QtCore -framework QtGui -framework QtNetwork
 endif
--- makefiles/config.mk
+++ makefiles/config.mk
@@ -7,9 +7,10 @@
 LIBMAKE = $(MAKE) ZLSHARED=$(ZLSHARED)
 
 include $(ROOTDIR)/makefiles/arch/$(TARGET_ARCH).mk
 
+INSTALLDIR = /Applications/Macports/FBReader.app
 BINDIR ?= $(INSTALLDIR)/bin
 LIBDIR ?= $(INSTALLDIR)/lib
 INCDIR ?= $(INSTALLDIR)/include
 SHAREDIR ?= $(INSTALLDIR)/share
 
--- fbreader/macosx/Makefile
+++ fbreader/macosx/Makefile
@@ -1,21 +1,22 @@
 ROOTDIR = $(CURDIR)/../..
 include $(ROOTDIR)/makefiles/config.mk
-
+prefix=$(prefix)
+DESTDIR = $(prefix)/var/macports/build/_Users_powerpc-ports_office_FBReader/FBReader/work/destroot
 SHARE_FBREADER = $(DESTDIR)$(SHAREDIR)/FBReader
 BINARY = $(DESTDIR)$(BINDIR)/FBReader
 
 install:
 	@strip $(BINARY)
 	@install -m 0644 Info.plist $(DESTDIR)$(INSTALLDIR)/Contents
 	@install -m 0644 ../data/icons/application/FBReader.icns $(DESTDIR)$(INSTALLDIR)/Contents/Resources
 	@install -m 0644 ../data/icons/application/48x48.png $(DESTDIR)$(IMAGEDIR)/fbreader.png
 	@install -m 0644 ../data/default/config.macosx.xml $(SHARE_FBREADER)/default/config.xml
 	@install -m 0644 ../data/default/keymap.macosx.xml $(SHARE_FBREADER)/default/keymap.xml
 	@install -m 0644 ../data/default/styles.desktop.xml $(SHARE_FBREADER)/default/styles.xml
-	@macdeployqt $(DESTDIR)$(INSTALLDIR)
+
 	@for fw in QtDeclarative QtScript QtSql QtSvg QtXmlPatterns; do \
 		rm -rf $(DESTDIR)$(INSTALLDIR)/Contents/Frameworks/$$fw.framework; \
 	done
 	@for plugin in accessible codecs bearer graphicssystems qmltooling; do \
 		rm -rf $(DESTDIR)$(INSTALLDIR)/Contents/PlugIns/$$plugin; \
 	done
 
  
  install:

