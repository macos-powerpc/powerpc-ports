# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           codeberg 1.0
PortGroup           makefile 1.0

codeberg.setup      jschlatow taskopen 2.0.2 v
revision            0

categories          office
license             GPL-2
maintainers         {judaew @judaew} openmaintainer

description         Tool for taking notes and open urls with taskwarrior
long_description    {*}${description}

checksums           rmd160  cc3bd78d762c0fdb3e83a9154b8b3129c8cb560c \
                    sha256  0553012b710c87608453103c243fbdec370a5b8a1702a06184256950097d61d6 \
                    size    36087

depends_build-append \
                    port:nim

depends_lib-append  port:pcre \
                    port:vim

# Match Nim:
compiler.c_standard 2011

post-extract {
    xinstall -d ${worksrcpath}/bin
    ln -s ${configure.cc} ${worksrcpath}/bin/gcc
}

build.cmd-prepend   PATH=./bin:${prefix}/bin:${prefix}/sbin:/usr/bin:/usr/sbin:/bin:/sbin

# https://codeberg.org/jschlatow/taskopen/issues/179
destroot {
    xinstall -m 755 ${worksrcpath}/${name} ${destroot}${prefix}/bin/
}

notes "
    If you see an error on launch `could not import: pcre_free_study`,\
    the app picks a wrong pcre library. Set DYLD_LIBRARY_PATH to fix that:

    export DYLD_LIBRARY_PATH=${prefix}/lib:\$DYLD_LIBRARY_PATH
"
