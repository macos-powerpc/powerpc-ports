# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem      1.0
PortGroup       cmake 1.1
PortGroup       github 1.0

github.setup    open-simh simh ad3e74495137ebe9a806c86902d3dc5aab69014a
name            opensimh

version         20250818
revision        0

categories      emulators

# Note: pmetzger explicitly authorizes all maintainers to make any
# reasonable changes to this port without a three day wait.
maintainers     {pmetzger @pmetzger} openmaintainer

license         X11

description     A highly portable, multi-system simulator.

long_description    SIMH is a framework and family of computer simulators, \
                    with the primary goal of enabling the preservation \
                    of knowledge contained in, and providing the ability \
                    to execute and experience, old and historic software \
                    via simulation of the hardware on which it ran.

homepage        http://opensimh.org

checksums       rmd160  3994815e88016b74453fa589936ba83cd095dbdf \
                sha256  dde246a4169d4adfed618228f8214ae9132ecf01063f8439bca589f40115f151 \
                size    31361383
github.tarball_from archive

conflicts       simh

depends_lib     port:brotli \
                port:bzip2 \
                port:freetype \
                port:libedit \
                port:libpcap \
                port:libpng \
                port:libsdl2 \
                port:libsdl2_ttf \
                port:ncurses \
                port:pcre \
                port:zlib

depends_build-append   path:bin/pkg-config:pkgconfig

patchfiles      zlib-not-static.diff

set bindir      ${worksrcpath}/BIN

configure.cflags-append    -fwrapv -fno-strict-overflow

pre-build {
    file mkdir ${bindir}
}

destroot {
    foreach binary [glob -tails -directory ${bindir} *] {
        xinstall -c -m 755 ${bindir}/${binary} ${destroot}${prefix}/bin/simh-${binary}
    }
}

test.run        yes
test.cmd        ctest

notes "
open-simh executables have been installed with a 'simh-' prefix, for example:
   simh-microvax3900
"

livecheck.type  none
