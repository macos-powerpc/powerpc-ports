From 84987e124a95acaaeac202f86b713bfc758a049b Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Fri, 24 Oct 2025 06:44:18 +0800
Subject: [PATCH 1/2] Revert "Set minimal version of gdk-pixbuf to 2.44.3"

This reverts commit 64d61284f12606df42248755ffc6f628c7bab178.
---
 data/meson.build              | 3 +--
 komikku/consts.py             | 1 +
 komikku/reader/pager/image.py | 5 +++--
 komikku/utils.py              | 5 +++--
 4 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/data/meson.build b/data/meson.build
index d35cd14b..0c755c9c 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -45,9 +45,8 @@ endif
 #
 # Dependencies
 #
-dependency('gobject-introspection-1.0')
 dependency('glib-2.0')
-dependency('gdk-pixbuf-2.0', version: '>=2.44.3')
+dependency('gobject-introspection-1.0')
 dependency('gtk4', version: '>=4.18')
 dependency('libadwaita-1', version: '>=1.8')
 
diff --git a/komikku/consts.py b/komikku/consts.py
index 018685a6..570428c6 100644
--- a/komikku/consts.py
+++ b/komikku/consts.py
@@ -6,6 +6,7 @@ COVER_WIDTH = 180
 COVER_HEIGHT = 256
 LOGO_SIZE = 32
 MISSING_IMG_RESOURCE_PATH = '/info/febvre/Komikku/images/missing_file.png'
+PIXBUF_ANIMATION = False
 
 DOWNLOAD_MAX_DELAY = 1  # in seconds
 REQUESTS_TIMEOUT = 5
diff --git a/komikku/reader/pager/image.py b/komikku/reader/pager/image.py
index 9c7d6c87..2b7d5f0c 100644
--- a/komikku/reader/pager/image.py
+++ b/komikku/reader/pager/image.py
@@ -29,6 +29,7 @@ from gi.repository.GdkPixbuf import Pixbuf
 from gi.repository.GdkPixbuf import PixbufAnimation
 
 from komikku.consts import MISSING_IMG_RESOURCE_PATH
+from komikku.consts import PIXBUF_ANIMATION
 from komikku.utils import get_image_info
 
 logger = logging.getLogger('komikku')
@@ -537,7 +538,7 @@ class KImage(Gtk.Widget, Gtk.Scrollable):
             elif data:
                 stream = Gio.MemoryInputStream.new_from_data(data, None)
 
-            if not info['is_animated']:
+            if not info['is_animated'] or not PIXBUF_ANIMATION:
                 Pixbuf.new_from_stream_async(stream, None, self.load_ready, callback, info)
             else:
                 PixbufAnimation.new_from_stream_async(stream, None, self.load_ready, callback, info)
@@ -575,7 +576,7 @@ class KImage(Gtk.Widget, Gtk.Scrollable):
         stream.close()
 
         try:
-            if not info['is_animated']:
+            if not info['is_animated'] or not PIXBUF_ANIMATION:
                 pixbuf = Pixbuf.new_from_stream_finish(result)
 
                 self.textures = []
diff --git a/komikku/utils.py b/komikku/utils.py
index 07e1ad7f..ad0a3d26 100644
--- a/komikku/utils.py
+++ b/komikku/utils.py
@@ -36,6 +36,7 @@ from gi.repository import Gtk
 from gi.repository.GdkPixbuf import Pixbuf
 from gi.repository.GdkPixbuf import PixbufAnimation
 
+from komikku.consts import PIXBUF_ANIMATION
 from komikku.consts import REQUESTS_TIMEOUT
 
 logger = logging.getLogger('komikku')
@@ -614,7 +615,7 @@ class CoverLoader(GObject.GObject):
 
         try:
             stream = Gio.MemoryInputStream.new_from_data(data, None)
-            if info['is_animated'] and not static_animation:
+            if info['is_animated'] and not static_animation and PIXBUF_ANIMATION:
                 pixbuf = PixbufAnimation.new_from_stream(stream)
             else:
                 pixbuf = Pixbuf.new_from_stream(stream)
@@ -633,7 +634,7 @@ class CoverLoader(GObject.GObject):
             return None
 
         try:
-            if info['is_animated'] and not static_animation:
+            if info['is_animated'] and not static_animation and PIXBUF_ANIMATION:
                 pixbuf = PixbufAnimation.new_from_file(path)
             else:
                 pixbuf = Pixbuf.new_from_file(path)
