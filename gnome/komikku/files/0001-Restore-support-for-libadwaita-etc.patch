From f83f811928ed84a88544f84ded447d81b3ef7078 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Tue, 2 Dec 2025 02:20:03 +0800
Subject: [PATCH] Compatibility fixes

---
 data/css/style.css                       |  4 +++
 data/meson.build                         |  7 ++---
 data/ui/application_window.blp           |  2 +-
 data/ui/card.blp                         | 11 +++----
 data/ui/card_tracking.blp                |  1 -
 data/ui/card_tracking_search.blp         |  2 +-
 data/ui/explorer_search.blp              | 19 +++++++++---
 data/ui/preferences.blp                  |  6 ----
 data/ui/shortcuts.blp                    | 37 ++++++++++++------------
 komikku/application.py                   |  9 +++---
 komikku/card/__init__.py                 |  8 +++--
 komikku/card/chapters_list.py            | 12 ++++----
 komikku/consts.py                        |  1 +
 komikku/explorer/search/__init__.py      | 10 +++----
 komikku/explorer/search/search_global.py |  4 +--
 komikku/preferences/__init__.py          |  3 --
 komikku/reader/__init__.py               |  2 +-
 komikku/reader/pager/image.py            |  5 ++--
 komikku/reader/pager/infinite_canvas.py  |  6 ++--
 komikku/reader/pager/page.py             |  8 ++---
 komikku/support.py                       |  2 +-
 komikku/utils.py                         |  5 ++--
 meson.build                              |  3 +-
 23 files changed, 88 insertions(+), 79 deletions(-)

diff --git a/data/css/style.css b/data/css/style.css
index 319e90e0..d0a9084b 100644
--- a/data/css/style.css
+++ b/data/css/style.css
@@ -3,6 +3,10 @@
  *
  * SPDX-License-Identifier: GPL-3.0-or-later
  */
+
+@define-color accent_bg_color #f66151;
+@define-color accent_color @orange_5;  /* #c64600 */
+
 .spinner {
     color: var(--accent-bg-color);
 }
diff --git a/data/meson.build b/data/meson.build
index dfefd300..83446b65 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -45,11 +45,10 @@ endif
 #
 # Dependencies
 #
-dependency('gobject-introspection-1.0')
 dependency('glib-2.0')
-dependency('gdk-pixbuf-2.0', version: '>=2.44.3')
-dependency('gtk4', version: '>=4.18')
-dependency('libadwaita-1', version: '>=1.8')
+dependency('gobject-introspection-1.0')
+dependency('gtk4', version: '>=4.14')
+dependency('libadwaita-1', version: '>=1.5')
 
 #
 # gschema XML file
diff --git a/data/ui/application_window.blp b/data/ui/application_window.blp
index bcd701f1..2aaa0c7f 100644
--- a/data/ui/application_window.blp
+++ b/data/ui/application_window.blp
@@ -19,7 +19,7 @@ template $ApplicationWindow: Adw.ApplicationWindow {
       halign: center;
       valign: start;
 
-      child: Adw.Spinner pool_to_update_spinner {
+      child: Spinner pool_to_update_spinner {
         height-request: 48;
         width-request: 48;
 
diff --git a/data/ui/card.blp b/data/ui/card.blp
index edf69c35..e8cc1652 100644
--- a/data/ui/card.blp
+++ b/data/ui/card.blp
@@ -61,7 +61,7 @@ template $CardPage : Adw.NavigationPage {
         }
 
         child: Adw.ViewStack stack {
-          enable-transitions: true;
+          can-target: true;
 
           Adw.ViewStackPage {
             name: "info";
@@ -183,13 +183,14 @@ template $CardPage : Adw.NavigationPage {
                         icon-name: "genres-symbolic";
                       }
 
-                      Adw.WrapBox genres_wrapbox {
-                        justify: fill;
+                      Gtk.FlowBox genres_wrapbox {
                         halign: start;
                         hexpand: true;
                         valign: center;
-                        line-spacing: 6;
-                        child-spacing: 6;
+                        row-spacing: 6;
+                        column-spacing: 6;
+                        selection-mode: none;
+                        homogeneous: true;
                       }
                     }
 
@@ -203,13 +203,14 @@ template $CardPage : Adw.NavigationPage {
                         icon-name: "categories-symbolic";
                       }
 
-                      Adw.WrapBox categories_wrapbox {
-                        justify: fill;
+                      Gtk.FlowBox categories_wrapbox {
                         halign: start;
                         hexpand: true;
                         valign: center;
-                        line-spacing: 6;
-                        child-spacing: 6;
+                        row-spacing: 6;
+                        column-spacing: 6;
+                        selection-mode: none;
+                        homogeneous: true;
                       }
                     }
 
diff --git a/data/ui/card_tracking.blp b/data/ui/card_tracking.blp
index 4dc8fd83..4126eb6e 100644
--- a/data/ui/card_tracking.blp
+++ b/data/ui/card_tracking.blp
@@ -12,7 +12,6 @@ template $TrackingDialog : Adw.PreferencesDialog {
   Adw.PreferencesPage {
     name: "trackers";
     Adw.PreferencesGroup group {
-      separate-rows: true;
     }
   }
 }
diff --git a/data/ui/card_tracking_search.blp b/data/ui/card_tracking_search.blp
index 1239603e..80f5b637 100644
--- a/data/ui/card_tracking_search.blp
+++ b/data/ui/card_tracking_search.blp
@@ -62,7 +62,7 @@ template $TrackingSearchSubPage : Adw.NavigationPage {
               valign: center;
               halign: center;
 
-              Adw.Spinner spinner {
+              Spinner spinner {
                 height-request: 48;
                 width-request: 48;
               }
diff --git a/data/ui/explorer_search.blp b/data/ui/explorer_search.blp
index 72b6ac4a..b48e5f5d 100644
--- a/data/ui/explorer_search.blp
+++ b/data/ui/explorer_search.blp
@@ -36,7 +36,6 @@ template $ExplorerSearchPage : Adw.NavigationPage {
     }
 
     content: Adw.ViewStack stack {
-      enable-transitions: true;
 
       Adw.ViewStackPage {
         name: "search";
@@ -123,9 +122,13 @@ template $ExplorerSearchPage : Adw.NavigationPage {
                     valign: center;
                     halign: center;
 
-                    Adw.Spinner search_spinner {
+                    Spinner search_spinner {
                       height-request: 48;
                       width-request: 48;
+
+                        styles [
+                          "spinner",
+                        ]
                     }
                   };
                 }
@@ -198,9 +201,13 @@ template $ExplorerSearchPage : Adw.NavigationPage {
                   valign: center;
                   halign: center;
 
-                  Adw.Spinner most_popular_spinner {
+                  Spinner most_popular_spinner {
                     height-request: 48;
                     width-request: 48;
+
+                    styles [
+                      "spinner",
+                    ]
                   }
                 };
               }
@@ -265,9 +272,13 @@ template $ExplorerSearchPage : Adw.NavigationPage {
                   valign: center;
                   halign: center;
 
-                  Adw.Spinner latest_updates_spinner {
+                  Spinner latest_updates_spinner {
                     height-request: 48;
                     width-request: 48;
+
+                    styles [
+                      "spinner",
+                    ]
                   }
                 };
               }
diff --git a/data/ui/preferences.blp b/data/ui/preferences.blp
index 5e76d584..8a052939 100644
--- a/data/ui/preferences.blp
+++ b/data/ui/preferences.blp
@@ -356,12 +356,6 @@ template $PreferencesDialog : Adw.PreferencesDialog {
     title: _("Advanced");
     icon-name: "applications-science-symbolic";
 
-    banner: Adw.Banner advanced_banner {
-        title: _("A setting has changed that requires a restart to take effect");
-        button-label: _("Got it!");
-        button-style: suggested;
-    };
-
     Adw.PreferencesGroup {
       title: _("Data");
       description: _("Data not saved in the library");
diff --git a/data/ui/shortcuts.blp b/data/ui/shortcuts.blp
index ba00084d..d230b6db 100644
--- a/data/ui/shortcuts.blp
+++ b/data/ui/shortcuts.blp
@@ -3,133 +3,132 @@
 // SPDX-License-Identifier: GPL-3.0-or-later
 
 using Gtk 4.0;
-using Adw 1;
 
-Adw.ShortcutsDialog shortcuts_dialog {
-  Adw.ShortcutsSection {
+Gtk.ShortcutsWindow shortcuts_dialog {
+  Gtk.ShortcutsSection {
     title: C_("Shortcut window description", "Application");
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Open Preferences");
       action-name: "app.preferences";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Toggle Fullscreen Mode");
       action-name: "app.fullscreen";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Open Keyboard Shortcuts");
       action-name: "app.shortcuts";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Quit");
       action-name: "app.quit";
     }
   }
 
-  Adw.ShortcutsSection {
+  Gtk.ShortcutsSection {
     title: C_("Shortcut window description", "Library");
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Add Manga");
       action-name: "app.add";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Select All");
       action-name: "app.select-all";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Search");
       action-name: "app.enter-search-mode";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Toggle Categories Pane");
       action-name: "app.library.toggle-categories";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Update");
       action-name: "app.library.update";
     }
   }
 
-  Adw.ShortcutsSection {
+  Gtk.ShortcutsSection {
     title: C_("Shortcut window description", "Manga Card");
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Select All Chapters");
       action-name: "app.select-all";
     }
   }
 
-  Adw.ShortcutsSection {
+  Gtk.ShortcutsSection {
     title: C_("Shortcut window description", "Reader");
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Go to Next Page");
       subtitle: _("Paged Reading Modes");
       accelerator: "space";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Go to Right Page");
       subtitle: _("Paged Reading Modes");
       accelerator: "Right k";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Go to Left Page");
       subtitle: _("Paged Reading Modes");
       accelerator: "Left j";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Scroll Down");
       subtitle: _("Webtoon Reading Mode");
       accelerator: "Down Right space k Page_Down";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Scroll Up");
       subtitle: _("Webtoon Reading Mode");
       accelerator: "Up Left j Page_Up";
     }
   }
 
-  Adw.ShortcutsSection {
-    Adw.ShortcutsItem {
+  Gtk.ShortcutsSection {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Zoom In");
       accelerator: "plus";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Zoom Out");
       accelerator: "minus";
     }
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Zoom Reset");
       accelerator: "0";
     }
   }
 
-  Adw.ShortcutsSection {
-    Adw.ShortcutsItem {
+  Gtk.ShortcutsSection {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Save Page");
       action-name: "app.reader.save-page";
     }
   }
 
-  Adw.ShortcutsSection {
+  Gtk.ShortcutsSection {
     title: C_("Shortcut window description", "Download Manager");
 
-    Adw.ShortcutsItem {
+    Gtk.ShortcutsShortcut {
       title: C_("Shortcut window description", "Select All Downloads");
       action-name: "app.select-all";
     }

diff --git a/komikku/application.py b/komikku/application.py
index f1fe4de6..149aad40 100644
--- a/komikku/application.py
+++ b/komikku/application.py
@@ -150,8 +150,8 @@ class ApplicationWindow(Adw.ApplicationWindow):
         self.css_provider = Gtk.CssProvider.new()
         Gtk.StyleContext.add_provider_for_display(Gdk.Display.get_default(), self.css_provider, Gtk.STYLE_PROVIDER_PRIORITY_APPLICATION)
 
-        self.activity_indicator = Adw.Spinner(
-            halign=Gtk.Align.CENTER, valign=Gtk.Align.CENTER, width_request=48, height_request=48, visible=False
+        self.activity_indicator = Gtk.Spinner(
+            halign=Gtk.Align.CENTER, valign=Gtk.Align.CENTER, width_request=48, height_request=48
         )
         self.overlay.add_overlay(self.activity_indicator)
 
@@ -298,7 +298,6 @@ class ApplicationWindow(Adw.ApplicationWindow):
         # Theme (light or dark) and accent colors
         self.init_theme()
         self.init_accent_colors()
-        Adw.StyleManager.get_default().connect('notify::accent-color', lambda _sm, _p: self.init_accent_colors())
 
         GLib.idle_add(self.library.populate)
 
@@ -319,7 +318,7 @@ class ApplicationWindow(Adw.ApplicationWindow):
         GLib.idle_add(self.show_notification)
 
     def init_accent_colors(self):
-        if Adw.StyleManager.get_default().get_system_supports_accent_colors() and Settings.get_default().system_accent_colors:
+        if Settings.get_default().system_accent_colors:
             self.css_provider.load_from_string('')
         else:
             self.css_provider.load_from_string(':root {--accent-bg-color: var(--red-1); --accent-color: oklab(from var(--accent-bg-color) var(--standalone-color-oklab));}')
@@ -417,7 +416,7 @@ available in your region/language."""))
     def on_navigation_popped(self, _nav, _page):
         self.last_navigation_action = 'pop'
 
-        self.activity_indicator.set_visible(False)
+        self.activity_indicator.stop()
         self.banner.props.revealed = False
 
     def on_navigation_pushed(self, _nav):
diff --git a/komikku/card/__init__.py b/komikku/card/__init__.py
index eb80c10f..086b5421 100644
--- a/komikku/card/__init__.py
+++ b/komikku/card/__init__.py
@@ -353,7 +353,7 @@ class CardPage(Adw.NavigationPage):
 
     def on_open_in_browser_menu_clicked(self, _action, _gparam):
         if uri := self.manga.server.get_manga_url(self.manga.slug, self.manga.url):
-            Gtk.UriLauncher.new(uri=uri).launch()
+            Gtk.UriLauncher.new(uri=uri).launch(parent=self.window, cancellable=None, callback=None)
         else:
             self.window.add_notification(_('Failed to get manga URL'))
 
@@ -607,7 +607,11 @@ class InfoBox:
             self.resume_button.remove_css_class('suggested-action')
 
         if manga.genres:
-            self.genres_wrapbox.remove_all()
+            child = self.genres_wrapbox.get_first_child()
+            while child:
+                next_child = child.get_next_sibling()
+                self.genres_wrapbox.remove(child)
+                child = next_child
 
             for genre in sorted(manga.genres):
                 label = Gtk.Label()
diff --git a/komikku/card/chapters_list.py b/komikku/card/chapters_list.py
index f49b94e8..5b07181c 100644
--- a/komikku/card/chapters_list.py
+++ b/komikku/card/chapters_list.py
@@ -377,7 +377,7 @@ class ChaptersList:
         chapters_ids = []
         chapters_data = []
 
-        self.card.window.activity_indicator.set_visible(True)
+        self.card.window.activity_indicator.start()
 
         item = self.list_model.get_item(position.get_uint16())
         rank = item.chapter.rank
@@ -416,12 +416,12 @@ class ChaptersList:
 
                 item.emit_changed()
 
-            self.card.window.activity_indicator.set_visible(False)
+            self.card.window.activity_indicator.stop()
 
             self.card.refresh(unread_chapters=True)
             self.card.window.library.refresh_on_manga_state_changed(self.card.manga)
         else:
-            self.card.window.activity_indicator.set_visible(False)
+            self.card.window.activity_indicator.stop()
             self.card.window.add_notification(_('Failed to update chapters reading status'))
 
     def set_sort_order(self, invalidate=True):
@@ -480,7 +480,7 @@ class ChaptersList:
         chapters_ids = []
         chapters_data = []
 
-        self.card.window.activity_indicator.set_visible(True)
+        self.card.window.activity_indicator.start()
 
         # First, update DB
         for item in self.get_selected_chapters_items():
@@ -512,7 +512,7 @@ class ChaptersList:
                 db_conn.close()
 
                 self.card.leave_selection_mode()
-                self.card.window.activity_indicator.set_visible(False)
+                self.card.window.activity_indicator.stop()
 
                 self.card.refresh(unread_chapters=True)
                 self.card.window.library.refresh_on_manga_state_changed(self.card.manga)
@@ -523,7 +523,7 @@ class ChaptersList:
 
             run_generator(update_chapters_rows)
         else:
-            self.card.window.activity_indicator.set_visible(False)
+            self.card.window.activity_indicator.stop()
             self.card.leave_selection_mode()
             self.card.window.add_notification(_('Failed to update chapters reading status'))
 
diff --git a/komikku/consts.py b/komikku/consts.py
index 45778e50..1023153c 100644
--- a/komikku/consts.py
+++ b/komikku/consts.py
@@ -6,6 +6,7 @@ COVER_WIDTH = 180
 COVER_HEIGHT = 256
 LOGO_SIZE = 32
 MISSING_IMG_RESOURCE_PATH = '/info/febvre/Komikku/images/missing_file.png'
+PIXBUF_ANIMATION = False
 
 DOWNLOAD_MAX_DELAY = 1  # in seconds
 REQUESTS_TIMEOUT = 5
diff --git a/komikku/explorer/search/__init__.py b/komikku/explorer/search/__init__.py
index 3162e63c..4358e819 100644
--- a/komikku/explorer/search/__init__.py
+++ b/komikku/explorer/search/__init__.py
@@ -285,7 +285,7 @@ class ExplorerSearchPage(Adw.NavigationPage):
 
     def on_server_website_button_clicked(self, _button):
         if self.server.base_url:
-            Gtk.UriLauncher.new(uri=self.server.base_url).launch()
+            Gtk.UriLauncher.new(uri=self.server.base_url).launch(parent=self.window, cancellable=None, callback=None)
         else:
             self.window.add_notification(_('Oops, server website URL is unknown.'), timeout=2)
 
@@ -459,7 +459,7 @@ class ExplorerSearchPage(Adw.NavigationPage):
             if server != self.server:
                 return False
 
-            self.window.activity_indicator.set_visible(False)
+            self.window.activity_indicator.stop()
 
             manga = Manga.new(manga_data, self.server, Settings.get_default().long_strip_detection)
 
@@ -477,7 +477,7 @@ class ExplorerSearchPage(Adw.NavigationPage):
             if server != self.server:
                 return False
 
-            self.window.activity_indicator.set_visible(False)
+            self.window.activity_indicator.stop()
 
             self.window.card.init(manga)
 
@@ -485,13 +485,13 @@ class ExplorerSearchPage(Adw.NavigationPage):
             if server != self.server:
                 return False
 
-            self.window.activity_indicator.set_visible(False)
+            self.window.activity_indicator.stop()
 
             self.window.add_notification(message or _("Oops, failed to retrieve manga's information."), timeout=2)
 
             return False
 
-        self.window.activity_indicator.set_visible(True)
+        self.window.activity_indicator.start()
 
         if server is not None:
             self.server = server
diff --git a/komikku/explorer/search/search_global.py b/komikku/explorer/search/search_global.py
index dc5179f6..c974bb72 100644
--- a/komikku/explorer/search/search_global.py
+++ b/komikku/explorer/search/search_global.py
@@ -8,7 +8,6 @@ import gc
 from gettext import gettext as _
 import threading
 
-from gi.repository import Adw
 from gi.repository import GLib
 from gi.repository import Gio
 from gi.repository import Gtk
@@ -258,7 +257,8 @@ class ExplorerSearchStackPageSearchGlobal(ExplorerSearchStackPage):
             row.results = False
             row.is_result = False
             row.add_css_class('explorer-server-listboxrow')
-            spinner = Adw.Spinner()
+            spinner = Gtk.Spinner()
+            spinner.start()
             row.set_child(spinner)
             self.listbox.append(row)
 
diff --git a/komikku/preferences/__init__.py b/komikku/preferences/__init__.py
index 8a6d8468..bc137fb1 100644
--- a/komikku/preferences/__init__.py
+++ b/komikku/preferences/__init__.py
@@ -57,7 +57,6 @@ class PreferencesDialog(Adw.PreferencesDialog):
     page_numbering_switch = Gtk.Template.Child('page_numbering_switch')
     fullscreen_switch = Gtk.Template.Child('fullscreen_switch')
 
-    advanced_banner = Gtk.Template.Child('advanced_banner')
     clear_cached_data_actionrow = Gtk.Template.Child('clear_cached_data_actionrow')
     clear_cached_data_button = Gtk.Template.Child('clear_cached_data_button')
     clear_cached_data_on_app_close_switch = Gtk.Template.Child('clear_cached_data_on_app_close_switch')
@@ -78,7 +77,6 @@ class PreferencesDialog(Adw.PreferencesDialog):
         self.support_close_button.connect('clicked', lambda _btn: self.support_group.set_visible(False))
 
         self.connect('closed', self.on_closed)
-        self.advanced_banner.connect('button-clicked', lambda banner: banner.set_revealed(False))
 
         self.set_config_values()
 
@@ -210,7 +208,6 @@ class PreferencesDialog(Adw.PreferencesDialog):
 
     def on_external_servers_modules_changed(self, switch_button, _gparam):
         active = switch_button.get_active()
-        self.advanced_banner.set_revealed(active != self.external_servers_modules_in_use)
         self.settings.external_servers_modules = active
 
     def on_fullscreen_changed(self, switch_button, _gparam):
diff --git a/komikku/reader/__init__.py b/komikku/reader/__init__.py
index 9c1ab9de..19f538a6 100644
--- a/komikku/reader/__init__.py
+++ b/komikku/reader/__init__.py
@@ -528,7 +528,7 @@ class SettingsDialog(Adw.PreferencesDialog):
         page = Adw.PreferencesPage(title=_('Filters'))
         self.add(page)
 
-        group = Adw.PreferencesGroup(title=_('Filters'), separate_rows=True)
+        group = Adw.PreferencesGroup(title=_('Filters'))
 
         filters = {
             'brightness': {
diff --git a/komikku/reader/pager/image.py b/komikku/reader/pager/image.py
index 02810055..f13ab993 100644
--- a/komikku/reader/pager/image.py
+++ b/komikku/reader/pager/image.py
@@ -27,6 +27,7 @@ from gi.repository.GdkPixbuf import Pixbuf
 from gi.repository.GdkPixbuf import PixbufAnimation
 
 from komikku.consts import MISSING_IMG_RESOURCE_PATH
+from komikku.consts import PIXBUF_ANIMATION
 from komikku.utils import get_image_info
 
 logger = logging.getLogger('komikku')
@@ -542,7 +543,7 @@ class KImage(Gtk.Widget, Gtk.Scrollable):
             elif data:
                 stream = Gio.MemoryInputStream.new_from_data(data, None)
 
-            if not info['is_animated']:
+            if not info['is_animated'] or not PIXBUF_ANIMATION:
                 Pixbuf.new_from_stream_async(stream, None, self.load_ready, callback, info)
             else:
                 PixbufAnimation.new_from_stream_async(stream, None, self.load_ready, callback, info)
@@ -580,7 +581,7 @@ class KImage(Gtk.Widget, Gtk.Scrollable):
         stream.close()
 
         try:
-            if not info['is_animated']:
+            if not info['is_animated'] or not PIXBUF_ANIMATION:
                 pixbuf = Pixbuf.new_from_stream_finish(result)
 
                 self.textures = []
diff --git a/komikku/reader/pager/infinite_canvas.py b/komikku/reader/pager/infinite_canvas.py
index 8b2be278..4c5ffd5a 100644
--- a/komikku/reader/pager/infinite_canvas.py
+++ b/komikku/reader/pager/infinite_canvas.py
@@ -276,8 +276,8 @@ class KInfiniteCanvas(Gtk.Widget, Gtk.Scrollable):
             visible |= page._ic_position < 0 and page._ic_position + page_height >= height
             page.obscured = not visible
 
-            if page.status in ('rendering', 'allocable') and not page.activity_indicator.get_visible():
-                page.activity_indicator.set_visible(visible)
+            if page.status in ('rendering', 'allocable') and not page.activity_indicator.get_spinning():
+                page.activity_indicator.start()
 
             position = Graphene.Point()
             position.init(0, page._ic_position)
@@ -362,7 +362,7 @@ class KInfiniteCanvas(Gtk.Widget, Gtk.Scrollable):
 
     def on_page_rendered(self, page, update, retry):
         if not update:
-            page.activity_indicator.set_visible(False)
+            page.activity_indicator.stop()
 
             if retry:
                 # No idea why this reset is necessary
diff --git a/komikku/reader/pager/page.py b/komikku/reader/pager/page.py
index fff7b99b..483c5f52 100644
--- a/komikku/reader/pager/page.py
+++ b/komikku/reader/pager/page.py
@@ -51,8 +51,8 @@ class Page(Gtk.Overlay):
             self.zoomable = False
 
         # Activity indicator
-        self.activity_indicator = Adw.Spinner(
-            halign=Gtk.Align.CENTER, valign=Gtk.Align.CENTER, width_request=48, height_request=48, visible=False
+        self.activity_indicator = Gtk.Spinner(
+            halign=Gtk.Align.CENTER, valign=Gtk.Align.CENTER, width_request=48, height_request=48
         )
         self.add_overlay(self.activity_indicator)
 
@@ -309,8 +309,8 @@ class Page(Gtk.Overlay):
 
     def start_activity_indicator(self):
         if self.reader.reading_mode != 'webtoon':
-            self.activity_indicator.set_visible(True)
+            self.activity_indicator.start()
 
     def stop_activity_indicator(self, *args):
         if self.reader.reading_mode != 'webtoon':
-            self.activity_indicator.set_visible(False)
+            self.activity_indicator.stop()
diff --git a/komikku/support.py b/komikku/support.py
index 9a99314e..75fef72e 100644
--- a/komikku/support.py
+++ b/komikku/support.py
@@ -50,7 +50,7 @@ class SupportPage(Adw.NavigationPage):
             clipboard.set_content(content)
         else:
             if uri := self.payment_methods.get(method):
-                Gtk.UriLauncher.new(uri=uri).launch()
+                Gtk.UriLauncher.new(uri=uri).launch(parent=self.window, cancellable=None, callback=None)
 
     def show(self):
         self.window.navigationview.push(self)
diff --git a/komikku/utils.py b/komikku/utils.py
index 03c75004..99afd429 100644
--- a/komikku/utils.py
+++ b/komikku/utils.py
@@ -36,6 +36,7 @@ from gi.repository import Gtk
 from gi.repository.GdkPixbuf import Pixbuf
 from gi.repository.GdkPixbuf import PixbufAnimation
 
+from komikku.consts import PIXBUF_ANIMATION
 from komikku.consts import REQUESTS_TIMEOUT
 
 logger = logging.getLogger('komikku')
@@ -615,7 +616,7 @@ class CoverLoader(GObject.GObject):
 
         try:
             stream = Gio.MemoryInputStream.new_from_data(data, None)
-            if info['is_animated'] and not static_animation:
+            if info['is_animated'] and not static_animation and PIXBUF_ANIMATION:
                 pixbuf = PixbufAnimation.new_from_stream(stream)
             else:
                 pixbuf = Pixbuf.new_from_stream(stream)
@@ -634,7 +635,7 @@ class CoverLoader(GObject.GObject):
             return None
 
         try:
-            if info['is_animated'] and not static_animation:
+            if info['is_animated'] and not static_animation and PIXBUF_ANIMATION:
                 pixbuf = PixbufAnimation.new_from_file(path)
             else:
                 pixbuf = Pixbuf.new_from_file(path)
diff --git a/meson.build b/meson.build
index d190ee59..cf8543c4 100644
--- a/meson.build
+++ b/meson.build
@@ -22,8 +22,7 @@ domainext = 'info'
 gitrepo = 'https://codeberg.org/' + authornickname + '/' + prettyname
 website = 'https://apps.gnome.org/Komikku/'
 
-python = import('python')
-py_installation = python.find_installation('python3')
+py_installation = import('python').find_installation('@PYTHON@')
 if not py_installation.found()
     error('No valid python3 binary found')
 else
