# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           ocaml 1.1

name                ocaml-atd
github.setup        ahrefs atd 2.16.0
revision            0
categories          ocaml devel
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
license             ISC
description         Parser for the ATD data format description language
long_description    {*}${description}
use_bzip2           yes
extract.suffix      .tbz
distname            atd-${version}
checksums           rmd160  8486d5339f46339837472068b4c46da0b2c32a4b \
                    sha256  59e6b445620241cbd6901a842b336683afb0eb125b3adbfee28bd94cd54e0def \
                    size    3292541
github.tarball_from releases

# This must be depends_lib-append port:ocaml-yojson
# but it is broken until this gets addressed:
# https://github.com/ahrefs/atd/issues/431
depends_build-append \
                    port:ocaml-yojson2

if {${subport} eq ${name}} {
    depends_lib-append \
                    port:ocaml-cmdliner \
                    port:ocaml-easy-format \
                    port:ocaml-menhir \
                    port:ocaml-re
}

ocaml.build_type    dune

subport ocaml-atdgen {
    description     Generates efficient JSON serializers, deserializers and validators

    depends_lib-append \
                    port:ocaml-atd \
                    port:ocaml-atdgen-runtime \
                    port:ocaml-re
}

subport ocaml-atdgen-runtime {
    description     Runtime library for code generated by atdgen
}

if {${subport} ne ${name}} {
    depends_lib-append \
                    port:ocaml-biniou
}
