# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           ocaml 1.1

name                ocaml-cryptokit
set ck_version      1.20
github.setup        xavierleroy cryptokit [string map {. ""} $ck_version] release
version             $ck_version
revision            0
epoch               1

categories          ocaml devel security
license             LGPL-2
maintainers         {landonf @landonf} openmaintainer
description         OCaml interface to cryptographic functions.
long_description    The Cryptokit library for OCaml provides a variety \
                    of cryptographic primitives that can be used to implement \
                    cryptographic protocols in security-sensitive applications.
checksums           rmd160  80b882d0c910e410a5cda341232f48a231132e13 \
                    sha256  3a4205703c6819a2c338ffebb2c025af3ef3d24ad716cc9138b5099c5b346873 \
                    size    162484
github.tarball_from archive

# https://github.com/xavierleroy/cryptokit/issues/43
# https://github.com/xavierleroy/cryptokit/commit/84bc924f755187c4393c6f0c3ba974112eff8865
# https://github.com/xavierleroy/cryptokit/commit/0c037d9fe269fc0d16e78a2169d1959f10888c46
patchfiles          backports.diff

if {${os.platform} eq "darwin" && ${os.major} < 16} {
    PortGroup       legacysupport 1.1

    patchfiles-append \
                    patch-stubs-rng.c.diff

    post-patch {
        reinplace "s,@PREFIX@,${prefix}," ${worksrcpath}/src/dune
    }
}

depends_build-append \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:gmp \
                    port:ocaml-dune-configurator \
                    port:ocaml-zarith \
                    port:zlib

ocaml.build_type    dune
