From 5977f63ac6e8c7f97b5649278b436c3b33ea42ce Mon Sep 17 00:00:00 2001
From: Diana Kalinichenko <dkalinichenko@janestreet.com>
Date: Thu, 29 May 2025 18:33:32 -0400
Subject: [PATCH] ppxlib.0.36.0

---
 shape/src/bin_shape_expand.ml | 3 ++-
 src/ppx_bin_prot.ml           | 8 ++++----
 2 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/shape/src/bin_shape_expand.ml b/shape/src/bin_shape_expand.ml
index 70a29c1..52a7200 100644
--- shape/src/bin_shape_expand.ml
+++ shape/src/bin_shape_expand.ml
@@ -167,7 +167,8 @@ let of_type
     | Ptyp_class _
     | Ptyp_alias _
     | Ptyp_package _
-    | Ptyp_extension _ ->
+    | Ptyp_extension _
+    | Ptyp_open _ ->
       expr_errorf ~loc "unsupported type: %s" (string_of_core_type typ)
   in
   traverse
diff --git a/src/ppx_bin_prot.ml b/src/ppx_bin_prot.ml
index 7aa6204..b3a597e 100644
--- src/ppx_bin_prot.ml
+++ src/ppx_bin_prot.ml
@@ -466,7 +466,7 @@ module Generate_bin_size = struct
       List.map args ~f:(fun ty ->
         match bin_size_type full_type_name ty.ptyp_loc ty ~locality with
         | `Fun e -> e
-        | `Match cases -> pexp_function ~loc:{ ty.ptyp_loc with loc_ghost = true } cases)
+        | `Match cases -> pexp_function_cases ~loc:{ ty.ptyp_loc with loc_ghost = true } cases)
     in
     mk_abst_call ~loc id sizers ~locality
 
@@ -756,7 +756,7 @@ module Generate_bin_size = struct
     | `Fun fun_expr when don't_expand -> fun_expr
     | `Fun fun_expr ->
       alias_or_fun fun_expr [%expr fun v -> [%e eapply ~loc fun_expr [ [%expr v] ]]]
-    | `Match matchings -> pexp_function ~loc matchings
+    | `Match matchings -> pexp_function_cases ~loc matchings
   ;;
 
   let sizer_body_of_td ~path td ~locality =
@@ -855,7 +855,7 @@ module Generate_bin_write = struct
         match bin_write_type full_type_name ty.ptyp_loc ty ~locality with
         | `Fun e -> e
         | `Match cases ->
-          [%expr fun buf ~pos -> [%e pexp_function ~loc:ty.ptyp_loc cases]])
+          [%expr fun buf ~pos -> [%e pexp_function_cases ~loc:ty.ptyp_loc cases]])
     in
     mk_abst_call ~loc id writers ~locality
 
@@ -1135,7 +1135,7 @@ module Generate_bin_write = struct
       alias_or_fun
         fun_expr
         [%expr fun buf ~pos v -> [%e mk_buf_pos_call fun_expr ~loc [%expr v]]]
-    | `Match matchings -> [%expr fun buf ~pos -> [%e pexp_function ~loc matchings]]
+    | `Match matchings -> [%expr fun buf ~pos -> [%e pexp_function_cases ~loc matchings]]
   ;;
 
   let writer_type_class_record ~loc ~size ~write =
