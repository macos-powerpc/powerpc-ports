From 034f086610d0a090f905936a37138ab1786901c9 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Tue, 9 Dec 2025 04:01:12 +0800
Subject: [PATCH] kernel_pfkey: fix enum for older macOS

---
 src/libcharon/plugins/kernel_pfkey/kernel_pfkey_ipsec.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/libcharon/plugins/kernel_pfkey/kernel_pfkey_ipsec.c b/src/libcharon/plugins/kernel_pfkey/kernel_pfkey_ipsec.c
index 469b4b9cc6d..bac1e03cbef 100644
--- src/libcharon/plugins/kernel_pfkey/kernel_pfkey_ipsec.c
+++ src/libcharon/plugins/kernel_pfkey/kernel_pfkey_ipsec.c
@@ -75,6 +75,7 @@
 #include <errno.h>
 #ifdef __APPLE__
 #include <sys/sysctl.h>
+#include <AvailabilityMacros.h>
 #endif
 
 #include "kernel_pfkey_ipsec.h"
@@ -740,16 +741,22 @@ ENUM(sadb_ext_type_names, SADB_EXT_RESERVED, SADB_EXT_MAX,
 	"SADB_X_EXT_POLICY",
 	"SADB_X_EXT_SA2",
 #ifdef __APPLE__
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1060
 	"SADB_EXT_SESSION_ID",
 	"SADB_EXT_SASTAT",
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1090
 	"SADB_X_EXT_IPSECIF",
 	"SADB_X_EXT_ADDR_RANGE_SRC_START",
 	"SADB_X_EXT_ADDR_RANGE_SRC_END",
 	"SADB_X_EXT_ADDR_RANGE_DST_START",
 	"SADB_X_EXT_ADDR_RANGE_DST_END",
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 101100
 	"SADB_EXT_MIGRATE_ADDRESS_SRC",
 	"SADB_EXT_MIGRATE_ADDRESS_DST",
 	"SADB_X_EXT_MIGRATE_IPSECIF",
+#endif
+#endif
+#endif
 #else
 	"SADB_X_EXT_NAT_T_TYPE",
 	"SADB_X_EXT_NAT_T_SPORT",
