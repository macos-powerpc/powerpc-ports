--- auxil/spicy/3rdparty/reproc/reproc/src/process.posix.c	2025-08-19 02:02:17.000000000 +0800
+++ auxil/spicy/3rdparty/reproc/reproc/src/process.posix.c	2025-08-20 14:57:38.000000000 +0800
@@ -17,6 +17,11 @@
 #include "pipe.h"
 #include "strv.h"
 
+#ifdef __APPLE__
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
+#endif
+
 const pid_t PROCESS_INVALID = -1;
 
 static int signal_mask(int how, const sigset_t *newmask, sigset_t *oldmask)
@@ -335,7 +340,9 @@
     }
   }
 
+#ifndef __APPLE__
   extern char **environ; // NOLINT
+#endif
   char *const *parent = options.env.behavior == REPROC_ENV_EMPTY ? NULL
                                                                  : environ;
   env = strv_concat(parent, options.env.extra);
