# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           openssl 1.0

github.setup        haiwen seafile 9.0.15 v
revision            0
categories          devel
license             GPL-3
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
description         Open Source Cloud Storage (Client)
long_description    {*}${description}
checksums           rmd160  10ccb9314e8551de2a062bac3ce8c1def4613cb4 \
                    sha256  7f71100095d98bc561f97370e40adfc0b16a8916b86d1a8f806df5b08754cddf \
                    size    770548
github.tarball_from archive

patch.pre_args-replace  -p0 -p1
patchfiles          0001-wt-monitor-macos.c-support-10.7.patch

set python.version  313
set python.branch   [string index ${python.version} 0].[string range ${python.version} 1 end]
set python.prefix   ${frameworks_dir}/Python.framework/Versions/${python.branch}
set python.bin      ${python.prefix}/bin/python${python.branch}

post-patch {
    reinplace "s|/usr/bin/env python3|${python.bin}|" ${worksrcpath}/app/seaf-cli
}

use_autoreconf      yes

depends_build-append \
                    port:gettext \
                    path:bin/pkg-config:pkgconfig \
                    port:python${python.version} \
                    path:bin/vala:vala

depends_lib-append  port:argon2 \
                    port:curl \
                    port:gettext-runtime \
                    path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    port:jansson \
                    port:libarchive \
                    port:libevent \
                    port:libiconv \
                    port:libsearpc \
                    port:libuuid \
                    port:libwebsockets \
                    port:sqlite3 \
                    port:zlib

depends_run-append  bin:bash:bash \
                    port:py${python.version}-urllib3

configure.args-append \
                    --enable-console \
                    --enable-ws \
                    --with-python_prefix=${python.prefix}
