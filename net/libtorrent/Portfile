# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           active_variants 1.1
PortGroup           github 1.0
PortGroup           openssl 1.0

github.setup        rakshasa libtorrent 0.16.5 v
revision            0
conflicts           libtorrent-devel
categories          net devel
maintainers         nomaintainer
license             {GPL-2+ OpenSSLException}
description         BitTorrent library
long_description    libTorrent is a BitTorrent library written in C++ \
                    for *nix. It is designed to avoid redundant copying and \
                    storing of data that other clients and libraries suffer from.

checksums           rmd160  fa96797ed6180da1d3d95fa9651011c079490d8f \
                    sha256  fdd94681b92d8a5bc6077bb54d8c6529fe8bfa700af9ec118e0292c8200dbcb3 \
                    size    462185
github.tarball_from archive

use_autoreconf      yes

depends_build-append \
                    path:bin/pkg-config:pkgconfig

# malformed object (unknown load command 2)
if {${os.platform} eq "darwin" && ${os.major} <= 10} {
    depends_build-append port:cctools
}

depends_lib-append  port:curl \
                    port:libsigcxx2 \
                    port:zlib

# https://github.com/rakshasa/rtorrent/wiki/Installing#non-blocking-hostname-lookup-in-curl
require_active_variants curl ares

compiler.cxx_standard   2011

configure.args      --disable-debug

if {${os.platform} ne "linux"} {
    configure.args-append \
                    --with-kqueue \
                    --without-epoll
}

post-destroot {
    set docdir ${prefix}/share/doc/${name}
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING README.md \
        ${destroot}${docdir}
}

if {${os.platform} eq "darwin" && ${os.major} <= 9} {
    # socket_fd.cc:74:43: error: 'IPV6_TCLASS' was not declared in this scope
    patchfiles-append   patch-src-net-socket-no-tclass.diff
}
