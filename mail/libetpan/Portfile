# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

# Upstream maintenance seems to have ceased. Update to the last commit, pick fixes from PRs.
github.setup            dinhviethoa libetpan 5c9eb6b6ba64c4eb927d7a902317410181aacbba
version                 2022.12.20
revision                0
categories              mail devel
license                 BSD
maintainers             nomaintainer

description             Mail access library
long_description        libEtPan provides a portable, efficient framework \
                        for different kinds of mail access:\
                        IMAP, SMTP, POP and NNTP.\
                        It provides an API for C language.

checksums               rmd160  88b45d42425241947f93b68ade3c243742501f15 \
                        sha256  86db1840f85bdf4a7d298ba22a848b3aa57a332dd7c2fb9b83a72f6f8c9e50ec \
                        size    1003770
github.tarball_from     archive

patch.pre_args-replace  -p0 -p1

# Pick patches used by libbs and evergreen:
# https://github.com/InterLinked1/lbbs/blob/f27083fd839cc7a90696d4c25881e3d489dd1219/scripts/libetpan.sh#L21-L30
# https://github.com/dinhvh/libetpan/pull/437
# https://github.com/dinhvh/libetpan/pull/446
# https://github.com/dinhvh/libetpan/pull/447
patchfiles-append       PR-437.patch \
                        PR-446.patch \
                        PR-447.patch

depends_build-append    port:autoconf \
                        port:automake \
                        port:libtool \
                        path:bin/pkg-config:pkgconfig

depends_lib-append      port:curl \
                        port:cyrus-sasl2 \
                        port:expat \
                        port:libiconv \
                        path:lib/libssl.dylib:openssl \
                        port:zlib

configure.cmd           ./autogen.sh
configure.args-append   --disable-db \
                        --disable-debug \
                        --disable-dependency-tracking \
                        --disable-silent-rules \
                        --with-openssl=${prefix} \
                        --with-sasl=${prefix}

platform linux {
    # Patch from nmail upstream:
    # https://github.com/dinhvh/libetpan/pull/433
    patchfiles-append   PR-433.patch

    configure.args-append \
                        --with-poll
}
