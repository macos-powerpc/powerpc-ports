# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               legacysupport 1.1
PortGroup               openssl 1.0

# O_CLOEXEC
legacysupport.newest_darwin_requires_legacy 10

name                    cone
# Recent versions are broken: https://github.com/svarshavchik/courier/issues/71
version                 1.15
revision                0
categories              mail
license                 GPL-3
maintainers             nomaintainer
description             Text-based mail client
long_description        {*}${description}, based, in part, on Courier libraries.

homepage                https://www.courier-mta.org/${name}/index.html
master_sites            sourceforge:project/courier/${name}/${version}
use_bzip2               yes

checksums               rmd160  521d34d1c66d5070d0550384520ee29cb269b0cd \
                        sha256  8678ef250e722a24e841f55d3b867c21ce483569d1dcaadb2b05965ca9825f66 \
                        size    4010664

# https://github.com/svarshavchik/courier-libs/commit/a6fd5fcd48e10a54910277cace271608dee26154
# https://github.com/svarshavchik/courier/commit/994cf546c7e3babbeb552375e5451110db6a98f2
patchfiles-append       courier-unicode.patch

depends_build-append    port:gettext \
                        path:bin/perl:perl5 \
                        path:bin/pkg-config:pkgconfig

depends_lib-append      port:aspell \
                        port:courier-sox \
                        port:courier-unicode \
                        port:gettext-runtime \
                        port:gnupg2 \
                        port:kerberos5 \
                        port:libiconv \
                        port:libidn2 \
                        port:libxml2 \
                        port:ncurses \
                        path:lib/libldap.dylib:openldap

configure.args-append   --with-notice=unicode

compiler.cxx_standard   2017
configure.cxxflags-append \
                        -std=gnu++17

# https://github.com/svarshavchik/courier/issues/72
configure.cppflags-append \
                        -D_XOPEN_SOURCE_EXTENDED=1

# Undefined symbols for architecture x86_64: "_libiconv"
configure.ldflags-append \
                        -liconv
