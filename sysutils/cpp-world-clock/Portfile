# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0

name                cpp-world-clock
github.setup        kburchfiel cpp_world_clock_2025 1.0.1 v
revision            0
categories          sysutils
license             MIT
maintainers         nomaintainer
description         Simple C++-based world clock viewer
long_description    {*}${description}
checksums           rmd160  c1cd24cdf6c4e9462e5724cd3c59fb22b9748d5a \
                    sha256  452cdca4c34618a2cf1dda57a189e5b6cdd3be90996d1ddd21c5c84459d4745b \
                    size    373246
github.tarball_from archive

set tzdir           ${prefix}/share/${name}

patchfiles          patch-fix-tzdir.diff

# Well, this is rather arbitrary, modify if needed:
patchfiles-append   patch-tz.diff

post-patch {
    reinplace "s|@TZDIR@|${tzdir}|" ${worksrcpath}/cpp_world_clock.cpp
}

compiler.blacklist-append \
                    *gcc-4.* {clang}
# Requires the new ABI: https://github.com/kburchfiel/cpp_world_clock_2025/issues/1
# compiler.cxx_standard   2023

post-patch {
    reinplace "s|UNIX AND NOT APPLE|UNIX OR APPLE|" ${worksrcpath}/CMakeLists.txt
}

destroot {
    copy ${cmake.build_dir}/cwc25 ${destroot}${prefix}/bin/cwc
    xinstall -d ${destroot}${tzdir}
    copy ${worksrcpath}/tz_list.csv ${destroot}${tzdir}/
}

notes "
    Desired time-zones can be adjusted in ${tzdir}/tz_list.csv
"
