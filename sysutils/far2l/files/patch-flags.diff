From 23d175b24b7739d2b24dce58f3c1362e4823f96f Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Wed, 17 Sep 2025 20:44:50 +0800
Subject: [PATCH] Use -fobjc-arc only with Clang

---
 WinPort/src/Backend/WX/CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/WinPort/src/Backend/WX/CMakeLists.txt b/WinPort/src/Backend/WX/CMakeLists.txt
index a357ea2ecb..36b1c8dbc7 100644
--- WinPort/src/Backend/WX/CMakeLists.txt
+++ WinPort/src/Backend/WX/CMakeLists.txt
@@ -69,7 +69,7 @@ if(CMAKE_THREAD_LIBS_INIT)
     target_link_libraries(far2l_gui "${CMAKE_THREAD_LIBS_INIT}")
 endif()
 
-if (${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
+if (${CMAKE_SYSTEM_NAME} MATCHES "Darwin" AND ${CMAKE_CXX_COMPILER} MATCHES "Clang")
     set_property (TARGET far2l_gui APPEND_STRING PROPERTY COMPILE_FLAGS "-fobjc-arc")
 endif()
 
From bd5e46c1e31f97041750252ab6a11c53aa5a1a65 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Wed, 17 Sep 2025 20:42:21 +0800
Subject: [PATCH] Fix -force_load flag on macOS

---
 far2l/CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/far2l/CMakeLists.txt b/far2l/CMakeLists.txt
index 6033b32795..5a699f05e8 100644
--- far2l/CMakeLists.txt
+++ far2l/CMakeLists.txt
@@ -251,7 +251,7 @@ target_include_directories(far2l PRIVATE
 add_dependencies(far2l bootstrap WinPort)
 
 if (${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
-    SET (WINPORT -force_load WinPort wineguts utils)
+    SET (WINPORT -Wl,-force_load WinPort wineguts utils)
 else()
     SET (WINPORT -Wl,--whole-archive WinPort -Wl,--no-whole-archive)
 endif()
