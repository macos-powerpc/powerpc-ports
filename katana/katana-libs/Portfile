# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           bitbucket 1.0
PortGroup           cmake 1.1
PortGroup           legacysupport 1.1
PortGroup           openssl 1.0

# strnlen
legacysupport.newest_darwin_requires_legacy 10

set component       libs

name                katana-${component}
bitbucket.setup     smil3y kde${component} 4353527b772ad2babcc524ce2afbf3c0129aa814
version             4.24.0-20240806
revision            1
categories          katana devel kde
conflicts           kdelibs4
license             BSD LGPL-2.1
maintainers         {@barracuda156 macos-powerpc.org:barracuda}
homepage            https://bitbucket.org/smil3y/kde${component}
description         Kde${component} for Katana
long_description    {*}${description}, a fork of KDE4.

checksums           rmd160  cc7512730add9b519ec6f0472fafbc821e711ddc \
                    sha256  751f69118cb63d4a731dc521abd5fe9b646217e83bd510d84e06278a72b17363 \
                    size    6132284

extract.rename      yes

patch.pre_args-replace  -p0 -p1

patchfiles-append   0001-Fix-broken-shared-mime-info-search.patch \
                    0002-ksavefile.cpp-undefine-HAVE_FDATASYNC-on-Apple-it-do.patch \
                    0003-kpty.cpp-fix-for-Apple.patch \
                    0004-karchive.cpp-fix-for-Apple.patch \
                    0005-Fix-webp-linking.patch \
                    0006-Fix-sig-macros-usage.patch \
                    0007-kde4_exec.sh-fix-dbus-session-for-macOS.patch \
                    0008-kded_kpowermanager-temporarily-exclude-KNotification.patch \
                    0009-karchive.cpp-include-missing-limits.h.patch \
                    0010-kurlcompletion.cpp-fix-environ-for-Apple.patch

depends_build-append \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:avahi \
                    port:bzip2 \
                    port:curl \
                    port:dbus \
                    port:djvulibre \
                    port:enchant \
                    port:exiv2 \
                    port:ffmpeg \
                    path:lib/pkgconfig/freetype2.pc:freetype \
                    port:katie \
                    port:libarchive \
                    port:libcdio \
                    port:libdeflate \
                    path:include/turbojpeg.h:libjpeg-turbo \
                    port:libraw \
                    port:libspectre \
                    path:lib/pkgconfig/mpv.pc:mpv \
                    port:openjpeg \
                    path:lib/pkgconfig/poppler.pc:poppler \
                    port:shared-mime-info \
                    port:taglib \
                    port:tiff \
                    port:webp \
                    port:xdg-utils \
                    port:xorg-libX11 \
                    port:xorg-libXcursor \
                    port:xorg-libXext \
                    port:xorg-libXfixes \
                    port:xorg-libXScrnSaver \
                    port:xz

depends_run-append  port:ariya-icons

# This is required:
configure.pre_args-replace \
                    -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=ON \
                    -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=OFF

configure.args-append \
                    -DENABLE_TESTING=OFF \
                    -DKDE4_SYSCONF_INSTALL_DIR=${cmake.install_prefix}/etc

compiler.cxx_standard       2014
compiler.blacklist-append   {clang}

# This prevents from using C++17 or higher:
# /opt/local/include/exiv2/value.hpp:54:17: error: no template named 'auto_ptr'
# in namespace 'std'; did you mean simply 'auto_ptr'?
# However, this needs gcc extensions or a switch to C++20:
# kdecore/io/kdebug.h:98:72: error: expected primary-expression before ')' token
configure.cxxflags-append   -std=gnu++14

# Just to pick +x11 variants for dependencies:
variant x11 { }

default_variants +x11
