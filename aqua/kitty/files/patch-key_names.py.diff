--- kitty/key_names.py.orig	2022-09-05 13:19:50.000000000 +0800
+++ kitty/key_names.py	2026-01-08 03:33:33.000000000 +0800
@@ -55,40 +55,36 @@
     return None
 
 
-if is_macos:
-    def get_key_name_lookup() -> LookupFunc:
-        return null_lookup
-else:
-    def load_libxkb_lookup() -> LookupFunc:
-        import ctypes
-        for suffix in ('.0', ''):
-            with suppress(Exception):
-                lib = ctypes.CDLL(f'libxkbcommon.so{suffix}')
-                break
-        else:
-            from ctypes.util import find_library
-            lname = find_library('xkbcommon')
-            if lname is None:
-                raise RuntimeError('Failed to find libxkbcommon')
-            lib = ctypes.CDLL(lname)
-
-        f = lib.xkb_keysym_from_name
-        f.argtypes = [ctypes.c_char_p, ctypes.c_int]
-        f.restype = ctypes.c_int
-
-        def xkb_lookup(name: str, case_sensitive: bool = False) -> Optional[int]:
-            q = name.encode('utf-8')
-            return f(q, int(case_sensitive)) or None
-
-        return xkb_lookup
-
-    def get_key_name_lookup() -> LookupFunc:
-        ans: Optional[LookupFunc] = getattr(get_key_name_lookup, 'ans', None)
-        if ans is None:
-            try:
-                ans = load_libxkb_lookup()
-            except Exception as e:
-                print('Failed to load libxkbcommon.xkb_keysym_from_name with error:', e, file=sys.stderr)
-                ans = null_lookup
-            setattr(get_key_name_lookup, 'ans', ans)
-        return ans
+def load_libxkb_lookup() -> LookupFunc:
+    import ctypes
+    for suffix in ('.0', ''):
+        with suppress(Exception):
+            lib = ctypes.CDLL(f'libxkbcommon.dylib')
+            break
+    else:
+        from ctypes.util import find_library
+        lname = find_library('xkbcommon')
+        if lname is None:
+            raise RuntimeError('Failed to find libxkbcommon')
+        lib = ctypes.CDLL(lname)
+
+    f = lib.xkb_keysym_from_name
+    f.argtypes = [ctypes.c_char_p, ctypes.c_int]
+    f.restype = ctypes.c_int
+
+    def xkb_lookup(name: str, case_sensitive: bool = False) -> Optional[int]:
+        q = name.encode('utf-8')
+        return f(q, int(case_sensitive)) or None
+
+    return xkb_lookup
+
+def get_key_name_lookup() -> LookupFunc:
+    ans: Optional[LookupFunc] = getattr(get_key_name_lookup, 'ans', None)
+    if ans is None:
+        try:
+            ans = load_libxkb_lookup()
+        except Exception as e:
+            print('Failed to load libxkbcommon.xkb_keysym_from_name with error:', e, file=sys.stderr)
+            ans = null_lookup
+        setattr(get_key_name_lookup, 'ans', ans)
+    return ans
