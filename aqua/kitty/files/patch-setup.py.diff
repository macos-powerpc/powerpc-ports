--- setup.py	2022-09-05 13:19:50.000000000 +0800
+++ setup.py	2026-01-07 22:00:34.000000000 +0800
@@ -464,12 +464,13 @@
         # warnings about it
         cppflags.append('-DGL_SILENCE_DEPRECATION')
     else:
-        cflags.extend(pkg_config('fontconfig', '--cflags-only-I'))
         platform_libs = []
+    cflags.extend(pkg_config('fontconfig', '--cflags-only-I'))
     cflags.extend(pkg_config('harfbuzz', '--cflags-only-I'))
+    platform_libs.extend(pkg_config('fontconfig', '--libs'))
     platform_libs.extend(pkg_config('harfbuzz', '--libs'))
     pylib = get_python_flags(cflags)
-    gl_libs = ['-framework', 'OpenGL'] if is_macos else pkg_config('gl', '--libs')
+    gl_libs =  pkg_config('gl', '--libs')
     libpng = pkg_config('libpng', '--libs')
     lcms2 = pkg_config('lcms2', '--libs')
     ans.ldpaths += pylib + platform_libs + gl_libs + libpng + lcms2 + libcrypto_ldflags
@@ -746,9 +747,9 @@
     ans, headers = [], []
     d = 'kitty'
     exclude = {
-        'fontconfig.c', 'freetype.c', 'desktop.c', 'freetype_render_ui_text.c'
+        'core_text.m', 'cocoa_window.m'
     } if is_macos else {
-        'core_text.m', 'cocoa_window.m', 'macos_process_info.c'
+        'macos_process_info.c'
     }
     for x in sorted(os.listdir(d)):
         ext = os.path.splitext(x)[1]
@@ -761,7 +762,7 @@
 
 
 def compile_glfw(compilation_database: CompilationDatabase) -> None:
-    modules = 'cocoa' if is_macos else 'x11 wayland'
+    modules = 'x11' if is_macos else 'x11 wayland'
     for module in modules.split():
         try:
             genv = glfw.init_env(env, pkg_config, pkg_version, at_least_version, test_compile, module)
