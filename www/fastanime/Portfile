# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           python 1.0

name                fastanime
version             3.1.0
revision            0
categories-prepend  www multimedia anime
# Does not work on 10.5 due to an obscure python bug: https://trac.macports.org/ticket/67046
# Works fine on 10.6 powerpc.
platforms           {darwin >= 10}
license             Unlicense
maintainers         {@barracuda156 macos-powerpc.org:barracuda} \
                    openmaintainer
description         Your browser anime experience, from the terminal
long_description    {*}${description}
homepage            https://github.com/Benexl/FastAnime
checksums           rmd160  e2ed0f50f5ab555c49839f13a432968cbfcc8ae5 \
                    sha256  c8941d6a6cf89947e2e5dab1154659b97f7ab0819a3a6ad45ddfbe699a666d5a \
                    size    577082
supported_archs     noarch

# TODO/FIXME: not everything is expected to work at the moment.
# However, basic functionality has been fixed. Search, downloading
# and streaming appear to work fine.

# https://github.com/Benexl/FastAnime/issues/123
patchfiles-append   0001-Fixes-for-pydantic.patch

# This should match libtorrent-rasterbar:
python.default_version  313

python.pep517_backend   hatch

depends_lib-append  port:py${python.version}-click \
                    port:py${python.version}-httpx \
                    port:py${python.version}-inquirerpy \
                    port:py${python.version}-pydantic \
                    port:py${python.version}-rich

# TODO: consider alternatives to mpv as possible choices.
depends_run-append  port:ffmpeg \
                    path:bin/mpv:mpv \
                    port:py${python.version}-lxml \
                    port:py${python.version}-pycryptodomex \
                    port:py${python.version}-pypresence \
                    port:py${python.version}-thefuzz \
                    port:yt-dlp

# Move optional and heavy dependencies here:
variant full description "Enable extra functionality" {
    depends_run-append \
                    port:chafa \
                    port:dbus-python${python.version} \
                    port:feh \
                    port:ffmpegthumbnailer \
                    port:libtorrent-rasterbar \
                    port:rofi
}
