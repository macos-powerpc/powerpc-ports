From dfe3da26ab2a51f005189339fd9f765c6b4ec91b Mon Sep 17 00:00:00 2001
From: Brian Smith <brian@dbsoft.org>
Date: Sun, 27 Jul 2025 19:34:25 -0500
Subject: [PATCH 07/14] Issue #2051 - Follow-up Part 2e: Force fallback to
 raster with CoreGraphics.

---
 gfx/2d/DrawTargetCG.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/gfx/2d/DrawTargetCG.cpp b/gfx/2d/DrawTargetCG.cpp
index 256a1a66f9..17f8f02da9 100644
--- a/gfx/2d/DrawTargetCG.cpp
+++ b/gfx/2d/DrawTargetCG.cpp
@@ -172,14 +172,18 @@ DrawTargetCG::~DrawTargetCG()
 DrawTargetType
 DrawTargetCG::GetType() const
 {
+#if !defined(__ppc__)
   return GetBackendType() == BackendType::COREGRAPHICS_ACCELERATED ?
            DrawTargetType::HARDWARE_RASTER : DrawTargetType::SOFTWARE_RASTER;
+#else
+  return DrawTargetType::SOFTWARE_RASTER;
+#endif
 }
 
 BackendType
 DrawTargetCG::GetBackendType() const
 {
-#ifdef MOZ_WIDGET_COCOA
+#if defined(MOZ_WIDGET_COCOA) && !defined(__ppc__)
   // It may be worth spliting Bitmap and IOSurface DrawTarget
   // into seperate classes.
   if (GetContextType(mCg) == CG_CONTEXT_TYPE_IOSURFACE) {
@@ -196,7 +200,7 @@ already_AddRefed<SourceSurface>
 DrawTargetCG::Snapshot()
 {
   if (!mSnapshot) {
-#ifdef MOZ_WIDGET_COCOA
+#if defined(MOZ_WIDGET_COCOA) && !defined(__ppc__)
     if (GetContextType(mCg) == CG_CONTEXT_TYPE_IOSURFACE) {
       return MakeAndAddRef<SourceSurfaceCGIOSurfaceContext>(this);
     }
-- 
2.50.1

