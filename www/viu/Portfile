# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           python 1.0

# This is renamed FastAnime 3.x, from the same upstream.
# https://github.com/Benexl/FastAnime
# For a while we keep it as a separate port.
github.setup        Benexl viu 3.2.7 v
revision            0
categories-prepend  www multimedia
platforms           any
license             Unlicense
maintainers         {@barracuda156 macos-powerpc.org:barracuda} \
                    openmaintainer
description         Your browser anime experience, from the terminal
long_description    {*}${description}
checksums           rmd160  e7c694a116381fad1cb7e84dc67e506f9c1e1fd8 \
                    sha256  3201ee218d7f8a94304c70e1e5b05f6883ea248fabfcf558cd600812ecfe6a4d \
                    size    675613
github.tarball_from archive
supported_archs     noarch

# TODO/FIXME: not everything is expected to work at the moment.
# However, basic functionality has been fixed. Search, downloading
# and streaming appear to work fine.

patch.pre_args-replace  -p0 -p1

# https://github.com/Benexl/FastAnime/issues/123
patchfiles-append   0001-Fixes-for-pydantic.patch

# This should match libtorrent-rasterbar:
python.default_version  313

python.pep517_backend   hatch

depends_lib-append  port:py${python.version}-click \
                    port:py${python.version}-httpx \
                    port:py${python.version}-inquirerpy \
                    port:py${python.version}-pydantic \
                    port:py${python.version}-rich

# TODO: consider alternatives to mpv as possible choices.
depends_run-append  path:bin/ffmpeg:ffmpeg \
                    path:bin/mpv:mpv \
                    port:py${python.version}-lxml \
                    port:py${python.version}-pycryptodomex \
                    port:py${python.version}-pypresence \
                    port:py${python.version}-thefuzz \
                    port:yt-dlp

# Move optional and heavy dependencies here:
variant full description "Enable extra functionality" {
    depends_run-append \
                    port:chafa \
                    port:dbus-python${python.version} \
                    port:feh \
                    port:ffmpegthumbnailer \
                    port:libtorrent-rasterbar \
                    port:rofi
}

# py-pyobjc and py-plyer are dropped due to being broken presently.
