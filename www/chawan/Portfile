# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           makefile 1.0
PortGroup           openssl 1.0
PortGroup           sourcehut 1.0

sourcehut.setup     bptato chawan 0.3.3 v
revision            0
categories          www
license             Unlicense
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer

description         TUI web browser
long_description    {*}${description} with CSS, inline image and JavaScript support.

checksums           rmd160  d276f5d81cf6e79a30bb812faa8a7f156f4f58df \
                    sha256  3ebcd653e90684ba2e871968b19af77ced082f224cd084e70998db7e1512d1c5 \
                    size    3642240

depends_build-append \
                    port:nim \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:brotli \
                    port:curl \
                    port:libssh2 \
                    port:ncurses

compiler.blacklist-append \
                    *gcc-4.* {clang}

# Match Nim port here.
# This is an experimental version. Hardcoding compiler is suboptimal, it will be changed.
compiler.whitelist  macports-gcc-14
configure.cc        ${prefix}/bin/gcc-mp-14

build.cmd-prepend   CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    FLAGS="--cc:gcc --gcc.path=${prefix}/bin --gcc.exe=gcc-mp-14 --gcc.linkerexe=gcc-mp-14 --exceptions:quirky" \
                    CFLAGS="${configure.cflags} -fno-strict-aliasing"

test.run            yes
test.target         test
test.cmd-prepend    CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    FLAGS="--cc:gcc --gcc.path=${prefix}/bin --gcc.exe=gcc-mp-14 --gcc.linkerexe=gcc-mp-14 --exceptions:quirky" \
                    CFLAGS="${configure.cflags} -fno-strict-aliasing"

notes "
It is recommended to use a modern terminal emulator with ${name},\
on legacy macOS you may install mlterm(-minimal) port.
Consult with documentation re config options, such as images display, JS etc.
https://chawan.net/doc/cha/config.html
You may place your config file in ~/.${name}/config.toml
"
