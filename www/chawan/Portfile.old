# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           makefile 1.0
PortGroup           openssl 1.0
PortGroup           sourcehut 1.0

sourcehut.setup     bptato chawan 0.3.2 v
revision            0
categories          www
license             Unlicense
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer

description         TUI web browser
long_description    {*}${description} with CSS, inline image and JavaScript support.

checksums           rmd160  3928b54c572170236f00e1fa3f71d4575d69791f \
                    sha256  08f98ddf0040d0bf25dce62eac86d3ec5d2f11b2bc471213eb9c4c861a8d321a \
                    size    3641359

depends_build-append \
                    port:nim \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:brotli \
                    port:curl \
                    port:libssh2 \
                    port:ncurses

depends_run-append  port:libsixel

compiler.blacklist-append \
                    *gcc-4.*

# See discussion: https://codeberg.org/bptato/chawan/issues/15

if {${configure.cxx_stdlib} eq "libc++"} {
    build.cmd-prepend \
                    CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    CFLAGS="${configure.cflags}"

    test.cmd-prepend \
                    CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    CFLAGS="${configure.cflags}"
} else {
    compiler.blacklist-append \
                    {clang}
    configure.cc    ${prefix}/bin/gcc-mp-14

    build.cmd-prepend \
                    CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    FLAGS="--cc:gcc --gcc.path=${prefix}/bin --gcc.exe=gcc-mp-14 --gcc.linkerexe=gcc-mp-14 --exceptions:quirky" \
                    CFLAGS="${configure.cflags} -fno-strict-aliasing"

    test.cmd-prepend \
                    CC=${configure.cc} \
                    NIM=${prefix}/bin/nim \
                    FLAGS="--cc:gcc --gcc.path=${prefix}/bin --gcc.exe=gcc-mp-14 --gcc.linkerexe=gcc-mp-14 --exceptions:quirky" \
                    CFLAGS="${configure.cflags} -fno-strict-aliasing"
}

test.run            yes
test.target         test
