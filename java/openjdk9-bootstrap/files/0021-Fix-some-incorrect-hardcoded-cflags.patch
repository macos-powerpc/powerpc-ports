From 3e2795024ff67aa2d96e370cc8e3b3c1cd44add8 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 21 Jul 2025 02:08:36 +0800
Subject: [PATCH 21/31] Fix some incorrect hardcoded cflags

---
 hotspot/make/gensrc/GensrcDtrace.gmk       | 2 +-
 hotspot/make/lib/CompileLibjsig.gmk        | 4 ++--
 hotspot/make/lib/Lib-jdk.hotspot.agent.gmk | 3 +--
 3 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/hotspot/make/gensrc/GensrcDtrace.gmk b/hotspot/make/gensrc/GensrcDtrace.gmk
index 126be0b359..128334ca81 100644
--- a/hotspot/make/gensrc/GensrcDtrace.gmk
+++ b/hotspot/make/gensrc/GensrcDtrace.gmk
@@ -32,7 +32,7 @@ ifeq ($(call check-jvm-feature, dtrace), true)
     DTRACE_FLAGS := -64
     DTRACE_CPP_FLAGS := -D_LP64
   else ifeq ($(OPENJDK_TARGET_OS), macosx)
-    DTRACE_CPP_FLAGS := -D_LP64 -x c
+    DTRACE_CPP_FLAGS := -x c
   else ifeq ($(OPENJDK_TARGET_OS), linux)
     DTRACE_CPP_FLAGS := -x c
   endif
diff --git a/hotspot/make/lib/CompileLibjsig.gmk b/hotspot/make/lib/CompileLibjsig.gmk
index fbc8abb1ca..06ec08f269 100644
--- a/hotspot/make/lib/CompileLibjsig.gmk
+++ b/hotspot/make/lib/CompileLibjsig.gmk
@@ -49,7 +49,7 @@ ifneq ($(OPENJDK_TARGET_OS), windows)
       else ifeq ($(OPENJDK_TARGET_CPU), x86)
         LIBJSIG_CPU_FLAGS := -m32 -march=i586
       else ifeq ($(OPENJDK_TARGET_CPU), ppc64)
-        LIBJSIG_CPU_FLAGS := -mcpu=powerpc64 -mtune=power5
+        LIBJSIG_CPU_FLAGS := -m64
       else ifeq ($(OPENJDK_TARGET_CPU), ppc64le)
         LIBJSIG_CPU_FLAGS := -DABI_ELFv2 -mcpu=power8 -mtune=power8
       else ifeq ($(OPENJDK_TARGET_CPU), s390x)
@@ -75,7 +75,7 @@ ifneq ($(OPENJDK_TARGET_OS), windows)
       SET_SHARED_LIBRARY_NAME :=
 
     else ifeq ($(OPENJDK_TARGET_OS), macosx)
-      LIBJSIG_CFLAGS := -m64 -D_GNU_SOURCE -pthread -mno-omit-leaf-frame-pointer -mstack-alignment=16 -fPIC
+      LIBJSIG_CFLAGS := -D_GNU_SOURCE -pthread -fno-omit-frame-pointer -fPIC
       LIBJSIG_LDFLAGS := $(LDFLAGS_HASH_STYLE)
     else
       $(error Unknown target OS $(OPENJDK_TARGET_OS) in CompileLibjsig.gmk)
diff --git a/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk b/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
index d3aa941992..0be9e5f669 100644
--- a/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
+++ b/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
@@ -70,8 +70,7 @@ else ifeq ($(OPENJDK_TARGET_OS), solaris)
 else ifeq ($(OPENJDK_TARGET_OS), macosx)
   SA_EXCLUDE_FILES := BsdDebuggerLocal.c ps_proc.c salibelf.c StubDebuggerLocal.c
   SA_CFLAGS := $(CFLAGS_JDKLIB) \
-      -D_GNU_SOURCE -mno-omit-leaf-frame-pointer \
-      -mstack-alignment=16 -fPIC
+      -D_GNU_SOURCE -fno-omit-frame-pointer -fPIC
   SA_LDFLAGS := $(LDFLAGS_JDKLIB)
   SA_LIBS := -framework Foundation -framework Security -framework CoreFoundation
 
-- 
2.24.3 (Apple Git-128)

