From 7250cd684380d550a65a85b3caefaa4d618f584a Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 21 Jul 2025 02:16:15 +0800
Subject: [PATCH 22/31] PLATFORM_API_MacOSX_PCM.cpp: unbreak for legacy OS

---
 .../macosx/native/libjsound/PLATFORM_API_MacOSX_PCM.cpp   | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/jdk/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_PCM.cpp b/jdk/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_PCM.cpp
index cadbb11bc1..3f74594f5e 100644
--- a/jdk/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_PCM.cpp
+++ b/jdk/src/java.desktop/macosx/native/libjsound/PLATFORM_API_MacOSX_PCM.cpp
@@ -29,6 +29,7 @@
 
 #include <AudioUnit/AudioUnit.h>
 #include <AudioToolbox/AudioConverter.h>
+#include <AvailabilityMacros.h>
 #include <pthread.h>
 #include <math.h>
 /*
@@ -616,7 +617,10 @@ struct OSX_DirectAudioDevice {
 
     ~OSX_DirectAudioDevice() {
         if (audioUnit) {
+// Not supported in 10a190, but should work in 10.6.8 ppc
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1060
             AudioComponentInstanceDispose(audioUnit);
+#endif
         }
         if (resampler) {
             delete resampler;
@@ -626,6 +630,7 @@ struct OSX_DirectAudioDevice {
 
 static AudioUnit CreateOutputUnit(AudioDeviceID deviceID, int isSource)
 {
+#if MAC_OS_X_VERSION_MIN_REQUIRED >= 1060
     OSStatus err;
     AudioUnit unit;
 
@@ -679,6 +684,9 @@ static AudioUnit CreateOutputUnit(AudioDeviceID deviceID, int isSource)
     }
 
     return unit;
+#else
+    return NULL;
+#endif
 }
 
 static OSStatus OutputCallback(void                         *inRefCon,
-- 
2.24.3 (Apple Git-128)

