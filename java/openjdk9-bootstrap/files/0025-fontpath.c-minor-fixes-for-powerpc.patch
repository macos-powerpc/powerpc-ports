From 3ea23d52aba3cc0fb58111610574480d3e1a7f19 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 21 Jul 2025 02:37:10 +0800
Subject: [PATCH 25/31] fontpath.c: minor fixes for powerpc

---
 jdk/src/java.desktop/unix/native/common/awt/fontpath.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/jdk/src/java.desktop/unix/native/common/awt/fontpath.c b/jdk/src/java.desktop/unix/native/common/awt/fontpath.c
index 4362da5c43..00db0ef4b4 100644
--- a/jdk/src/java.desktop/unix/native/common/awt/fontpath.c
+++ b/jdk/src/java.desktop/unix/native/common/awt/fontpath.c
@@ -643,6 +643,13 @@ static void* openFontConfig() {
     if (libfontconfig == NULL) {
         libfontconfig = dlopen(FONTCONFIG_DLL, RTLD_LOCAL|RTLD_LAZY);
         if (libfontconfig == NULL) {
+#ifdef __POWERPC__
+            printf("MAC PPC: we failed to load the library %s\n", FONTCONFIG_DLL_VERSIONED);
+            printf("MAC PPC: you need to explicitly put this library in your jdk lib factory\n");
+            printf("MAC PPC: you might have to upde the build sript to add the correct copy action at build\n");
+            printf("MAC PPC: expect java to crash with some null pointer exception...\n");
+            fprintf(stderr, "MAC PPC: error: %s\n", dlerror());
+#endif
             return NULL;
         }
     }
@@ -1152,7 +1159,9 @@ Java_sun_font_FontConfigManager_getFontConfig
     locale = (*env)->GetStringUTFChars(env, localeStr, 0);
     if (locale == NULL) {
         (*env)->ExceptionClear(env);
+#ifndef __POWERPC__
         JNU_ThrowOutOfMemoryError(env, "Could not create locale");
+#endif
         return;
     }
 
-- 
2.24.3 (Apple Git-128)

