From 627774c6f0e3638ce4b587132e45b1974a0a8102 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 21 Jul 2025 03:04:44 +0800
Subject: [PATCH 30/31] IPV6_TCLASS: define if undefined

---
 .../classes/sun/nio/ch/SocketOptionRegistry.java.template | 8 ++++++++
 jdk/src/java.base/unix/native/libnet/net_util_md.c        | 8 ++++++++
 2 files changed, 16 insertions(+)

diff --git a/jdk/src/java.base/share/classes/sun/nio/ch/SocketOptionRegistry.java.template b/jdk/src/java.base/share/classes/sun/nio/ch/SocketOptionRegistry.java.template
index 2819c28410..c680ed2a76 100644
--- a/jdk/src/java.base/share/classes/sun/nio/ch/SocketOptionRegistry.java.template
+++ b/jdk/src/java.base/share/classes/sun/nio/ch/SocketOptionRegistry.java.template
@@ -52,6 +52,14 @@
 #endif
 #endif
 
+#ifndef IPV6_TCLASS
+#if defined(__linux__)
+#define IPV6_TCLASS 61
+#elif defined(MACOSX)
+#define IPV6_TCLASS 36
+#endif
+#endif
+
 /* On Solaris, "sun" is defined as a macro. Undefine to make package
    declaration valid */
 #undef sun
diff --git a/jdk/src/java.base/unix/native/libnet/net_util_md.c b/jdk/src/java.base/unix/native/libnet/net_util_md.c
index 744fc2f629..b0f01cc41f 100644
--- a/jdk/src/java.base/unix/native/libnet/net_util_md.c
+++ b/jdk/src/java.base/unix/native/libnet/net_util_md.c
@@ -72,6 +72,14 @@
 #define UDP_EXCLBIND            0x0101
 #endif
 
+#ifndef IPV6_TCLASS
+#if defined(__linux__)
+#define IPV6_TCLASS 61
+#elif defined(MACOSX)
+#define IPV6_TCLASS 36
+#endif
+#endif
+
 void setDefaultScopeID(JNIEnv *env, struct sockaddr *him)
 {
 #ifdef MACOSX
-- 
2.24.3 (Apple Git-128)

