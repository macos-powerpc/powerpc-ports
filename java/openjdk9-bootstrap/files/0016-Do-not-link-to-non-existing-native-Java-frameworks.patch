From 84a05bf6b8717bde89a161f8c923caf096e73ca3 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Mon, 21 Jul 2025 00:51:52 +0800
Subject: [PATCH 16/31] Do not link to non-existing native Java frameworks

---
 hotspot/make/lib/Lib-jdk.hotspot.agent.gmk | 5 ++---
 jdk/make/lib/Awt2dLibraries.gmk            | 7 -------
 jdk/make/lib/Lib-java.security.jgss.gmk    | 1 -
 jdk/make/lib/LibosxLibraries.gmk           | 2 --
 jdk/make/lib/PlatformLibraries.gmk         | 2 --
 jdk/make/lib/SecurityLibraries.gmk         | 1 -
 6 files changed, 2 insertions(+), 16 deletions(-)

diff --git a/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk b/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
index f6b4a22d44..d3aa941992 100644
--- a/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
+++ b/hotspot/make/lib/Lib-jdk.hotspot.agent.gmk
@@ -70,11 +70,10 @@ else ifeq ($(OPENJDK_TARGET_OS), solaris)
 else ifeq ($(OPENJDK_TARGET_OS), macosx)
   SA_EXCLUDE_FILES := BsdDebuggerLocal.c ps_proc.c salibelf.c StubDebuggerLocal.c
   SA_CFLAGS := $(CFLAGS_JDKLIB) \
-      -Damd64 -D_GNU_SOURCE -mno-omit-leaf-frame-pointer \
+      -D_GNU_SOURCE -mno-omit-leaf-frame-pointer \
       -mstack-alignment=16 -fPIC
   SA_LDFLAGS := $(LDFLAGS_JDKLIB)
-  SA_LIBS := -framework Foundation -framework JavaNativeFoundation \
-      -framework JavaRuntimeSupport -framework Security -framework CoreFoundation
+  SA_LIBS := -framework Foundation -framework Security -framework CoreFoundation
 
 else ifeq ($(OPENJDK_TARGET_OS), windows)
   SA_NAME := sawindbg
diff --git a/jdk/make/lib/Awt2dLibraries.gmk b/jdk/make/lib/Awt2dLibraries.gmk
index c6e3cf590c..be8fb66de1 100644
--- a/jdk/make/lib/Awt2dLibraries.gmk
+++ b/jdk/make/lib/Awt2dLibraries.gmk
@@ -255,8 +255,6 @@ $(eval $(call SetupNativeCompilation,BUILD_LIBAWT, \
     LIBS_macosx := -lmlib_image \
         -framework Cocoa \
         -framework OpenGL \
-        -framework JavaNativeFoundation \
-        -framework JavaRuntimeSupport \
         -framework ApplicationServices \
         -framework AudioToolbox, \
     LIBS_windows := kernel32.lib user32.lib gdi32.lib winspool.lib \
@@ -902,7 +900,6 @@ ifeq ($(ENABLE_HEADLESS_ONLY), false)
         -framework ApplicationServices \
         -framework Foundation \
         -framework Cocoa \
-        -framework JavaNativeFoundation
   else ifeq ($(OPENJDK_TARGET_OS), windows)
     LIBSPLASHSCREEN_LDFLAGS := -delayload:user32.dll
     LIBSPLASHSCREEN_LIBS += kernel32.lib user32.lib gdi32.lib delayimp.lib $(WIN_JAVA_LIB) jvm.lib
@@ -1009,8 +1006,6 @@ ifeq ($(OPENJDK_TARGET_OS), macosx)
           -framework Cocoa \
           -framework Security \
           -framework ExceptionHandling \
-          -framework JavaNativeFoundation \
-          -framework JavaRuntimeSupport \
           -framework OpenGL \
           -framework QuartzCore -ljava, \
       OBJECT_DIR := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libawt_lwawt, \
@@ -1052,8 +1047,6 @@ ifeq ($(OPENJDK_TARGET_OS), macosx)
           -framework Cocoa \
           -framework Carbon \
           -framework ApplicationServices \
-          -framework JavaNativeFoundation \
-          -framework JavaRuntimeSupport \
           -ljava -ljvm, \
       OBJECT_DIR := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libosxui, \
   ))
diff --git a/jdk/make/lib/Lib-java.security.jgss.gmk b/jdk/make/lib/Lib-java.security.jgss.gmk
index 56b290bbe3..dd013a3d8c 100644
--- a/jdk/make/lib/Lib-java.security.jgss.gmk
+++ b/jdk/make/lib/Lib-java.security.jgss.gmk
@@ -65,7 +65,6 @@ ifneq ($(BUILD_CRYPTO), false)
     BUILD_LIBKRB5_NAME := osxkrb5
     BUILD_LIBKRB5_SRC := $(JDK_TOPDIR)/src/java.security.jgss/macosx/native/libosxkrb5
     BUILD_LIBKRB5_LIBS := \
-        -framework JavaNativeFoundation \
         -framework Cocoa \
         -framework SystemConfiguration \
         -framework Kerberos
diff --git a/jdk/make/lib/LibosxLibraries.gmk b/jdk/make/lib/LibosxLibraries.gmk
index 91ab6457cb..14762e600e 100644
--- a/jdk/make/lib/LibosxLibraries.gmk
+++ b/jdk/make/lib/LibosxLibraries.gmk
@@ -49,8 +49,6 @@ ifeq ($(OPENJDK_TARGET_OS), macosx)
           -losxapp \
           -framework Cocoa \
           -framework ApplicationServices \
-          -framework JavaNativeFoundation \
-          -framework JavaRuntimeSupport \
           -framework SystemConfiguration \
           $(JDKLIB_LIBS), \
       OBJECT_DIR := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libosx, \
diff --git a/jdk/make/lib/PlatformLibraries.gmk b/jdk/make/lib/PlatformLibraries.gmk
index 85038b9171..e1b83ce604 100644
--- a/jdk/make/lib/PlatformLibraries.gmk
+++ b/jdk/make/lib/PlatformLibraries.gmk
@@ -48,8 +48,6 @@ ifeq ($(OPENJDK_TARGET_OS), macosx)
           -framework Cocoa \
           -framework Security \
           -framework ExceptionHandling \
-          -framework JavaNativeFoundation \
-          -framework JavaRuntimeSupport \
           -framework OpenGL \
           -framework IOSurface \
           -framework QuartzCore, \
diff --git a/jdk/make/lib/SecurityLibraries.gmk b/jdk/make/lib/SecurityLibraries.gmk
index be73c528c6..567f81dc8e 100644
--- a/jdk/make/lib/SecurityLibraries.gmk
+++ b/jdk/make/lib/SecurityLibraries.gmk
@@ -49,7 +49,6 @@ ifeq ($(OPENJDK_TARGET_OS), macosx)
             $(call SET_SHARED_LIBRARY_ORIGIN) \
             -fobjc-link-runtime, \
         LIBS := \
-            -framework JavaNativeFoundation \
             -framework CoreServices \
             -framework Security \
             $(JDKLIB_LIBS), \
-- 
2.24.3 (Apple Git-128)

