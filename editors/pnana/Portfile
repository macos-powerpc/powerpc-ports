# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0

name                pnana
github.setup        Cyxuan0311 PNANA 1a3250c074eea90bc022b1e03bcc454f2cf0e738
version             2026.01.04
revision            0
categories          editors
license             MIT
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
description         PNANA is a modern terminal text editor
long_description    {*}${description} built with FTXUI
checksums           rmd160  26da61af86592ddb4016c49770ec1f5f15ab74a6 \
                    sha256  1d0d3e83d7bac3701a9f52c7d55a6d1af4499727f3ea51915f23ba395b0232a4 \
                    size    5571638
github.tarball_from archive

# If this becomes a problem, add legacysupport.redirect_bins pnana
# pnana(22787) malloc: *** error for object 0x25d9aa8: pointer being freed was not allocated

depends_build-append \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:FTXUI \
                    port:nlohmann-json

compiler.cxx_standard   2017

# TODO: fix disabling modules: https://github.com/Cyxuan0311/PNANA/issues/10
configure.args-append \
        -DBUILD_GO_MODULE=OFF \
        -DBUILD_IMAGE_PREVIEW_SUPPORT=OFF \
        -DBUILD_LUA_SUPPORT=OFF \
        -DBUILD_TREE_SITTER_SUPPORT=OFF

variant img description "Enable image previews via FFMpeg" {
    depends_lib-append \
        path:lib/libavcodec.dylib:ffmpeg

    configure.args-replace \
        -DBUILD_IMAGE_PREVIEW_SUPPORT=OFF -DBUILD_IMAGE_PREVIEW_SUPPORT=ON
}

variant lua description "Enable Lua" {
    depends_lib-append \
        port:lua54

    configure.args-replace \
        -DBUILD_LUA_SUPPORT=OFF -DBUILD_LUA_SUPPORT=ON
}

variant treesitter description "Build with tree-sitter support" {
    depends_lib-append \
        port:tree-sitter \
        port:tree-sitter-bash \
        port:tree-sitter-c \
        port:tree-sitter-cmake \
        port:tree-sitter-cpp \
        port:tree-sitter-css \
        port:tree-sitter-dockerfile \
        port:tree-sitter-fortran \
        port:tree-sitter-go \
        port:tree-sitter-haskell \
        port:tree-sitter-java \
        port:tree-sitter-javascript \
        port:tree-sitter-json \
        port:tree-sitter-lua \
        port:tree-sitter-markdown \
        port:tree-sitter-php \
        port:tree-sitter-python \
        port:tree-sitter-r \
        port:tree-sitter-ruby \
        port:tree-sitter-rust \
        port:tree-sitter-scala \
        port:tree-sitter-tcl \
        port:tree-sitter-typescript \
        port:tree-sitter-vim \
        port:tree-sitter-yaml

    configure.args-replace \
        -DBUILD_TREE_SITTER_SUPPORT=OFF -DBUILD_TREE_SITTER_SUPPORT=ON
}

default_variants +lua +treesitter

# Not everything works correctly in Apple Terminal:
# https://github.com/Cyxuan0311/PNANA/issues/3
# https://github.com/Cyxuan0311/PNANA/issues/7
notes "
It is recommended to avoid Apple Terminal and instead use\
iTerm2, mlterm(-minimal) etc.
"
