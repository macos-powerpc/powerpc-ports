From edaee58fb00665cb0b2d3c2be96c738a9814b48a Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Thu, 6 Nov 2025 02:29:51 +0800
Subject: [PATCH 18/18] queue-test.c: provide memrchr

Borrowed from https://lists.zx2c4.com/pipermail/cgit/2020-August/004509.html
---
 tests/queue-test.c | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/tests/queue-test.c b/tests/queue-test.c
index 7dfdd30..64610c5 100644
--- a/tests/queue-test.c
+++ b/tests/queue-test.c
@@ -42,6 +42,23 @@
 #include "test-compositor.h"
 #include "../src/timespec-util.h"
 
+#ifdef __APPLE__
+static void *
+memrchr(const void *s, int c, size_t n)
+{
+    const unsigned char *cp;
+
+    if (n != 0) {
+        cp = (unsigned char *)s + n;
+        do {
+            if (*(--cp) == (unsigned char)c)
+                return (void *)cp;
+        } while (--n != 0);
+    }
+    return (void *)0;
+}
+#endif
+
 #define ARRAY_LENGTH(a) (sizeof (a) / sizeof (a)[0])
 
 static void
-- 
2.24.3 (Apple Git-128)

