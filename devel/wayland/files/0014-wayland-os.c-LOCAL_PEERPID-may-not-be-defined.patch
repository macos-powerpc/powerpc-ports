From 7e70f7a670f3958e97c905f77e4aa9449f8adebb Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <vital.had@gmail.com>
Date: Thu, 6 Nov 2025 00:34:37 +0800
Subject: [PATCH 14/18] wayland-os.c: LOCAL_PEERPID may not be defined

---
 src/wayland-os.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/wayland-os.c b/src/wayland-os.c
index fa00338..e8fbb7c 100644
--- a/src/wayland-os.c
+++ b/src/wayland-os.c
@@ -147,7 +147,7 @@ wl_os_socket_peercred(int sockfd, uid_t *uid, gid_t *gid, pid_t *pid)
 	*pid = ucred.pid;
 	return 0;
 }
-#elif defined(HAVE_GETPEEREID) && defined(LOCAL_PEERPID)
+#elif defined(HAVE_GETPEEREID)
 int
 wl_os_socket_peercred(int sockfd, uid_t *uid, gid_t *gid, pid_t *pid)
 {
@@ -158,9 +158,11 @@ wl_os_socket_peercred(int sockfd, uid_t *uid, gid_t *gid, pid_t *pid)
 	}
 
 	len = sizeof(pid_t);
+#ifdef LOCAL_PEERPID
 	if (getsockopt(sockfd, SOL_LOCAL, LOCAL_PEERPID, pid, &len) != 0) {
 		return -1;
 	}
+#endif
 	return 0;
 }
 #else
-- 
2.24.3 (Apple Git-128)

