From 2aa324951fb60d7337be72a5dfa4eeb952a1120e Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Thu, 28 Aug 2025 18:15:28 +0800
Subject: [PATCH] thread_pool.h: allow build when pthread_setname_np is missing

Fixes: https://github.com/google/highway/issues/2691
---
 hwy/contrib/thread_pool/thread_pool.h | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/hwy/contrib/thread_pool/thread_pool.h b/hwy/contrib/thread_pool/thread_pool.h
index 864075e2f2..0541e1bfdc 100644
--- hwy/contrib/thread_pool/thread_pool.h
+++ hwy/contrib/thread_pool/thread_pool.h
@@ -46,6 +46,10 @@
 #include "hwy/stats.h"
 #include "hwy/timer.h"
 
+#if HWY_OS_APPLE
+#include <AvailabilityMacros.h>
+#endif
+
 // Define to HWY_NOINLINE to see profiles of `WorkerRun*` and waits.
 #define HWY_POOL_PROFILE
 
@@ -64,9 +68,12 @@
   HWY_ASSERT(0 == pthread_setname_np(pthread_self(), buf));
 #elif HWY_OS_FREEBSD
   HWY_ASSERT(0 == pthread_set_name_np(pthread_self(), buf));
-#elif HWY_OS_APPLE
+#elif HWY_OS_APPLE && (MAC_OS_X_VERSION_MIN_REQUIRED >= 1060)
   // Different interface: single argument, current thread only.
   HWY_ASSERT(0 == pthread_setname_np(buf));
+#else
+  (void)format;
+  (void)thread;
 #endif
 }
 
