From 095179741f11fe3ffa14e0ae204567e1bba7efda Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Mon, 1 Sep 2025 05:11:31 +0800
Subject: [PATCH] xnu_debug.c: fix CPU_PC on powerpc

---
 libr/debug/p/native/xnu/xnu_debug.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/libr/debug/p/native/xnu/xnu_debug.c b/libr/debug/p/native/xnu/xnu_debug.c
index a88c3eac1320a..b7f60651dd654 100644
--- a/libr/debug/p/native/xnu/xnu_debug.c
+++ b/libr/debug/p/native/xnu/xnu_debug.c
@@ -21,6 +21,7 @@
 #include <mach/host_priv.h>
 #include <mach/thread_status.h>
 #include <mach/vm_statistics.h>
+#include <AvailabilityMacros.h>
 
 #if APPLE_SDK_IPHONEOS
 kern_return_t mach_vm_protect
@@ -631,7 +632,11 @@ RList *xnu_thread_list(RDebug *dbg, int pid, RList *list) {
 	#define CPU_PC R_SYS_BITS_CHECK (dbg->bits, 64)? \
 		state.ts_64.__pc : state.ts_32.__pc
 #elif __POWERPC__
-	#define CPU_PC state.srr0
+	#if MAC_OS_X_VERSION_MAX_ALLOWED < 1050
+		#define CPU_PC state.srr0
+	#else
+		#define CPU_PC state.__srr0
+	#endif
 #elif __x86_64__ || __i386__
 	#define CPU_PC R_SYS_BITS_CHECK (dbg->bits, 64)? \
 		state.uts.ts64.__rip : state.uts.ts32.__eip
