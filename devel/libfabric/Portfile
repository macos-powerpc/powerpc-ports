# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0
PortGroup               legacysupport 1.1

# _SC_PHYS_PAGES, scandir
legacysupport.newest_darwin_requires_legacy 13

github.setup            ofiwg libfabric 2.4.0 v
revision                0

categories              devel parallel science
license                 BSD GPL-2
maintainers             {@barracuda156 macos-powerpc.org:barracuda} openmaintainer

description             Open Fabrics Interfaces (OFI)
long_description        ${name}, or {*}${description}, is a framework focused on exporting \
                        high-performance networking services to applications.

checksums               rmd160  10124c132f66c549fb18edaa9b48355b744ea70b \
                        sha256  37c6415ba8a4c7a24529406187ad5084bb87ad904d5542ac82dac66807c4fb29 \
                        size    4973021
github.tarball_from     archive

# https://github.com/ofiwg/libfabric/pull/11541
patchfiles              patch-macos.diff

compiler.c_standard     2011

use_autoreconf          yes
autoreconf.cmd          ./autogen.sh
autoreconf.args

depends_build-append    port:autoconf \
                        port:automake \
                        port:libtool

platform darwin {
    # macOS does not have epoll, but there are ports installing it.
    configure.args-append \
                        --disable-epoll

    if {${os.major} < 13} {
        configure.cflags-append \
                        -D_MACPORTS_LEGACY_COMPATIBLE_SCANDIR=1
    }
}
