# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           conflicts_build 1.0
PortGroup           github 1.0

github.setup        zuzuf freeocl 6d1d5c909d40a1c203e6d56e8a5c0707118caf30
version             0.3.6-20180107
revision            0
categories          devel graphics
maintainers         {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
license             LGPL-3
description         implementation of OpenCL 1.2 specifications targeting CPUs.
long_description    FreeOCL is an {*}${description}.
checksums           rmd160  6f99efeba4d17b0966238ca0e9120f14a414139a \
                    sha256  907a721daada0cfb683e9517c68d6e41c5b7b0ad768309bf03f0fae0f2254fb2 \
                    size    269474
github.tarball_from archive

patchfiles          patch-CMakeLists.txt

# https://github.com/zuzuf/freeocl/issues/25
post-patch {
    fs-traverse f ${worksrcpath} {
        if {[string match *.h ${f}]} {
            reinplace -q "s|OpenCL/cl.h|CL/cl.h|" ${f}
        }
    }
}

compiler.cxx_standard   2011
compiler.openmp_version 2.5

# C++11 is optional but enabled by default.
configure.args-append   -DFREEOCL_USE_CXX0X=ON

# ucontext
configure.cppflags-append \
                        -D_XOPEN_SOURCE

if {${os.platform} eq "darwin" && ${os.major} < 12} {
    configure.cppflags-append \
                        -DAVAILABLE_MAC_OS_X_VERSION_10_8_AND_LATER=
}

# configure.cppflags-append \
#                         -DCL_TARGET_OPENCL_VERSION=120
