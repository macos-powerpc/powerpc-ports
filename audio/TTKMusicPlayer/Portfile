# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0
PortGroup           openssl 1.0
PortGroup           qt4 1.0

openssl.branch      1.1

github.setup        Greedysky TTKMusicPlayer 0a073fcb84134aa95ff21b5eac8b571e2e4c75c7
version             4.2.0.0
revision            2
categories          audio multimedia
license             {GPL-3 LGPL-3}
maintainers         {@barracuda156 macos-powerpc.org:barracuda}
description         ${name} is a Qt-based music player
long_description    ${name} imitates Kugou UI and uses qmmp core library based on Qt.

checksums           rmd160  f9f9fbf7698041c7c84698aa58f6e2c523096139 \
                    sha256  ba334149192b154ec1ac83fb0794881d0b40d49f2ad82e761cbc091959183b50 \
                    size    5894720
github.tarball_from archive

patch.pre_args-replace  -p0 -p1

# In result it ends up in ${prefix}/libexec/${name}
cmake.install_prefix \
                    ${prefix}/libexec

# For rename
depends_build-append \
                    port:util-linux

depends_lib-append  port:libpng \
                    port:libqmmp

compiler.cxx_standard   2011

# clang: error: unsupported option '-fopenmp'
compiler.openmp_version 3.0

set ttkroot         ${prefix}/libexec/TTKMusicPlayer

# These configure args are important
configure.args-append \
                    -DCMAKE_INSTALL_NAME_DIR=${ttkroot}/${version} \
                    -DOPENSSL_DIR=[openssl::install_area] \
                    -DQT_LRELEASE_EXECUTABLE=${qt_dir}/bin/lrelease \
                    -DQT_QMAKE_EXECUTABLE=${qt_dir}/bin/qmake \
                    -DTTK_BUILD_SHARED=ON \
                    -DTTK_QMMP_LIBRARY=${ttkroot}/${version}/libTTKqmmp.dylib \
                    -DTTK_QT_VERSION=4

configure.cppflags-append \
                    -D_DARWIN_C_SOURCE

post-destroot {
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKInit.sh ${destroot}${ttkroot}/${version}/
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKConsole.sh ${destroot}${ttkroot}/${version}/
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKRoutineCopy.sh ${destroot}${ttkroot}/${version}/
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKService.sh ${destroot}${ttkroot}/${version}/
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKMusicPlayer.sh ${destroot}${ttkroot}/
    xinstall -m 775 ${worksrcpath}/TTKResource/_extras/TTKRoutine.sh ${destroot}${ttkroot}/
}
