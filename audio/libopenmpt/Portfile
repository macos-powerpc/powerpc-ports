# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           legacysupport 1.1

# Undefined symbols for architecture x86_64:
# "typeinfo for std::bad_variant_access"
legacysupport.use_mp_libcxx yes
# openmpt123(23299) malloc: *** error for object 0xa04dc754: pointer being freed was not allocated
legacysupport.redirect_bins openmpt123

name                libopenmpt
version             0.8.4
revision            0
categories          audio devel multimedia
license             BSD
maintainers         nomaintainer
description         Library to decode tracked music files
long_description    ${name} is a cross-platform C++ and C library to decode \
                    tracked music files (modules) into a raw PCM audio stream.
homepage            https://lib.openmpt.org
master_sites        ${homepage}/files/libopenmpt/src/
distname            ${name}-${version}+release.autotools
checksums           rmd160  2eebea531a69def433bf0022d42ec1f43e8a21a5 \
                    sha256  627f9bf11aacae615a1f2c982c7e88cb21f11b2d6f0267946f7c82c5eae4943b \
                    size    1765663

depends_build-append \
                    path:bin/pkg-config:pkgconfig
depends_lib-append  port:flac \
                    port:libogg \
                    port:libsndfile \
                    port:libvorbis \
                    port:mpg123 \
                    port:portaudio \
                    port:zlib

compiler.cxx_standard 2017

configure.args-append \
                    --disable-dependency-tracking \
                    --disable-silent-rules

# terminate called after throwing an instance of 'std::runtime_error'
#  what():  locale::facet::_S_create_c_locale name not valid
# See: https://stackoverflow.com/questions/19405272/c-issues-with-boostfilesystem-on-server-localefacet-s-create-c-locale
build.env-append    LC_ALL=C
destroot.env-append LC_ALL=C
test.env-append     LC_ALL=C

notes "You may need to export LC_ALL=C to the environment in order to use the executable."

livecheck.url       https://lib.openmpt.org/files/libopenmpt/src/
