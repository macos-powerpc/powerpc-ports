# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           ruby 1.0

ruby.branches       3.4 3.3 3.2
ruby.setup          rtfm-filemanager 7.0.10 gem {} rubygems
revision            0
categories-append   sysutils
platforms           any
license             Unlicense
maintainers         nomaintainer
description         ${name} is a full-featured terminal file-manager
long_description    {*}${description}
homepage            https://isene.com
checksums           rmd160  3a42c0393c2c214b48e92431ef628fbf1e0655cb \
                    sha256  0844c0512482eeaf41c4ecc1fd992dfb7b500529acb51d7037251091ffb3b5ca \
                    size    1593856
supported_archs     noarch

if {${subport} ne ${name}} {
    depends_run-append \
                    port:rb${ruby.suffix}-bootsnap \
                    port:rb${ruby.suffix}-rcurses \
                    port:rb${ruby.suffix}-ruby-openai

    depends_run-append \
                    port:catdoc \
                    port:ffmpegthumbnailer \
                    port:gnumeric \
                    port:highlight \
                    port:ImageMagick \
                    port:ncurses \
                    port:TermMark \
                    port:unzip \
                    port:w3m

    post-destroot {
        # Fix rb-ruby-openai version
        reinplace "s|~> 7.4|>= 7.4|g" ${destroot}${ruby.gemdir}/specifications/${ruby.module}-${version}.gemspec

        # https://github.com/isene/RTFM/issues/8
        reinplace "s|\'bat\' : \'batcat\'|\'bat\' : \'highlight\'|g" ${destroot}${ruby.gemdir}/gems/${ruby.module}-${version}/bin/rtfm
        reinplace "s|-n --color=always|-O ansi --force --line-numbers|g" ${destroot}${ruby.gemdir}/gems/${ruby.module}-${version}/bin/rtfm
        reinplace "s|pandoc \@s -t plain|termmark \@s|g" ${destroot}${ruby.gemdir}/gems/${ruby.module}-${version}/bin/rtfm
    }
}
