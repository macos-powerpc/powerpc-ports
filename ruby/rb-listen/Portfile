# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           ruby 1.0

ruby.branches       3.4 3.3 3.2 3.1 3.0
ruby.setup          listen 3.9.0 gem {} rubygems
categories-append   devel
platforms           any
license             MIT
maintainers         nomaintainer
description         ${name} listens to file modifications and notifies you about the changes
long_description    {*}${description}
homepage            https://github.com/guard/listen
checksums           rmd160  c6569e2c33e016e2d796488fb0bfa364bc025123 \
                    sha256  db9e4424e0e5834480385197c139cb6b0ae0ef28cc13310cfd1ca78377d59c67 \
                    size    31232
supported_archs     noarch

if {${subport} ne ${name}} {
    depends_run-append \
                    port:rb${ruby.suffix}-fsevent \
                    port:rb${ruby.suffix}-inotify

    if {${os.platform} eq "darwin" && ${os.major} < 11} {
        depends_run-replace \
                    port:rb${ruby.suffix}-fsevent \
                    port:rb${ruby.suffix}-fsevent-legacy
        post-destroot {
            reinplace "s|rb-fsevent|rb-fsevent-legacy|g" \
                    ${destroot}${ruby.gemdir}/specifications/${ruby.module}-${version}.gemspec
            reinplace "s|~> 0.10|~> 0.2.0|g" \
                    ${destroot}${ruby.gemdir}/specifications/${ruby.module}-${version}.gemspec
            reinplace "s|>= 0.10.3|>= 0.2.0|g" \
                    ${destroot}${ruby.gemdir}/specifications/${ruby.module}-${version}.gemspec
        }
    }
}
