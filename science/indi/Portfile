# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0
PortGroup           legacysupport 1.1

# strnlen, CLOCK_MONOTONIC
legacysupport.newest_darwin_requires_legacy 15

github.setup        indilib indi 1.9.4 v
revision            0

set branch          [join [lrange [split ${version} .] 0 1] .]
categories          science
license             LGPL-2.1+
maintainers         nomaintainer

description         Distributed control protocol for astronomical instrumentation
long_description    INDI is a distributed control protocol designed to \
                    operate astronomical instrumentation. INDI is small, \
                    flexible, easy to parse and scalable. It supports common \
                    DCS functions such as remote control, data acquisition, \
                    monitoring and a lot more. With INDI, you have a total \
                    transparent control over your instruments so you can get \
                    more science with less time.

homepage            https://www.indilib.org
checksums           rmd160  ee6628ea4ca264171ad15614d9642e1210ba88ed \
                    sha256  0d2ec2a472bba04020a24bf34554318e9c891bd14b06c175f6a272ed24b90fe9 \
                    size    2370816
github.tarball_from archive

depends_build-append \
                    port:gtest \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:cfitsio \
                    port:curl \
                    port:fftw-3 \
                    port:gsl \
                    path:include/turbojpeg.h:libjpeg-turbo \
                    port:libnova \
                    port:libogg \
                    port:libtheora \
                    path:lib/pkgconfig/libusb-1.0.pc:libusb \
                    port:SoapyRTLSDR \
                    port:zlib

patchfiles          deepskydad_fr1.patch \
                    patch-cstdint.diff

compiler.cxx_standard 2014

platform darwin {
    # connectionserial.cpp:445:59: error: invalid conversion from 'int (*)(const dirent*)' to 'int (*)(dirent*)' [-fpermissive]
    configure.cppflags-append \
                    -D_MACPORTS_LEGACY_COMPATIBLE_SCANDIR=1

    # Build uses -D_XOPEN_SOURCE=600 flag which breaks it -_-
    # lx200driver.cpp:412:11: error: 'strnlen' was not declared in this scope; did you mean 'strlen'?
    configure.cppflags-append \
                    -D_DARWIN_C_SOURCE
}
